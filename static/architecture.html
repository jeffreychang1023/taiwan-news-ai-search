<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NLWeb System Architecture</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .controls {
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .workflow-btn {
            padding: 12px 24px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .workflow-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .workflow-btn.active {
            background: #667eea;
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .main-content {
            display: flex;
            height: calc(100vh - 250px);
            min-height: 600px;
        }

        .canvas-container {
            flex: 1;
            position: relative;
            overflow: auto;
            background: #ffffff;
        }

        #dag-canvas {
            width: 100%;
            height: 100%;
            min-width: 3200px;
            min-height: 1500px;
        }

        .node {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .node-rect {
            fill: #ffffff;
            stroke: #667eea;
            stroke-width: 2;
            rx: 8;
            transition: all 0.3s ease;
        }

        .node:hover .node-rect {
            fill: #f0f4ff;
            stroke: #764ba2;
            stroke-width: 3;
        }

        .node.selected .node-rect {
            fill: #e8f0ff;
            stroke: #667eea;
            stroke-width: 4;
        }

        .node.same-level .node-rect {
            fill: #d4edda;
            stroke: #28a745;
            stroke-width: 3;
        }

        .node.child-level .node-rect {
            fill: #d1ecf1;
            stroke: #17a2b8;
            stroke-width: 3;
        }

        .node-text {
            fill: #333;
            font-size: 14px;
            font-weight: 600;
            pointer-events: none;
            user-select: none;
        }

        .node-script {
            fill: #555;
            font-size: 11px;
            pointer-events: none;
            user-select: none;
        }

        .toggle-btn {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-circle {
            fill: #667eea;
            stroke: #ffffff;
            stroke-width: 2;
        }

        .toggle-btn:hover .toggle-circle {
            fill: #764ba2;
        }

        .toggle-icon {
            fill: white;
            font-size: 12px;
            font-weight: bold;
            pointer-events: none;
        }

        .edge {
            fill: none;
            stroke: #667eea;
            stroke-width: 2;
            marker-end: url(#arrowhead);
            transition: all 0.3s ease;
            opacity: 0.6;
        }

        .edge.feedback {
            stroke-dasharray: 5, 5;
            stroke: #dc3545;
        }

        .info-panel {
            position: absolute;
            background: white;
            border: 2px solid #667eea;
            border-radius: 12px;
            padding: 20px;
            max-width: 400px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            display: none;
        }

        .info-panel.visible {
            display: block;
        }

        .info-panel h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .info-panel p {
            color: #555;
            line-height: 1.6;
            font-size: 0.95em;
        }

        .info-panel .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .info-panel .close-btn:hover {
            background: #c82333;
            transform: rotate(90deg);
        }

        .legend {
            position: absolute;
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid #667eea;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }

        .legend h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1em;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 8px 0;
            font-size: 0.9em;
        }

        .legend-box {
            width: 30px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid;
        }

        .legend-box.selected {
            background: #e8f0ff;
            border-color: #667eea;
        }

        .legend-box.same-level {
            background: #d4edda;
            border-color: #28a745;
        }

        .legend-box.child-level {
            background: #d1ecf1;
            border-color: #17a2b8;
        }

        .legend-item .feedback-line {
            width: 30px;
            height: 0;
            border-top: 2px dashed #dc3545;
            margin: 10px 0;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ—ï¸ NLWeb System Architecture</h1>
            <p>Interactive DAG Visualization - Click nodes to explore relationships</p>
        </div>
        <div class="controls">
            <strong>Workflows:</strong>
            <button class="workflow-btn active" data-workflow="1">Workflow 1: Complete Flow</button>
            <button class="workflow-btn" data-workflow="2">Workflow 2: Retrieval Pipeline</button>
            <button class="workflow-btn" data-workflow="3">Workflow 3: Ranking Pipeline</button>
            <button class="workflow-btn" data-workflow="4">Workflow 4: System Components</button>
        </div>
        <div class="main-content">
            <div class="canvas-container">
                <svg id="dag-canvas">
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <polygon points="0 0, 10 3, 0 6" fill="#667eea" />
                        </marker>
                    </defs>
                    <g id="edges-group"></g>
                    <g id="nodes-group"></g>
                </svg>
                <div id="info-panel" class="info-panel">
                    <button class="close-btn" onclick="closeInfoPanel()">Ã—</button>
                    <h3 id="info-title">Entity Name</h3>
                    <p id="info-content">Design rationale will appear here...</p>
                </div>
                <div class="legend">
                    <h4>Legend</h4>
                    <div class="legend-item">
                        <div class="legend-box selected"></div><span>Selected Node</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box same-level"></div><span>Same Level</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-box child-level"></div><span>Child Level</span>
                    </div>
                    <div class="legend-item">
                        <div class="feedback-line"></div><span>Feedback Loop</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        const graphData =         {
            "nodes": [
                {
                    "id": "mod-indexing",
                    "labelEn": "Indexing",
                    "labelZh": "ç´¢å¼•èˆ‡æ•¸æ“š",
                    "moduleId": 0,
                    "status": "header",
                    "rationale": "Indexing æ¨¡çµ„æ˜¯æ”¯æ’ç³»çµ±é‹ä½œçš„ã€Œé«˜å¯ä¿¡è³‡æ–™å·¥å» ã€ã€‚ä¸åŒæ–¼ä¸€èˆ¬è³‡æ–™åº«åªè² è²¬å­˜å„²ï¼Œæœ¬æ¨¡çµ„æ¶µè“‹äº†å¾è‡ªå‹•åŒ–æ“·å–ã€æ¸…æ´—ã€æ¬Šå¨æ€§é©—è­‰åˆ°åˆ†ç´šå„²å­˜çš„å®Œæ•´æµç¨‹ï¼Œç¢ºä¿ã€Œåƒåœ¾é€²ï¼Œåƒåœ¾å‡ºã€çš„æƒ…æ³ä¸æœƒç™¼ç”Ÿï¼Œè®“ä¸Šå±¤æ¨¡çµ„èƒ½å°ˆæ³¨æ–¼é‚è¼¯èˆ‡æ¨è«–ã€‚

æ¨¡çµ„é‡é»ï¼š
â€¢ è³‡æ–™ä¾†æºå¯ä¿¡ï¼šåªæ”¶éŒ„é«˜å¯ä¿¡åº¦çš„ç¶²ç«™èˆ‡å…§å®¹ï¼Œä¸¦é€éæ¬Šå¨æ€§è©•åˆ†é€²è¡Œæ²»ç†ã€‚
â€¢ æª¢ç´¢æ•ˆèƒ½ç©©å®šï¼šæ•´åˆçµæ§‹åŒ–è³‡æ–™åº«ã€å‘é‡æœå°‹èˆ‡å¿«å–ï¼Œå¿«é€Ÿå–å›èˆ‡æŸ¥è©¢æ„åœ–æœ€æ¥è¿‘çš„æ–‡ä»¶ã€‚
â€¢ è‡ªå‹•åŒ–æƒ…å ±è’é›†ï¼šå…¨å¤©å€™ç›£æ§æŒ‡å®šçš„é«˜åƒ¹å€¼ä¾†æºï¼Œç¢ºä¿è³‡è¨Šæ™‚æ•ˆæ€§èˆ‡å®Œæ•´æ€§ã€‚",
                    "script": "",
                    "isModuleHeader": true,
                    "x": 54,
                    "y": 203,
                    "workflows": [
                        "workflow2",
                        "workflow5"
                    ]
                },
                {
                    "id": "sys-db",
                    "labelEn": "Postgres DB",
                    "labelZh": "è³‡æ–™åº«",
                    "moduleId": 6,
                    "status": "partial",
                    "rationale": "ç›®çš„ï¼šå„²å­˜çµæ§‹åŒ– ML ç”¨è³‡æ–™ä½œç‚ºè³‡æ–™åŸºåº•ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šä½¿ç”¨ç·šä¸Š PostgreSQLï¼Œå­˜æ”¾ document objectã€metadataï¼Œä»¥åŠä¾›æ¨¡å‹è¨“ç·´ä½¿ç”¨çš„æ¬„ä½ã€‚",
                    "script": "retrieval_providers/postgres_client.py",
                    "x": 1193,
                    "y": 38,
                    "workflows": [
                        "workflow1",
                        "workflow2",
                        "workflow3",
                        "workflow5"
                    ]
                },
                {
                    "id": "sys-cache",
                    "labelEn": "In-Memory Cache",
                    "labelZh": "è¨˜æ†¶é«”å¿«å–",
                    "moduleId": 6,
                    "status": "done",
                    "rationale": "ç›®çš„ï¼šåŠ é€Ÿé‡è¤‡æŸ¥è©¢èˆ‡æª¢ç´¢æµç¨‹ï¼Œä¾›é€²ä¸€æ­¥åˆ†æèˆ‡æ¨è«–ä½¿ç”¨ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šå¿«å– retrieval çµæœï¼Œæä¾›å¾ŒçºŒæ¨¡çµ„åˆ†æèˆ‡æ¨è«–ã€‚",
                    "script": "chat/cache.py",
                    "x": 2302,
                    "y": 43,
                    "workflows": [
                        "workflow1",
                        "workflow3",
                        "workflow5"
                    ]
                },
                {
                    "id": "sys-vec",
                    "labelEn": "Qdrant Vector DB",
                    "labelZh": "å‘é‡è³‡æ–™åº«",
                    "moduleId": 0,
                    "status": "partial",
                    "rationale": "ç›®çš„ï¼šæä¾›èªæ„æª¢ç´¢èƒ½åŠ›ï¼Œæ”¯æ´æ··åˆæª¢ç´¢ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šå­˜å…¨æ–‡ + metadata + embeddingï¼Œä½œç‚ºæ··åˆç´¢å¼•æŸ¥è©¢åŸºåº•ã€‚",
                    "script": "retrieval_providers/qdrant.py",
                    "x": 625,
                    "y": 855,
                    "workflows": [
                        "workflow1",
                        "workflow2",
                        "workflow3",
                        "workflow5"
                    ]
                },
                {
                    "id": "sqlite-dev",
                    "labelEn": "SQLite DB",
                    "labelZh": "SQLiteé–‹ç™¼åº«",
                    "moduleId": 6,
                    "status": "done",
                    "rationale": "ç›®çš„ï¼šæœ¬åœ°é–‹ç™¼èˆ‡ pipeline æ¨¡æ“¬ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šä½¿ç”¨ SQLite å„²å­˜è‡¨æ™‚ ML è¨“ç·´è³‡æ–™ï¼Œæ¨¡æ“¬ç³»çµ±è¡Œç‚ºï¼Œä¸å­˜ä½¿ç”¨è€…è¡Œç‚ºè³‡æ–™ã€‚",
                    "script": "storage/sqlite_dev.py",
                    "x": 1195,
                    "y": 137,
                    "workflows": [
                        "workflow5"
                    ]
                },
                {
                    "id": "data-chunking",
                    "labelEn": "Data Chunking",
                    "labelZh": "è³‡æ–™åˆ†ç´š",
                    "moduleId": 0,
                    "status": "notdone",
                    "rationale": "ç›®çš„ï¼šä¾è³‡æ–™é‡è¦æ€§ä¸åŒè™•ç†ï¼Œå„ªåŒ–å„²å­˜èˆ‡æª¢ç´¢æ•ˆç‡ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šå°é‡è¦æ–‡ä»¶é€²è¡Œç²¾ç´° chunkingï¼›å°ä¸€èˆ¬æ–‡ä»¶åªå­˜ metadata æˆ–å…¨æ–‡ï¼Œä¸å­˜ embeddingï¼›æ”¯æ´ minimal chunking ç­‰ä¸åŒé¡†ç²’åº¦å„²å­˜ç­–ç•¥ã€‚",
                    "script": "indexing/chunking.py",
                    "x": 344,
                    "y": 1029,
                    "workflows": [
                        "workflow2",
                        "workflow5"
                    ]
                },
                {
                    "id": "auto-crawler",
                    "labelEn": "Auto Crawler",
                    "labelZh": "è‡ªå‹•çˆ¬èŸ²",
                    "moduleId": 0,
                    "status": "notdone",
                    "rationale": "ç›®çš„ï¼šè‡ªå‹•æŠ“å–ä¾†æºç¶²ç«™æ–‡ä»¶ï¼Œç¢ºä¿å„²å­˜è³‡æ–™å®Œæ•´ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šè¦åŠƒå»ºç«‹çˆ¬èŸ² pipelineï¼Œè‡ªå‹•æŠ“å–é«˜å¯ä¿¡åº¦ä¾†æºçš„æ–‡ä»¶ï¼›æ”¯æ´æ¬„ä½æŠ½å–ã€metadata æ¨™è¨˜ã€ä»¥åŠå¾ŒçºŒå„²å­˜åˆ°Qdrantã€‚",
                    "script": "indexing/crawler.py",
                    "x": 334,
                    "y": 463,
                    "workflows": [
                        "workflow2",
                        "workflow5"
                    ]
                },
                {
                    "id": "format-detect",
                    "labelEn": "Format Detector",
                    "labelZh": "æ ¼å¼åµæ¸¬",
                    "moduleId": 0,
                    "status": "notdone",
                    "rationale": "ç›®çš„ï¼šç¶­æŒè³‡æ–™æº–ç¢ºæ€§èˆ‡æœ€æ–°ç‹€æ…‹ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šè¦åŠƒè‡ªå‹•åµæ¸¬ç¶²ç«™æ ¼å¼æˆ–æ–‡ç« ç‰ˆæœ¬è®Šå‹•ï¼Œæ›´æ–° Storage ä¸­çš„æ–‡ä»¶ï¼Œç¢ºä¿è³‡æ–™ä¸€è‡´æ€§ã€‚",
                    "script": "indexing/format_detector.py",
                    "x": 461,
                    "y": 600,
                    "workflows": [
                        "workflow2",
                        "workflow5"
                    ]
                },
                {
                    "id": "user-data",
                    "labelEn": "User Data Storage",
                    "labelZh": "ä½¿ç”¨è€…è³‡æ–™",
                    "moduleId": 6,
                    "status": "notdone",
                    "rationale": "ç›®çš„ï¼šè¨˜éŒ„ä½¿ç”¨è€…ç›¸é—œè³‡æ–™ï¼Œç”¨æ–¼åˆ†æèˆ‡å€‹æ€§åŒ–æ¨è«–ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šå„²å­˜ä½¿ç”¨è€…ç™»å…¥è³‡è¨Šã€éå¾€å°è©±æ­·å²ç­‰ï¼Œæ”¯æ´ç³»çµ±æä¾›ç¶²ç«™é«”é©—ã€‚",
                    "script": "storage/user_data.py",
                    "x": 1623,
                    "y": 86,
                    "workflows": [
                        "workflow2",
                        "workflow5"
                    ]
                },
                {
                    "id": "quality-gate",
                    "labelEn": "Quality Gate",
                    "labelZh": "å“è³ªé–˜é–€",
                    "moduleId": 0,
                    "status": "notdone",
                    "rationale": "ç›®çš„ï¼šä½œç‚ºè³‡æ–™å“è³ªçš„å®ˆé–€å“¡ï¼Œé˜²æ­¢ã€Œåƒåœ¾é€²ã€åƒåœ¾å‡ºã€ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šä¾æ“šå…§å®¹é•·åº¦ã€äº‚ç¢¼æ¯”ä¾‹ã€èªè¨€æ©Ÿç‡ç­‰æŒ‡æ¨™ï¼Œè‡ªå‹•å‰”é™¤ä½å“è³ªæˆ–ç„¡æ•ˆçš„ç¶²é å…§å®¹ã€‚",
                    "script": "indexing/quality_gate.py",
                    "x": 344,
                    "y": 738,
                    "workflows": [
                        "workflow2",
                        "workflow5"
                    ]
                },
                {
                    "id": "light-ner",
                    "labelEn": "Light NER",
                    "labelZh": "è¼•é‡NER",
                    "moduleId": 0,
                    "status": "notdone",
                    "rationale": "ç›®çš„ï¼šè±å¯Œè³‡æ–™çš„ Metadataï¼Œæå‡æª¢ç´¢éæ¿¾çš„ç²¾æº–åº¦ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šä½¿ç”¨è¼•é‡ç´šæ¨¡å‹å¿«é€Ÿè­˜åˆ¥æ–‡ç« ä¸­çš„äººåã€æ©Ÿæ§‹ã€åœ°åï¼Œä¸éœ€å‘¼å«æ˜‚è²´çš„LLMã€‚",
                    "script": "indexing/light_ner.py",
                    "x": 342,
                    "y": 883,
                    "workflows": [
                        "workflow2",
                        "workflow5"
                    ]
                },
                {
                    "id": "src-auth",
                    "labelEn": "Source Authority",
                    "labelZh": "ä¾†æºæ¬Šå¨",
                    "moduleId": 0,
                    "status": "notdone",
                    "rationale": "ç›®çš„ï¼šå»ºç«‹è³‡æ–™ä¾†æºçš„æ¬Šå¨æ€§è©•ç´šï¼Œå„ªå…ˆå±•ç¤ºå¯ä¿¡å…§å®¹ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šä¾æ“šåŸŸåæ­·å²ä¿¡è­½ã€å¼•ç”¨æ¬¡æ•¸ç­‰è¨ˆç®—æ¬Šå¨åˆ†æ•¸ï¼Œç›´æ¥å½±éŸ¿å¾ŒçºŒçš„æ’åºæ¬Šé‡ã€‚",
                    "script": "indexing/source_authority.py",
                    "x": 578,
                    "y": 331,
                    "workflows": [
                        "workflow2",
                        "workflow5"
                    ]
                },
                {
                    "id": "domain-allowlist",
                    "labelEn": "Domain Allowlist",
                    "labelZh": "åŸŸåç™½åå–®",
                    "moduleId": 0,
                    "status": "notdone",
                    "rationale": "ç›®çš„ï¼šç¢ºä¿ç³»çµ±åƒ…æ”¶éŒ„åˆè¦èˆ‡é«˜å¯ä¿¡åº¦çš„ä¾†æºã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šç¶­è­·å‹•æ…‹çš„ç™½åå–®æ©Ÿåˆ¶ï¼Œéæ¸…å–®å…§çš„ä¾†æºå°‡è¢«æ¨™è¨˜æˆ–é˜»æ“‹ï¼Œæ”¯æ´ä¼æ¥­è‡ªè¨‚ä¿¡ä»»æ¸…å–®ã€‚",
                    "script": "indexing/domain_allowlist.py",
                    "x": 64,
                    "y": 330,
                    "workflows": [
                        "workflow2",
                        "workflow5"
                    ]
                },
                {
                    "id": "regex-parser",
                    "labelEn": "Regex Parser",
                    "labelZh": "è¦å‰‡è§£æå™¨",
                    "moduleId": 0,
                    "status": "notdone",
                    "rationale": "ç›®çš„ï¼šé‡å°é«˜çµæ§‹åŒ–è³‡æ–™ï¼ˆå¦‚è²¡å ±ã€æ³•è¦ç·¨è™Ÿï¼‰é€²è¡Œç²¾ç¢ºæå–ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šä½¿ç”¨è¦å‰‡è¡¨é”å¼å¼•æ“æå–ç‰¹å®šæ ¼å¼è³‡è¨Šï¼Œè¼”åŠ© LLM è™•ç†éè‡ªç„¶èªè¨€çš„æ•¸æ“šã€‚",
                    "script": "indexing/regex_parser.py",
                    "x": 219,
                    "y": 600,
                    "workflows": [
                        "workflow2",
                        "workflow5"
                    ]
                },
                {
                    "id": "anomaly-detector",
                    "labelEn": "Anomaly Detector",
                    "labelZh": "ç•°å¸¸åµæ¸¬",
                    "moduleId": 0,
                    "status": "notdone",
                    "rationale": "ç›®çš„ï¼šç›£æ§è³‡æ–™æµçš„å¥åº·ç‹€æ³ï¼Œå³æ™‚ç™¼ç¾çˆ¬èŸ²æˆ–ä¾†æºç•°å¸¸ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šåµæ¸¬ä¾†æºç¶²ç«™æ˜¯å¦å‡ºç¾å¤§é‡ 404ã€å…§å®¹ç©ºç™½æˆ–è³‡æ–™åˆ†ä½ˆåç§»ï¼Œç¢ºä¿ç´¢å¼•åº«å¥åº·ã€‚",
                    "script": "indexing/anomaly_detector.py",
                    "x": 331,
                    "y": 336,
                    "workflows": [
                        "workflow2",
                        "workflow5"
                    ]
                },
                {
                    "id": "mod-input",
                    "labelEn": "Input",
                    "labelZh": "å…¥å£èˆ‡å®‰å…¨",
                    "moduleId": 1,
                    "status": "header",
                    "rationale": "Input æ¨¡çµ„æ˜¯ä¼æ¥­èˆ‡ä½¿ç”¨è€…æ¥å…¥ç³»çµ±çš„å®‰å…¨é–˜é“ã€‚å®ƒä¸åƒ…æ˜¯æ¥æ”¶æŒ‡ä»¤çš„çª—å£ï¼Œæ›´æ˜¯ç†è§£ä½¿ç”¨è€…æ„åœ–èˆ‡é˜²ç¯„æƒ¡æ„æ”»æ“Šçš„ç¬¬ä¸€é“é˜²ç·šï¼Œç¢ºä¿å¾ŒçºŒçš„é«˜ç®—åŠ›æ¨¡çµ„åƒ…è™•ç†å®‰å…¨ã€æ¸…æ™°ä¸”çµæ§‹åŒ–çš„è«‹æ±‚ã€‚

æ¨¡çµ„é‡é»ï¼š
â€¢ ä¼æ¥­ç´šå®‰å…¨æ€§ï¼šåœ¨ LLM æ¥è§¸è³‡æ–™å‰å³æ””æˆªæƒ¡æ„æŒ‡ä»¤ (Prompt Injection)ï¼Œä¿éšœç³»çµ±åˆè¦èˆ‡éš±ç§ã€‚
â€¢ å¤šæ¨¡æ…‹è³‡æ–™æ•´åˆï¼šæ”¯æ´ä¼æ¥­ä¸Šå‚³ç§æœ‰æ–‡ä»¶ï¼ˆPDF/Wordï¼‰ï¼Œå¯¦ç¾ã€Œå¸¶å…¥è‡ªæœ‰è³‡æ–™ (BYOD)ã€çš„å°ˆå±¬åˆ†æèƒ½åŠ›ã€‚
â€¢ ç²¾æº–æ„åœ–è­˜åˆ¥ï¼šå°‡è¤‡é›œçš„å•†æ¥­å•é¡Œæ‹†è§£ç‚ºå¯åŸ·è¡Œçš„æª¢ç´¢æ­¥é©Ÿï¼Œæå‡å›ç­”ç²¾æº–åº¦ã€‚",
                    "script": "",
                    "isModuleHeader": true,
                    "x": 984,
                    "y": 282,
                    "workflows": [
                        "workflow1",
                        "workflow3",
                        "workflow4",
                        "workflow5"
                    ]
                },
                {
                    "id": "prompt-guardrails",
                    "labelEn": "Prompt Guardrails",
                    "labelZh": "æç¤ºé˜²è­·",
                    "moduleId": 1,
                    "status": "notdone",
                    "rationale": "ç›®çš„ï¼šä¿éšœä¼æ¥­è³‡å®‰ï¼Œé˜²æ­¢æƒ¡æ„ä½¿ç”¨è€…é€éæŒ‡ä»¤è¶Šç„æˆ–ç«Šå–ç³»çµ±æ©Ÿå¯†ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šå»ºç«‹æƒ¡æ„ç‰¹å¾µåº«èˆ‡å°æŠ—æ€§æª¢æ¸¬å±¤ï¼Œåœ¨æŸ¥è©¢é€²å…¥æ ¸å¿ƒç³»çµ±å‰å³æ™‚æ””æˆªä¸¦éæ¿¾æ½›åœ¨æ”»æ“Šã€‚",
                    "script": "core/prompt_guardrails.py",
                    "x": 990,
                    "y": 367,
                    "workflows": [
                        "workflow2",
                        "workflow5"
                    ]
                },
                {
                    "id": "upload-gateway",
                    "labelEn": "Upload Gateway",
                    "labelZh": "ä¸Šå‚³é–˜é“",
                    "moduleId": 1,
                    "status": "notdone",
                    "rationale": "ç›®çš„ï¼šè®“ä¼æ¥­èƒ½å°‡å…§éƒ¨å ±å‘Šã€è²¡å ±æˆ–æ–‡ç»å°å…¥ç³»çµ±ï¼Œé€²è¡Œå°ˆå±¬çŸ¥è­˜åº«çš„åˆ†æã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šæ•´åˆ OCR èˆ‡ ETL æµç¨‹ï¼Œæ”¯æ´ PDF/Word/URL ç­‰æ ¼å¼ï¼Œè‡ªå‹•é€²è¡Œç—…æ¯’æƒæã€æ¸…æ´—èˆ‡æ–‡å­—æå–ã€‚",
                    "script": "input/upload_gateway.py",
                    "x": 996,
                    "y": 479,
                    "workflows": [
                        "workflow5"
                    ]
                },
                {
                    "id": "query-decomp",
                    "labelEn": "Query Decomposition",
                    "labelZh": "æŸ¥è©¢æ‹†è§£",
                    "moduleId": 1,
                    "status": "done",
                    "rationale": "ç›®çš„ï¼šè§£æ±ºã€Œæ¯”è¼ƒå‹ã€æˆ–ã€Œå¤šå±¤æ¬¡ã€çš„è¤‡é›œå•†æ¥­å•é¡Œï¼ˆå¦‚ï¼šæ¯”è¼ƒ A èˆ‡ B å…¬å¸çš„ Q3 è²¡å ±ï¼‰ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šä½¿ç”¨ LLM å°‡ä¸€å€‹å¤§å•é¡Œæ‹†è§£ç‚ºå¤šå€‹ç¨ç«‹çš„å­æŸ¥è©¢æ„åœ–ï¼Œç¢ºä¿æª¢ç´¢æ¨¡çµ„èƒ½ç²¾æº–èª¿é–±ä¸åŒé¢å‘çš„è³‡æ–™ã€‚",
                    "script": "chat/chatbot_interface.py",
                    "x": 1228,
                    "y": 486,
                    "workflows": [
                        "workflow1",
                        "workflow3",
                        "workflow4",
                        "workflow5"
                    ]
                },
                {
                    "id": "mod-retrieval",
                    "labelEn": "Retrieval",
                    "labelZh": "æª¢ç´¢",
                    "moduleId": 2,
                    "status": "header",
                    "rationale": "Retrieval æ¨¡çµ„è² è²¬æ ¹æ“šä½¿ç”¨è€…æŸ¥è©¢ï¼Œå¾ Storage (Indexing) æˆ–ç¶²è·¯æ‰¾åˆ°ç›¸é—œè³‡æ–™ï¼Œæä¾›çµ¦å¾ŒçºŒæ¨¡çµ„é€²è¡Œæ’åºèˆ‡æ¨è«–ã€‚

æ¨¡çµ„é‡é»ï¼š
â€¢ å·²å¯¦ä½œéƒ¨åˆ†ï¼šInternal Indexï¼Œè² è²¬å°‡ Storage è£¡çš„è³‡æ–™è½‰æ›ç‚ºå¯æŸ¥è©¢å½¢å¼ï¼Œä¾›ä¸Šå±¤æ¨¡çµ„ä½¿ç”¨ã€‚
â€¢ è¦åŠƒä¸­ï¼šWeb Search åŠŸèƒ½å°šæœªå¯¦ä½œï¼Œæœªä¾†å°‡æ”¯æ´å¾å¤–éƒ¨ç¶²è·¯æŠ“å–è³‡æ–™ï¼›æ”¯æ´å¤šå€‹è³‡æ–™ä¾†æºï¼ŒåŒ…å«ä¼æ¥­è‡ªè¨‚è³‡æ–™èˆ‡å¤–éƒ¨ç¶²è·¯ï¼Œä½œç‚ºæ··åˆæª¢ç´¢ç­–ç•¥çš„ä¸€éƒ¨åˆ†ã€‚
â€¢ æ¨¡çµ„åƒ¹å€¼ï¼šä½œç‚ºè³‡æ–™æœå°‹å¼•æ“ï¼Œæœå‹™ä¸Šå±¤çš„ Ranking èˆ‡ Reasoning æ¨¡çµ„ï¼Œç¢ºä¿å¾ŒçºŒæµç¨‹èƒ½å–å¾—ç›¸é—œè³‡è¨Šã€‚
â€¢ æ ¸å¿ƒç‰¹é»ï¼šæ”¯æ´å¤šä¾†æºæœå°‹ï¼ŒåŒ…æ‹¬ Storageã€å¤–éƒ¨ Web API ä»¥åŠä¼æ¥­è‡ªè¨‚è³‡æ–™ï¼›å¯çµåˆä¸åŒç´¢å¼•ç­–ç•¥ï¼ˆInternal Index / Qdrant / Web Searchï¼‰æä¾›å½ˆæ€§å¬å›ã€‚",
                    "script": "",
                    "isModuleHeader": true,
                    "x": 983,
                    "y": 645,
                    "workflows": [
                        "workflow1",
                        "workflow3",
                        "workflow4",
                        "workflow5"
                    ]
                },
                {
                    "id": "internal-index",
                    "labelEn": "Internal Search",
                    "labelZh": "å…§éƒ¨ç´¢å¼•",
                    "moduleId": 2,
                    "status": "partial",
                    "rationale": "ç›®çš„ï¼šæä¾›ç³»çµ±å…§éƒ¨è³‡æ–™çš„æª¢ç´¢èƒ½åŠ›ï¼Œæ”¯æ´å¾ŒçºŒæ’åºèˆ‡æ¨è«–ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šåˆ©ç”¨BM25é—œéµå­—æœå°‹æ¼”ç®—æ³•åŠLLMèªæ„æœå°‹ï¼Œå¯¦ç¾æ··åˆå¼æª¢ç´¢ã€‚",
                    "script": "core/retriever.py",
                    "x": 1017,
                    "y": 759,
                    "workflows": [
                        "workflow1",
                        "workflow3",
                        "workflow4",
                        "workflow5"
                    ]
                },
                {
                    "id": "web-search",
                    "labelEn": "Web Search",
                    "labelZh": "ç¶²è·¯æœå°‹",
                    "moduleId": 2,
                    "status": "notdone",
                    "rationale": "ç›®çš„ï¼šè£œå……å³æ™‚è³‡è¨Šï¼Œæ”¯æ´ç³»çµ±ç²å– Storage å¤–è³‡æ–™ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šæŠ“å–ç¶²è·¯è³‡æ–™å¾Œå­˜å…¥ cacheï¼Œä¾›å¾ŒçºŒåˆ†æèˆ‡æ¨è«–ä½¿ç”¨ã€‚",
                    "script": "core/web_search.py",
                    "x": 1429,
                    "y": 758,
                    "workflows": [
                        "workflow3",
                        "workflow4",
                        "workflow5"
                    ]
                },
                {
                    "id": "multi-source",
                    "labelEn": "Custom Source Search",
                    "labelZh": "å¤šæºæœå°‹",
                    "moduleId": 2,
                    "status": "notdone",
                    "rationale": "ç›®çš„ï¼šæœå°‹ç”¨æˆ¶è‡ªè¡Œä¸Šå‚³æˆ–é€£çµçš„å…§å®¹
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šæœå°‹ä¼æ¥­è‡ªè¨‚è³‡æ–™ï¼Œçµåˆå…§éƒ¨æœå°‹åŠç¶²è·¯æœå°‹ï¼Œå¯¦ç¾æ··åˆæœå°‹ç­–ç•¥ã€‚",
                    "script": "retrieval/custom_source.py",
                    "x": 1220,
                    "y": 755,
                    "workflows": [
                        "workflow3",
                        "workflow5"
                    ]
                },
                {
                    "id": "mod-ranking",
                    "labelEn": "Ranking",
                    "labelZh": "æ’åº",
                    "moduleId": 3,
                    "status": "header",
                    "rationale": "Ranking æ¨¡çµ„è² è²¬å° Retrieval å›å‚³çš„è³‡æ–™é€²è¡Œæ’åºèˆ‡ç‰¹å¾µè¨ˆç®—ï¼Œé¸å‡ºé©åˆ Reasoning æ¨¡çµ„ä½¿ç”¨çš„ top resultsã€‚

æ¨¡çµ„é‡é»ï¼š
â€¢ å·²å¯¦ä½œéƒ¨åˆ†ï¼šè¦å‰‡å¼ä¾ query é¡å‹èª¿æ•´æ¬Šé‡ï¼Œç¢ºä¿ä¸åŒæŸ¥è©¢é¡å‹å¾—åˆ°é©åˆçš„æ’åºç­–ç•¥ï¼›XGBoost æ¼”ç®—æ³•ï¼Œç”¨æ–¼çµåˆå¤šç¨®æ’åºç‰¹å¾µï¼ˆå¦‚å‘é‡ç›¸ä¼¼åº¦ã€metadataã€è¦å‰‡æ¬Šé‡ï¼‰åšç¶œåˆè©•åˆ†ï¼Œæå‡çµæœå“è³ªï¼›MMRï¼ˆMaximal Marginal Relevanceï¼‰ï¼Œç”¨ä¾†å¹³è¡¡å¤šå…ƒæ€§èˆ‡ç›¸é—œæ€§ï¼Œç¢ºä¿æ’åºçµæœå¤šæ¨£æ€§ã€‚
â€¢ è¦åŠƒä¸­ï¼šåˆ©ç”¨ LLM é€²è¡Œå‹•æ…‹æ¬Šé‡èª¿æ•´ï¼Œæœªä¾†å¯æ ¹æ“š query é¡å‹å½ˆæ€§èª¿æ•´å„æ’åºç‰¹å¾µçš„å½±éŸ¿åŠ›ï¼Œæé«˜å°å¤šæ¨£åŒ–æŸ¥è©¢çš„é©æ‡‰èƒ½åŠ›ã€‚
â€¢ æ¨¡çµ„åƒ¹å€¼/æ ¸å¿ƒç‰¹é»ï¼šRanking æ¨¡çµ„çš„å­˜åœ¨æ˜¯ç‚ºäº†ç¢ºä¿ Reasoning æ¨¡çµ„æ¥æ”¶åˆ°æœ€é©åˆçš„ top resultsï¼Œå…¼é¡§çµæœçš„å¤šå…ƒæ€§èˆ‡ç²¾ç¢ºæ€§ã€‚é€éå¤šç¨®æ¼”ç®—æ³•èˆ‡ç‰¹å¾µçµåˆï¼ŒRanking å¯æ ¹æ“šæŸ¥è©¢ç‰¹æ€§èª¿æ•´æ’åºç­–ç•¥ï¼Œæ”¯æ´ç³»çµ±å°ä¸åŒæŸ¥è©¢çš„éœ€æ±‚ã€‚",
                    "script": "",
                    "isModuleHeader": true,
                    "x": 1820,
                    "y": 354,
                    "workflows": [
                        "workflow1",
                        "workflow3",
                        "workflow5"
                    ]
                },
                {
                    "id": "mmr",
                    "labelEn": "MMR",
                    "labelZh": "MMRå¤šæ¨£æ€§",
                    "moduleId": 3,
                    "status": "done",
                    "rationale": "ç›®çš„ï¼šæ ¹æ“šæœå°‹èˆ‡æ¨è«–æ€§è³ªæ±ºå®šæ’åºï¼Œå¹³è¡¡å¤šå…ƒè§€é»èˆ‡ç²¾æº–è³‡è¨Šã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šä½¿ç”¨ MMR æ¼”ç®—æ³•åœ¨å›å‚³çµæœä¸­é¸æ“‡ top resultsï¼Œå…¼é¡§å¤šæ¨£æ€§èˆ‡ç›¸é—œæ€§ã€‚",
                    "script": "core/mmr.py",
                    "x": 1829,
                    "y": 821,
                    "workflows": [
                        "workflow1",
                        "workflow3",
                        "workflow5"
                    ]
                },
                {
                    "id": "xgboost",
                    "labelEn": "XGBoost Ranking",
                    "labelZh": "XGBoostæ’åº",
                    "moduleId": 3,
                    "status": "done",
                    "rationale": "ç›®çš„ï¼šå°‡å¤šç¨®æ’åºç‰¹å¾µç¶œåˆè©•åˆ†ï¼Œæå‡æ’åºç²¾æº–åº¦ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šä½¿ç”¨ XGBoost æ¼”ç®—æ³•çµåˆæ•¸åç¨®ç‰¹å¾µï¼ˆåŒ…æ‹¬ embeddingã€metadataã€è¦å‰‡æ¬Šé‡ç­‰ï¼‰è¨ˆç®—æ¯å€‹çµæœçš„æ’åºåˆ†æ•¸ã€‚",
                    "script": "core/xgboost_ranker.py",
                    "x": 1832,
                    "y": 698,
                    "workflows": [
                        "workflow1",
                        "workflow3",
                        "workflow5"
                    ]
                },
                {
                    "id": "rule-weight",
                    "labelEn": "Rule Weight",
                    "labelZh": "è¦å‰‡æ¬Šé‡",
                    "moduleId": 3,
                    "status": "done",
                    "rationale": "ç›®çš„ï¼šä¾ query é¡å‹èª¿æ•´ä¸åŒæ’åºç‰¹å¾µçš„å½±éŸ¿åŠ›ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šæ¡è¦å‰‡å¼ç­–ç•¥ï¼Œæ ¹æ“šæŸ¥è©¢æ€§è³ªèª¿æ•´ XGBoost ç­‰ç‰¹å¾µçš„æ¬Šé‡ï¼Œä¿è­‰æ’åºçµæœç¬¦åˆæŸ¥è©¢éœ€æ±‚ã€‚",
                    "script": "ranking/rule_weight.py",
                    "x": 1832,
                    "y": 575,
                    "workflows": [
                        "workflow1",
                        "workflow3",
                        "workflow5"
                    ]
                },
                {
                    "id": "llm-weight",
                    "labelEn": "LLM Weight",
                    "labelZh": "LLMæ¬Šé‡",
                    "moduleId": 3,
                    "status": "notdone",
                    "rationale": "ç›®çš„ï¼šæœªä¾†å¯åˆ©ç”¨èªæ„åˆ†æè‡ªå‹•èª¿æ•´æ’åºæ¬Šé‡ï¼Œé€²ä¸€æ­¥ç¬¦åˆä½¿ç”¨è€…éœ€æ±‚ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šè¨ˆç•«ä½¿ç”¨ LLM åˆ†æ query èªæ„ï¼Œèª¿æ•´å„ç‰¹å¾µæ¬Šé‡ï¼›ç³»çµ±ç”šè‡³å¯èˆ‡ä½¿ç”¨è€…äº’å‹•ï¼Œè¨è«–ä¸¦å„ªåŒ–æœå°‹çµæœã€‚",
                    "script": "ranking/llm_weight.py",
                    "x": 1830,
                    "y": 454,
                    "workflows": [
                        "workflow3",
                        "workflow5"
                    ]
                },
                {
                    "id": "mod-reasoning",
                    "labelEn": "Reasoning",
                    "labelZh": "æ¨è«–",
                    "moduleId": 4,
                    "status": "header",
                    "rationale": "Reasoning æ¨¡çµ„è² è²¬å° Retrieval + Ranking å›å‚³çš„è³‡æ–™é€²è¡Œåˆ†æã€æ•´åˆèˆ‡æ¨è«–ï¼Œç”Ÿæˆå¯é ã€å¯ç”¨çš„çµè«–æˆ–æ´å¯Ÿã€‚é€™æ˜¯æœ¬ç”¢å“æœ€é—œéµçš„ç‰¹è‰²ï¼Œä¹Ÿæ˜¯è² è²¬æŒ‡æ® retrieval å’Œ ranking çš„å¤§è…¦ï¼

æ¨¡çµ„é‡é»ï¼š
â€¢ å·²å¯¦ä½œéƒ¨åˆ†ï¼šåŸºæœ¬æ ¼å¼é™å®šèˆ‡ prompt è¨­è¨ˆï¼Œæ¨è«–äº‹å¯¦ä»¥ cached documents ç‚ºä¾æ“šã€‚
â€¢ è¦åŠƒä¸­ï¼šEvidence chain å»ºæ§‹ï¼ˆè¿½è¹¤æ¨è«–ä¾†æºèˆ‡æ­¥é©Ÿï¼‰ï¼›Knowledge boundary èˆ‡ gap detectionï¼ˆæª¢æ¸¬è³‡æ–™è¦†è“‹ç¯„åœèˆ‡ç¼ºå£ï¼‰ï¼›Iterative / recursive searchï¼ˆå¤šæ¬¡æœå°‹å®Œå–„æ¨è«–çµæœï¼‰ï¼›Domain classifierï¼ˆä¾é ˜åŸŸåˆ¤æ–·è³‡æ–™èˆ‡æ¨è«–é©ç”¨æ€§ï¼‰ï¼›Logic verificationã€logic/source transparencyï¼ˆæª¢æŸ¥æ¨è«–é‚è¼¯åŠè³‡æ–™å¼•ç”¨é€æ˜åº¦ï¼‰ï¼›Knowledge graph generationï¼ˆå«ç·¨è¼¯åŠŸèƒ½ï¼Œè¼”åŠ©ä½¿ç”¨è€…æ¢ç´¢èˆ‡ç ”ç©¶ï¼‰ã€‚
â€¢ æ¨¡çµ„åƒ¹å€¼/æ ¸å¿ƒç‰¹é»ï¼šæå‡æ¨è«–å¯é æ€§ï¼Œç¢ºä¿è³‡æ–™ä¾†æºå¯ä¿¡ã€æ¨è«–å‘¨å…¨ã€é‚è¼¯èˆ‡å¼•ç”¨æª¢æŸ¥å®Œæ•´ï¼›å¤šæ¬¡æœå°‹ä¸å—é™æ–¼ä½¿ç”¨è€…åˆå§‹ queryï¼Œå®Œå–„æ¨è«–çµæœï¼›æä¾› knowledge graph ç­‰å·¥å…·ï¼Œå”åŠ©ä½¿ç”¨è€…æ¢ç´¢ã€ç ”ç©¶èˆ‡åˆ†æè³‡æ–™ã€‚",
                    "script": "",
                    "isModuleHeader": true,
                    "x": 2490,
                    "y": 361,
                    "workflows": [
                        "workflow1",
                        "workflow3",
                        "workflow4",
                        "workflow5"
                    ]
                },
                {
                    "id": "knowledge-boundary",
                    "labelEn": "Knowledge Boundary",
                    "labelZh": "çŸ¥è­˜é‚Šç•Œ",
                    "moduleId": 4,
                    "status": "partial",
                    "rationale": "ç›®çš„ï¼šè­˜åˆ¥ç³»çµ±å¯è¦†è“‹åŠæ‡‰è©²è¦†è“‹çš„çŸ¥è­˜ç¯„åœèˆ‡ç¼ºå£ï¼ŒåŒæ™‚é¿å…æ¨è«–è¶…å‡ºå¯ä¿¡è³‡æ–™ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šåˆ†æç¾æœ‰è³‡æ–™é›†çš„è¦†è“‹ç¯„åœï¼Œæ¨™ç¤ºçŸ¥è­˜é‚Šç•Œï¼Œæç¤ºå“ªäº›é ˜åŸŸè³‡æ–™ä¸è¶³ã€‚",
                    "script": "reasoning/knowledge_boundary.py",
                    "x": 2700,
                    "y": 471,
                    "workflows": [
                        "workflow4",
                        "workflow5"
                    ]
                },
                {
                    "id": "knowledge-gap",
                    "labelEn": "Knowledge Gap",
                    "labelZh": "çŸ¥è­˜ç¼ºå£",
                    "moduleId": 4,
                    "status": "done",
                    "rationale": "ç›®çš„ï¼šåµæ¸¬è³‡è¨Šç¼ºå£æˆ–ä¸è¶³ï¼Œå”åŠ©å¾ŒçºŒè£œå……è³‡æ–™ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šåˆ†ææª¢ç´¢åŠæ’åºçµæœï¼Œæ‰¾å‡ºå¯èƒ½ç¼ºå¤±çš„è¨Šæ¯æˆ–ç©ºç™½å€åŸŸã€‚",
                    "script": "core/query_analysis/required_info.py",
                    "x": 2935,
                    "y": 858,
                    "workflows": [
                        "workflow1",
                        "workflow4",
                        "workflow5"
                    ]
                },
                {
                    "id": "iterative-search",
                    "labelEn": "Iterative Search",
                    "labelZh": "éè¿´æœå°‹",
                    "moduleId": 4,
                    "status": "partial",
                    "rationale": "ç›®çš„ï¼šå¤šæ¬¡æœå°‹ä»¥å®Œå–„æ¨è«–ï¼Œè£œè¶³åˆå§‹æŸ¥è©¢ä¸è¶³ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šå°æœªå®Œå…¨å›ç­”çš„å•é¡Œé‡è¤‡æª¢ç´¢ï¼Œæ•´åˆæ–°è³‡è¨ŠæŒçºŒæ¨è«–ã€‚",
                    "script": "chat/conversation.py",
                    "x": 2910,
                    "y": 999,
                    "workflows": [
                        "workflow1",
                        "workflow4",
                        "workflow5"
                    ]
                },
                {
                    "id": "domain-classifier",
                    "labelEn": "Domain Classifier",
                    "labelZh": "é ˜åŸŸåˆ†é¡",
                    "moduleId": 4,
                    "status": "notdone",
                    "rationale": "ç›®çš„ï¼šåˆ¤æ–·è³‡æ–™èˆ‡æ¨è«–çš„é ˜åŸŸé©ç”¨æ€§ï¼Œç¢ºä¿æ¨è«–å°ˆæ³¨æ–¼æ­£ç¢ºé ˜åŸŸã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šåˆ†æè³‡æ–™èˆ‡æŸ¥è©¢èªæ„ï¼Œæ¨™è¨»é ˜åŸŸåˆ†é¡ï¼Œä¾›æ¨è«–æµç¨‹ä½¿ç”¨ã€‚",
                    "script": "reasoning/domain_classifier.py",
                    "x": 2490,
                    "y": 471,
                    "workflows": [
                        "workflow4",
                        "workflow5"
                    ]
                },
                {
                    "id": "logic-verify",
                    "labelEn": "Logic Verification",
                    "labelZh": "é‚è¼¯é©—è­‰",
                    "moduleId": 4,
                    "status": "notdone",
                    "rationale": "ç›®çš„ï¼šæª¢æŸ¥æ¨è«–é‚è¼¯æ­£ç¢ºæ€§èˆ‡è³‡æ–™å¼•ç”¨ä¸€è‡´æ€§ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šé©—è­‰æ¨è«–æ­¥é©Ÿæ˜¯å¦ç¬¦åˆé‚è¼¯ï¼Œç¢ºä¿æ¯å€‹çµè«–çš†æœ‰å¯é ä¾æ“šã€‚",
                    "script": "reasoning/logic_verification.py",
                    "x": 2910,
                    "y": 471,
                    "workflows": [
                        "workflow4",
                        "workflow5"
                    ]
                },
                {
                    "id": "logic-transparency",
                    "labelEn": "Logic Transparency",
                    "labelZh": "é‚è¼¯é€æ˜",
                    "moduleId": 4,
                    "status": "notdone",
                    "rationale": "ç›®çš„ï¼šè®“ä½¿ç”¨è€…å¯è¿½è¹¤æ¨è«–éç¨‹åŠå¼•ç”¨ä¾†æºã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šæ¨™ç¤ºæ¨è«–æ¯æ­¥é©Ÿå°æ‡‰è³‡æ–™ä¾†æºï¼Œæä¾›å¯å¯©æ ¸çš„æ¨è«–é€æ˜åº¦ã€‚",
                    "script": "reasoning/logic_transparency.py",
                    "x": 2598,
                    "y": 959,
                    "workflows": [
                        "workflow4",
                        "workflow5"
                    ]
                },
                {
                    "id": "knowledge-graph",
                    "labelEn": "Knowledge Graph",
                    "labelZh": "çŸ¥è­˜åœ–è­œ",
                    "moduleId": 4,
                    "status": "notdone",
                    "rationale": "ç›®çš„ï¼šè¼”åŠ©ä½¿ç”¨è€…æ¢ç´¢èˆ‡ç ”ç©¶ï¼Œå°‡æ¨è«–è³‡æ–™å¯è¦–åŒ–ç‚ºçŸ¥è­˜åœ–ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šç”Ÿæˆç¯€é»èˆ‡é—œè¯åœ–ï¼Œä¸¦æä¾›ç·¨è¼¯åŠŸèƒ½ä¾›ä½¿ç”¨è€…æ•´ç†èˆ‡æ¢ç´¢è³‡æ–™ã€‚",
                    "script": "reasoning/knowledge_graph.py",
                    "x": 2700,
                    "y": 801,
                    "workflows": [
                        "workflow5"
                    ]
                },
                {
                    "id": "synthesis",
                    "labelEn": "Synthesis",
                    "labelZh": "ç¶œåˆç”Ÿæˆ",
                    "moduleId": 4,
                    "status": "notdone",
                    "rationale": "ç›®çš„ï¼šå°‡ç¢ç‰‡åŒ–çš„è­‰æ“šèˆ‡æ¨è«–æ•´åˆæˆæµæš¢ã€å…·æ´å¯ŸåŠ›çš„æœ€çµ‚å›æ‡‰ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šåŸºæ–¼ Evidence Chain èˆ‡äº‹å¯¦è³‡æ–™ï¼Œé€é Prompt Engineering æ’°å¯«ç¬¦åˆä½¿ç”¨è€…é–±è®€ç¿’æ…£çš„å®Œæ•´æ–‡ç« æˆ–æ‘˜è¦ã€‚",
                    "script": "reasoning/synthesis.py",
                    "x": 2662,
                    "y": 637,
                    "workflows": [
                        "workflow1",
                        "workflow4",
                        "workflow5"
                    ]
                },
                {
                    "id": "mod-output",
                    "labelEn": "Output",
                    "labelZh": "è¼¸å‡ºèˆ‡ä»‹é¢",
                    "moduleId": 5,
                    "status": "header",
                    "rationale": "Output æ¨¡çµ„æ˜¯å°‡è¤‡é›œçš„æ¨è«–çµæœè½‰åŒ–ç‚ºå•†æ¥­åƒ¹å€¼çš„é—œéµä»‹é¢ã€‚å®ƒä¸åƒ…æä¾›è¦–è¦ºåŒ–çš„åˆ†æå·¥å…·ï¼Œæ›´è³¦èƒ½åª’é«”å¤¥ä¼´èˆ‡ä¼æ¥­å®¢æˆ¶ï¼Œé€éæ•¸æ“šå„€è¡¨æ¿èˆ‡å”ä½œç®¡ç†åŠŸèƒ½ï¼Œå°‡ AI æ´å¯Ÿè½å¯¦åˆ°æ±ºç­–æµç¨‹ä¸­ã€‚

æ¨¡çµ„é‡é»ï¼š
â€¢ æ¨è«–å¯è¦–åŒ–ï¼šå°‡é»‘ç›’å­çš„æ¨è«–éç¨‹è½‰ç‚ºå¯äº’å‹•çš„çŸ¥è­˜åœ–è­œèˆ‡å¿ƒæ™ºåœ–ï¼Œè¼”åŠ©ç ”ç©¶äººå“¡æ¢ç´¢ã€‚
â€¢ åª’é«”è³¦èƒ½ï¼šæä¾›å°ˆå±¬å„€è¡¨æ¿ï¼Œè®“åª’é«”å¤¥ä¼´æŒæ¡è®€è€…é—œæ³¨çš„ç†±é»è­°é¡Œèˆ‡å°æµæˆæ•ˆã€‚
â€¢ å”ä½œèˆ‡ç®¡ç†ï¼šæ”¯æ´åœ˜éšŠå”ä½œã€è³‡æ–™ä¾†æºç®¡ç†èˆ‡å¤šæ ¼å¼åŒ¯å‡ºï¼Œç„¡ç¸«æ•´åˆè‡³å·¥ä½œæµã€‚",
                    "script": "",
                    "isModuleHeader": true,
                    "x": 3654,
                    "y": 381,
                    "workflows": [
                        "workflow1",
                        "workflow3",
                        "workflow4",
                        "workflow5"
                    ]
                },
                {
                    "id": "sys-api",
                    "labelEn": "API Gateway",
                    "labelZh": "APIé–˜é“",
                    "moduleId": 5,
                    "status": "done",
                    "rationale": "ç›®çš„ï¼šä½œç‚ºç³»çµ±èˆ‡ç¬¬ä¸‰æ–¹æœå‹™çš„æ¨™æº–åŒ–æ©‹æ¨‘ï¼Œæ”¯æ´å½ˆæ€§æ“´å……ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šåŸºæ–¼ FastAPI çš„é«˜æ•ˆèƒ½è·¯ç”±æ ¸å¿ƒï¼Œè™•ç†èº«åˆ†é©—è­‰ã€æµé‡æ§åˆ¶èˆ‡ API è«‹æ±‚æ´¾ç™¼ã€‚",
                    "script": "webserver/main.py",
                    "x": 3656,
                    "y": 494,
                    "workflows": [
                        "workflow1",
                        "workflow3",
                        "workflow5"
                    ]
                },
                {
                    "id": "sys-fe",
                    "labelEn": "Frontend UI",
                    "labelZh": "å‰ç«¯ä»‹é¢",
                    "moduleId": 5,
                    "status": "partial",
                    "rationale": "ç›®çš„ï¼šæä¾›ç›´è¦ºçš„æ“ä½œé«”é©—ï¼Œè®“éæŠ€è¡“äººå“¡ä¹Ÿèƒ½è¼•é¬†ä½¿ç”¨ AI æ¨è«–ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šæ•´åˆå°è©±ã€å¼•ç”¨é è¦½èˆ‡æ¨¡å¼åˆ‡æ›çš„ç¶œåˆä»‹é¢ï¼Œæ”¯æ´éŸ¿æ‡‰å¼è¨­è¨ˆã€‚",
                    "script": "static/news-search-prototype.html",
                    "x": 3864,
                    "y": 491,
                    "workflows": [
                        "workflow1",
                        "workflow3",
                        "workflow4",
                        "workflow5"
                    ]
                },
                {
                    "id": "llm-safety-net",
                    "labelEn": "LLM Safety Net",
                    "labelZh": "LLMå®‰å…¨ç¶²",
                    "moduleId": 5,
                    "status": "notdone",
                    "rationale": "ç›®çš„ï¼šç¢ºä¿è¼¸å‡ºçš„åˆè¦æ€§èˆ‡å®‰å…¨æ€§ï¼Œä¿è­·å“ç‰Œè²è­½ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šä½œç‚ºè¼¸å‡ºçš„æœ€å¾Œä¸€é“é–˜é–€ï¼Œè‡ªå‹•æª¢æ¸¬ä¸¦éæ¿¾ PII (å€‹è³‡)ã€æœ‰å®³å…§å®¹æˆ–ä¸ç•¶å»ºè­°ã€‚",
                    "script": "output/llm_safety_net.py",
                    "x": 3864,
                    "y": 821,
                    "workflows": [
                        "workflow5"
                    ]
                },
                {
                    "id": "visualizer-engine",
                    "labelEn": "Visualizer Engine",
                    "labelZh": "è¦–è¦ºåŒ–å¼•æ“",
                    "moduleId": 5,
                    "status": "notdone",
                    "rationale": "ç›®çš„ï¼šå°‡è¤‡é›œçš„é‚è¼¯æ¨æ¼”è½‰åŒ–ç‚ºç›´è§€çš„åœ–è¡¨ï¼ŒåŠ é€Ÿè³‡è¨Šå¸æ”¶ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šå‰ç«¯æ¸²æŸ“å¼•æ“ï¼Œè² è²¬ç¹ªè£½å‹•æ…‹çš„æ¨è«–éˆ (Tree View) èˆ‡çŸ¥è­˜åœ–è­œ (Knowledge Graph)ï¼Œæ”¯æ´ç¸®æ”¾èˆ‡é»æ“Šäº’å‹•ã€‚",
                    "script": "output/visualizer_engine.py",
                    "x": 4074,
                    "y": 656,
                    "workflows": [
                        "workflow5"
                    ]
                },
                {
                    "id": "graph-editor",
                    "labelEn": "Graph Editor",
                    "labelZh": "åœ–è­œç·¨è¼¯å™¨",
                    "moduleId": 5,
                    "status": "notdone",
                    "rationale": "ç›®çš„ï¼šè®“ä½¿ç”¨è€…èƒ½åƒèˆ‡çŸ¥è­˜å»ºæ§‹ï¼Œå°‡ AI æˆæœè½‰åŒ–ç‚ºå€‹äººçŸ¥è­˜è³‡ç”¢ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šæä¾›äº’å‹•å¼ç·¨è¼¯å·¥å…·ï¼Œå…è¨±ä½¿ç”¨è€…å°çŸ¥è­˜åœ–è­œé€²è¡Œç¯€é»æ–°å¢ã€è¨»é‡‹ä¿®æ”¹èˆ‡é—œè¯èª¿æ•´ã€‚",
                    "script": "output/graph_editor.py",
                    "x": 3864,
                    "y": 656,
                    "workflows": [
                        "workflow5"
                    ]
                },
                {
                    "id": "dashboard-ui",
                    "labelEn": "Dashboard UI",
                    "labelZh": "å„€è¡¨æ¿ä»‹é¢",
                    "moduleId": 5,
                    "status": "notdone",
                    "rationale": "ç›®çš„ï¼šç‚ºåª’é«”èˆ‡ä¼æ¥­æä¾›æ±ºç­–è¼”åŠ©ï¼ŒæŒæ¡è­°é¡Œè¶¨å‹¢èˆ‡æˆæ•ˆã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šè¦–è¦ºåŒ–æ•¸æ“šçœ‹æ¿ï¼Œå±•ç¤ºç†±é–€é—œéµå­—ã€è®€è€…åˆ†ç¾¤ã€å°æµè½‰æ›ç‡ç­‰é—œéµæŒ‡æ¨™ã€‚",
                    "script": "output/dashboard_ui.py",
                    "x": 3654,
                    "y": 656,
                    "workflows": [
                        "workflow5"
                    ]
                },
                {
                    "id": "source-collab-mgr",
                    "labelEn": "Source & Collab Mgr",
                    "labelZh": "ä¾†æºå”ä½œç®¡ç†",
                    "moduleId": 5,
                    "status": "notdone",
                    "rationale": "ç›®çš„ï¼šæä¾›éˆæ´»çš„è³‡æ–™æ²»ç†èˆ‡åœ˜éšŠå”ä½œç’°å¢ƒã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šç®¡ç†ä»‹é¢ï¼Œæ”¯æ´è³‡æ–™ä¾†æºé–‹é—œ (Domain Allowlist)ã€åœ˜éšŠæˆå“¡æ¬Šé™è¨­å®šåŠå”ä½œç‰ˆæœ¬æ§åˆ¶ã€‚",
                    "script": "output/source_collab_manager.py",
                    "x": 4074,
                    "y": 491,
                    "workflows": [
                        "workflow5"
                    ]
                },
                {
                    "id": "export-service",
                    "labelEn": "Export Service",
                    "labelZh": "åŒ¯å‡ºæœå‹™",
                    "moduleId": 5,
                    "status": "notdone",
                    "rationale": "ç›®çš„ï¼šæ‰“ç ´å·¥å…·è—©ç±¬ï¼Œè®“ AI ç”¢å‡ºèƒ½ç›´æ¥æ‡‰ç”¨æ–¼å ±å‘Šèˆ‡ç°¡å ±ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šæ”¯æ´å°‡å°è©±èˆ‡åœ–è­œåŒ¯å‡ºç‚º Wordã€PPTã€Excel æ ¼å¼ï¼Œæˆ–ç”Ÿæˆæ°¸ä¹…åˆ†äº«é€£çµ (Permalink)ã€‚",
                    "script": "output/export_service.py",
                    "x": 3654,
                    "y": 821,
                    "workflows": [
                        "workflow5"
                    ]
                },
                {
                    "id": "mod-infrastructure",
                    "labelEn": "Infrastructure",
                    "labelZh": "åŸºç¤è¨­æ–½",
                    "moduleId": 6,
                    "status": "header",
                    "rationale": "æ­¤å€å¡ŠåŒ…å«æ”¯æ’å…¨ç³»çµ±é‹ä½œçš„åº•å±¤æ ¸å¿ƒæœå‹™ï¼Œç‚ºæ‰€æœ‰æ¨¡çµ„æä¾›ç®—åŠ›èˆ‡æ•¸æ“šæ”¯æŒï¼Œç¢ºä¿ç³»çµ±çš„é«˜å¯ç”¨æ€§èˆ‡å¯è§€æ¸¬æ€§ã€‚",
                    "script": "",
                    "isModuleHeader": true,
                    "x": 957,
                    "y": 35,
                    "workflows": [
                        "workflow1",
                        "workflow5"
                    ]
                },
                {
                    "id": "sys-llm",
                    "labelEn": "LLM Service",
                    "labelZh": "LLMæœå‹™",
                    "moduleId": 6,
                    "status": "done",
                    "rationale": "ç›®çš„ï¼šæä¾›å…¨ç³»çµ±é€šç”¨çš„é«˜éšèªçŸ¥èˆ‡ç”Ÿæˆèƒ½åŠ›ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šå°è£å¤šç¨®æ¨¡å‹ (GPT-4/Claude) APIï¼Œçµ±ä¸€ç®¡ç† Token é ç®—èˆ‡ Context Windowï¼Œæœå‹™å…¨ç³»çµ±å„æ¨¡çµ„ã€‚",
                    "script": "core/llm_client.py",
                    "x": 2109,
                    "y": 43,
                    "workflows": [
                        "workflow1",
                        "workflow4",
                        "workflow5"
                    ]
                },
                {
                    "id": "sys-ana",
                    "labelEn": "Analytics Engine",
                    "labelZh": "åˆ†æå¼•æ“",
                    "moduleId": 6,
                    "status": "done",
                    "rationale": "ç›®çš„ï¼šé©…å‹•ç”¢å“å„ªåŒ–çš„æ•¸æ“šå¤§è…¦ï¼Œå¯¦ç¾æ•¸æ“šé©…å‹•çš„æ±ºç­–ã€‚
æŠ€è¡“/åŠŸèƒ½å¯¦ç¾ï¼šå…¨åŸŸæ•¸æ“šæ”¶é›†å™¨ï¼Œè¿½è¹¤æª¢ç´¢å“è³ªã€Ranking æ¬Šé‡åˆ†ä½ˆèˆ‡ä½¿ç”¨è€…äº’å‹•è¡Œç‚ºï¼Œç‚º Dashboard æä¾›é‹ç®—åŸºç¤ï¼Œä¸¦æ”¯æ´é—œéµå­—è¿½è¹¤é€šçŸ¥ã€‚",
                    "script": "core/query_logger.py",
                    "x": 1409,
                    "y": 83,
                    "workflows": [
                        "workflow5"
                    ]
                },
                {
                    "id": "node-1765349715587",
                    "labelEn": "Multi-search Integrator",
                    "labelZh": "å¤šä¾†æºæœå°‹æ•´åˆ",
                    "moduleId": 2,
                    "status": "notdone",
                    "rationale": "",
                    "script": "core/integrator.py",
                    "x": 1213,
                    "y": 904,
                    "workflows": [
                        "workflow5"
                    ]
                }
            ],
            "edges": [
                {
                    "from": "sys-api",
                    "to": "knowledge-gap"
                },
                {
                    "from": "sys-vec",
                    "to": "internal-index"
                },
                {
                    "from": "xgboost",
                    "to": "mmr"
                },
                {
                    "from": "synthesis",
                    "to": "sys-api"
                },
                {
                    "from": "sys-api",
                    "to": "sys-fe"
                },
                {
                    "from": "llm-weight",
                    "to": "rule-weight"
                },
                {
                    "from": "rule-weight",
                    "to": "xgboost"
                },
                {
                    "from": "domain-allowlist",
                    "to": "auto-crawler"
                },
                {
                    "from": "auto-crawler",
                    "to": "regex-parser"
                },
                {
                    "from": "regex-parser",
                    "to": "quality-gate"
                },
                {
                    "from": "quality-gate",
                    "to": "light-ner"
                },
                {
                    "from": "light-ner",
                    "to": "data-chunking"
                },
                {
                    "from": "anomaly-detector",
                    "to": "auto-crawler"
                },
                {
                    "from": "auto-crawler",
                    "to": "format-detect"
                },
                {
                    "from": "src-auth",
                    "to": "auto-crawler"
                },
                {
                    "from": "format-detect",
                    "to": "quality-gate"
                },
                {
                    "from": "data-chunking",
                    "to": "sys-vec"
                },
                {
                    "from": "prompt-guardrails",
                    "to": "query-decomp"
                },
                {
                    "from": "upload-gateway",
                    "to": "sys-vec"
                },
                {
                    "from": "query-decomp",
                    "to": "internal-index"
                },
                {
                    "from": "query-decomp",
                    "to": "web-search"
                },
                {
                    "from": "query-decomp",
                    "to": "multi-source"
                },
                {
                    "from": "internal-index",
                    "to": "node-1765349715587"
                },
                {
                    "from": "web-search",
                    "to": "node-1765349715587"
                },
                {
                    "from": "multi-source",
                    "to": "node-1765349715587"
                },
                {
                    "from": "sys-db",
                    "to": "sys-ana"
                },
                {
                    "from": "sqlite-dev",
                    "to": "sys-ana"
                },
                {
                    "from": "sys-ana",
                    "to": "user-data"
                },
                {
                    "from": "node-1765349715587",
                    "to": "llm-weight"
                }
            ],
            "moduleBoxes": [
                {
                    "x": 44,
                    "y": 193,
                    "width": 849,
                    "height": 959
                },
                {
                    "x": 974,
                    "y": 272,
                    "width": 438,
                    "height": 318
                },
                {
                    "x": 973,
                    "y": 635,
                    "width": 647,
                    "height": 386
                },
                {
                    "x": 1810,
                    "y": 344,
                    "width": 411,
                    "height": 644
                },
                {
                    "x": 2480,
                    "y": 351,
                    "width": 650,
                    "height": 790
                },
                {
                    "x": 3644,
                    "y": 371,
                    "width": 650,
                    "height": 625
                },
                {
                    "x": 943,
                    "y": 20,
                    "width": 1705,
                    "height": 227
                }
            ]
        };

        let currentWorkflow = 'workflow1', selectedNode = null;
        const config = { nodeWidth: 180, nodeHeight: 80, levelGap: 500, nodeGap: 100, marginX: 100, marginY: 150 };

        function calculateLayout() {
            const levels = {};
            let minLevel = 0;
            graphData.nodes.forEach(n => { if (n.level < minLevel) minLevel = n.level; });
            graphData.nodes.forEach(n => { if (!levels[n.level]) levels[n.level] = []; levels[n.level].push(n); });
            graphData.nodes.forEach(n => {
                const levelNodes = levels[n.level], idx = levelNodes.indexOf(n);
                const totalH = levelNodes.length * config.nodeHeight + (levelNodes.length - 1) * config.nodeGap;
                n.x = config.marginX + (n.level - minLevel) * config.levelGap;
                n.y = config.marginY + (idx * (config.nodeHeight + config.nodeGap)) + (1500 - totalH) / 2;
            });
        }

        function positionLegend() {
            const maxX = Math.max(...graphData.nodes.map(n => n.x + config.nodeWidth));
            const legend = document.querySelector('.legend');
            legend.style.left = (maxX + 50) + 'px';
            legend.style.top = '20px';
        }

        function drawGraph() { calculateLayout(); positionLegend(); drawEdges(); drawNodes(); }

        function drawEdges() {
            const eg = document.getElementById('edges-group');
            eg.innerHTML = '';
            (graphData.edges[currentWorkflow] || []).forEach(e => {
                const from = graphData.nodes.find(n => n.id === e.from), to = graphData.nodes.find(n => n.id === e.to);
                if (!from || !to) return;
                const p = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                let d;
                if (e.type === 'feedback') {
                    const x1 = from.x + config.nodeWidth / 2, y1 = from.y, x2 = to.x + config.nodeWidth / 2, y2 = to.y;
                    const cpY = Math.min(y1, y2) - 150;
                    d = `M ${x1} ${y1} C ${x1} ${cpY}, ${x2} ${cpY}, ${x2} ${y2}`;
                } else {
                    const x1 = from.x + config.nodeWidth, y1 = from.y + config.nodeHeight / 2;
                    const x2 = to.x, y2 = to.y + config.nodeHeight / 2, midX = (x1 + x2) / 2;
                    d = `M ${x1} ${y1} C ${midX} ${y1}, ${midX} ${y2}, ${x2} ${y2}`;
                }
                p.setAttribute('d', d);
                p.setAttribute('class', e.type === 'feedback' ? 'edge feedback' : 'edge');
                eg.appendChild(p);
            });
        }

        function drawNodes() {
            const ng = document.getElementById('nodes-group');
            ng.innerHTML = '';
            graphData.nodes.forEach(node => {
                const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                g.setAttribute('class', 'node');
                g.setAttribute('data-id', node.id);
                const r = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                r.setAttribute('class', 'node-rect');
                r.setAttribute('x', node.x); r.setAttribute('y', node.y);
                r.setAttribute('width', config.nodeWidth); r.setAttribute('height', config.nodeHeight);
                g.appendChild(r);
                const l = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                l.setAttribute('class', 'node-text');
                l.setAttribute('x', node.x + config.nodeWidth / 2);
                l.setAttribute('y', node.y + config.nodeHeight / 2 - 5);
                l.setAttribute('text-anchor', 'middle');
                l.textContent = node.label;
                g.appendChild(l);
                if (node.script) {
                    const s = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    s.setAttribute('class', 'node-script');
                    s.setAttribute('x', node.x + config.nodeWidth / 2);
                    s.setAttribute('y', node.y + config.nodeHeight / 2 + 15);
                    s.setAttribute('text-anchor', 'middle');
                    s.textContent = node.script;
                    g.appendChild(s);
                }
                const tb = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                tb.setAttribute('class', 'toggle-btn');
                const c = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                c.setAttribute('class', 'toggle-circle');
                c.setAttribute('cx', node.x + config.nodeWidth - 15);
                c.setAttribute('cy', node.y + 15);
                c.setAttribute('r', 12);
                tb.appendChild(c);
                const i = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                i.setAttribute('class', 'toggle-icon');
                i.setAttribute('x', node.x + config.nodeWidth - 15);
                i.setAttribute('y', node.y + 20);
                i.setAttribute('text-anchor', 'middle');
                i.textContent = 'i';
                tb.appendChild(i);
                tb.addEventListener('click', e => { e.stopPropagation(); showInfoPanel(node); });
                g.appendChild(tb);
                g.addEventListener('click', () => selectNode(node));
                ng.appendChild(g);
            });
        }

        function selectNode(node) {
            document.querySelectorAll('.node').forEach(n => n.classList.remove('selected', 'same-level', 'child-level'));
            selectedNode = node;
            document.querySelector(`.node[data-id="${node.id}"]`).classList.add('selected');
            graphData.nodes.forEach(n => {
                if (n.level === node.level && n.id !== node.id) document.querySelector(`.node[data-id="${n.id}"]`).classList.add('same-level');
            });
            const children = (graphData.edges[currentWorkflow] || []).filter(e => e.from === node.id).map(e => e.to);
            children.forEach(cid => { const el = document.querySelector(`.node[data-id="${cid}"]`); if (el) el.classList.add('child-level'); });
        }

        function showInfoPanel(node) {
            const panel = document.getElementById('info-panel');
            document.getElementById('info-title').textContent = node.label;
            document.getElementById('info-content').textContent = node.rationale;
            panel.style.left = (node.x + config.nodeWidth + 20) + 'px';
            panel.style.top = node.y + 'px';
            panel.classList.add('visible');
        }

        function closeInfoPanel() { document.getElementById('info-panel').classList.remove('visible'); }

        function switchWorkflow(wid) {
            currentWorkflow = 'workflow' + wid;
            document.querySelectorAll('.workflow-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.workflow === wid) btn.classList.add('active');
            });
            drawGraph();
        }

        document.addEventListener('DOMContentLoaded', () => {
            drawGraph();
            document.querySelectorAll('.workflow-btn').forEach(btn => btn.addEventListener('click', () => switchWorkflow(btn.dataset.workflow)));
            document.addEventListener('click', e => { if (!e.target.closest('.info-panel') && !e.target.closest('.toggle-btn')) closeInfoPanel(); });
        });
    </script>
</body>

</html>