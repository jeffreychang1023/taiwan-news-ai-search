# Bug Fix Plan

> åŸºæ–¼ bug-investigations.md ä¸­ 5 å€‹ Agent çš„èª¿æŸ¥çµæœèˆ‡ Dev è©•èª
> å»ºç«‹æ—¥æœŸï¼š2026-01-29

---

## ç›®éŒ„

- [P0 - ç«‹å³ä¿®å¾©](#p0---ç«‹å³ä¿®å¾©)
- [P1 - é«˜å„ªå…ˆ](#p1---é«˜å„ªå…ˆ)
- [P2 - ä¸­å„ªå…ˆ](#p2---ä¸­å„ªå…ˆ)
- [P3 - ä½å„ªå…ˆ / åŠŸèƒ½é™åˆ¶](#p3---ä½å„ªå…ˆ--åŠŸèƒ½é™åˆ¶)

---

## P0 - ç«‹å³ä¿®å¾©

### Bug #1: æ—¥æœŸè¬Šç¨±å•é¡Œ

**User Report**: è‡ªç”±å°è©±è©¢å•ä»Šå¤©æ—¥æœŸï¼Œå°±ç®—å‰é¢ prompt æœ‰ dynamic dateï¼Œé‚„æ˜¯æœƒæ ¹æ“šæœå°‹çµæœå…§å®¹è¬Šç¨±æ—¥æœŸã€‚

**Agent å…±è­˜**: 5/5 ç¢ºèªã€‚`generate_answer.py:631-686` ä¸‰å€‹ prompt è®Šé«”å‡ç„¡æ—¥æœŸæ³¨å…¥ã€‚

**Dev æŒ‡ä»¤**: æŒ‰ç…§ Agent å»ºè­°ä¿®å¾©ã€‚

**ä¿®å¾©è¨ˆç•«**:
- **æª”æ¡ˆ**: `code/python/methods/generate_answer.py`
- **ä¿®æ”¹ä½ç½®**: `synthesize_free_conversation()` æ–¹æ³•ï¼Œline ~631
- **åšæ³•**: åœ¨ä¸‰å€‹ prompt è®Šé«”ï¼ˆ`has_research_report`ã€`has_cached_articles`ã€`else`ï¼‰é–‹é ­åŠ å…¥ç•¶å‰æ—¥æœŸï¼š
  ```python
  from datetime import datetime
  current_date = datetime.now().strftime("%Y-%m-%d")
  date_context = f"\n\n**ä»Šå¤©çš„æ—¥æœŸæ˜¯ï¼š{current_date}**\nå¦‚æœç”¨æˆ¶è©¢å•æ—¥æœŸç›¸é—œå•é¡Œï¼Œè«‹ä½¿ç”¨æ­¤æ—¥æœŸï¼Œä¸è¦å¾æœå°‹çµæœä¸­æ¨æ¸¬æ—¥æœŸã€‚\n"
  ```
- **é©—è­‰**: Free Conversation æ¨¡å¼å•ã€Œä»Šå¤©å¹¾æœˆå¹¾è™Ÿï¼Ÿã€ï¼Œç¢ºèªå›ç­”æ­£ç¢ºæ—¥æœŸã€‚

---

### Bug #6: æ™‚é–“ç¯„åœè¨ˆç®—éŒ¯èª¤ï¼ˆä¸­æ–‡æ•¸å­— + prefix ä¸ä¸€è‡´ï¼‰

**User Report**: å•ã€ŒMomoè¿‘å…©å¹´æœƒå“¡ç¶“ç‡Ÿç­–ç•¥ã€ï¼Œç«Ÿç„¶åªæœå°‹ä¸€å¹´ç¯„åœã€‚

**Agent å…±è­˜**: 5/5 ç¢ºèªã€‚8 å€‹ `_zh` regex å…¨éƒ¨åªåŒ¹é… `\d+`ï¼Œç„¡æ³•è™•ç†ä¸­æ–‡æ•¸å­—ã€‚å¦å¤– prefix ä¸ä¸€è‡´ï¼š`last_x_days_zh`/`last_x_weeks_zh` åªç”¨ `æœ€è¿‘`ï¼Œä½† `last_x_months_zh`/`last_x_years_zh` ç”¨ `(?:è¿‘|æœ€è¿‘)`ã€‚

**Dev æŒ‡ä»¤**: æŒ‰ç…§ Agent å»ºè­°ä¿®å¾©ï¼ˆä¹‹å‰çš„ hardcode 365/730 å¤©åšæ³•ä¸å¤ å®Œå–„ï¼‰ã€‚

**ä¿®å¾©è¨ˆç•«**:
- **æª”æ¡ˆ**: `code/python/core/query_analysis/time_range_extractor.py`
- **ä¿®æ”¹ 1 â€” ä¸­æ–‡æ•¸å­—æ˜ å°„**ï¼ˆæ–°å¢ helper functionï¼‰:
  ```python
  CHINESE_NUMBERS = {
      'ä¸€': 1, 'äºŒ': 2, 'å…©': 2, 'ä¸‰': 3, 'å››': 4, 'äº”': 5,
      'å…­': 6, 'ä¸ƒ': 7, 'å…«': 8, 'ä¹': 9, 'å': 10,
      'åä¸€': 11, 'åäºŒ': 12
  }

  def parse_number(s):
      """è§£æé˜¿æ‹‰ä¼¯æ•¸å­—æˆ–ä¸­æ–‡æ•¸å­—"""
      if s in CHINESE_NUMBERS:
          return CHINESE_NUMBERS[s]
      return int(s)
  ```
- **ä¿®æ”¹ 2 â€” æ›´æ–°æ‰€æœ‰ 8 å€‹ `_zh` regex**ï¼Œå°‡ `(\d+)` æ”¹ç‚º `([ä¸€äºŒå…©ä¸‰å››äº”å…­ä¸ƒå…«ä¹å\d]+)`
- **ä¿®æ”¹ 3 â€” çµ±ä¸€ prefix**ï¼Œæ‰€æœ‰ `last_x_*_zh` çµ±ä¸€ç‚º `(?:è¿‘|æœ€è¿‘)`
- **ä¿®æ”¹ 4 â€” æ›´æ–°è§£æé‚è¼¯**ï¼Œå°‡ `int(match.group(1))` æ”¹ç‚º `parse_number(match.group(1))`
- **å—å½±éŸ¿çš„ 8 å€‹ regex**:
  - `past_x_days_zh`, `last_x_days_zh`
  - `past_x_weeks_zh`, `last_x_weeks_zh`
  - `past_x_months_zh`, `last_x_months_zh`
  - `past_x_years_zh`, `last_x_years_zh`
- **é©—è­‰**: æ¸¬è©¦ã€Œè¿‘å…©å¹´ã€â†’730å¤©ã€ã€Œéå»ä¸‰å€‹æœˆã€â†’90å¤©ã€ã€Œæœ€è¿‘äº”å¤©ã€â†’5å¤©ã€ã€Œè¿‘ 2 å¹´ã€â†’730å¤©ã€‚

---

### Bug #10: Mac è¼¸å…¥æ³• Enter å•é¡Œ

**User Report**: MacBook æ‰“å­—è¦æŒ‰ Enter é¸å­—ï¼Œä½†æŒ‰ä¸‹å»ä¸€æ¬¡å°±åŒæ™‚é€å‡ºäº†ã€‚å¤šä½ç”¨æˆ¶åæ˜ ã€‚

**Agent å…±è­˜**: 5/5 ç¢ºèªã€‚`news-search.js` å®Œå…¨æ²’æœ‰ `compositionstart`/`compositionend`/`isComposing` è™•ç†ã€‚

**Dev æŒ‡ä»¤**: æŒ‰ç…§ Agent å»ºè­°ä¿®å¾©ã€‚

**ä¿®å¾©è¨ˆç•«**:
- **æª”æ¡ˆ**: `static/news-search.js`
- **ä¿®æ”¹ä½ç½®**: æ‰€æœ‰ `keydown` â†’ `Enter` çš„ event listener
- **åšæ³•**: ä½¿ç”¨ `e.isComposing` å±¬æ€§ï¼ˆç¾ä»£ç€è¦½å™¨å»£æ³›æ”¯æ´ï¼Œæ¯”æ‰‹å‹•è¿½è¹¤ `compositionstart`/`compositionend` æ›´ç°¡æ½”ï¼‰ï¼š
  ```javascript
  searchInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey && !e.isComposing) {
          e.preventDefault();
          performSearch();
      }
  });
  ```
- **æ³¨æ„**: æœå°‹æ•´å€‹ JS æª”æ¡ˆä¸­æ‰€æœ‰ `keydown` + `Enter` çš„ listenerï¼Œå…¨éƒ¨åŠ ä¸Š `!e.isComposing` æª¢æŸ¥ã€‚åŒ…æ‹¬æœå°‹æ¡†ã€Free Conversation è¼¸å…¥æ¡†ç­‰ã€‚
- **é©—è­‰**: Mac ä¸Šä½¿ç”¨æ³¨éŸ³/å€‰é ¡è¼¸å…¥æ³•ï¼ŒæŒ‰ Enter é¸å­—æ™‚ä¸è§¸ç™¼æœå°‹ã€‚

---

### Bug #24: å›è¦†æ²’æœ‰æ’ç‰ˆæ›è¡Œ

**User Report**: è‡ªç”±å°è©±çš„å›è¦†æ²’æœ‰æ’ç‰ˆï¼Œä¸€æ•´ä¸²æ–‡å­—æ²’æœ‰æ›è¡Œï¼Œåˆ—è¡¨ï¼ˆ1,2,3ï¼‰ä¹Ÿæ²’æœ‰æ›è¡Œã€‚

**Agent å…±è­˜**: 4/5 ç¢ºèªä¿®å¾©æ–¹å‘ï¼ˆAgent #1 æ–¹å‘æœ‰èª¤ï¼‰ã€‚å‰ç«¯å·²ç”¨ `marked.parse()` åš Markdown æ¸²æŸ“ï¼Œå•é¡Œåœ¨ prompt æ²’æœ‰è¦æ±‚ LLM ä½¿ç”¨ Markdown æ ¼å¼ã€‚

**Dev æŒ‡ä»¤**: Dev å·²æŸç¨®ç¨‹åº¦ä¿®å¾©ï¼Œéœ€å†æ¬¡æª¢æŸ¥å•é¡Œæ˜¯å¦ä»ç„¶å­˜åœ¨ã€‚

**ä¿®å¾©è¨ˆç•«**:
- **æ­¥é©Ÿ 1**: æª¢æŸ¥ç›®å‰ `synthesize_free_conversation()` çš„ prompt æ˜¯å¦å·²åŒ…å« Markdown æ ¼å¼è¦æ±‚
- **æ­¥é©Ÿ 2**: å¦‚æœé‚„æ²’æœ‰ï¼Œåœ¨ä¸‰å€‹ prompt è®Šé«”ä¸­åŠ å…¥ï¼š
  ```
  è«‹ä½¿ç”¨ Markdown æ ¼å¼å›ç­”ã€‚æ®µè½ä¹‹é–“ç”¨ç©ºè¡Œåˆ†éš”ï¼Œåˆ—è¡¨ä½¿ç”¨ - æˆ– 1. 2. 3. æ ¼å¼ï¼Œé‡è¦æ¦‚å¿µå¯ç”¨ **ç²—é«”** å¼·èª¿ã€‚
  ```
- **æ­¥é©Ÿ 3**: å¯¦éš›æ¸¬è©¦ç¢ºèªï¼ˆéœ€è¦é–‹å•Ÿå‰ç«¯æ¸¬è©¦ï¼Œæˆ–ä½¿ç”¨ç€è¦½å™¨æ“ä½œ MCPï¼‰
- **æ³¨æ„**: çµ•å°ä¸è¦åœ¨å¾Œç«¯åš `\n` â†’ `<br>` æ›¿æ›ï¼Œé€™æœƒèˆ‡å‰ç«¯ `marked.parse()` è¡çªã€‚

---

## P1 - é«˜å„ªå…ˆ

### Bug #11 + #16: æ™‚é–“éæ¿¾ç¼ºå¤±ï¼ˆretriever æ¶æ§‹å±¤ç´šï¼‰

**User Reports**:
- å•ã€Œä»Šæ—¥è‚¡å¸‚ã€ï¼Œæ¨¡å‹æ‰¾å‡º 11 æœˆä¸åŒæ—¥æœŸçš„è‚¡å¸‚ç‹€æ³
- å•ã€Œä»Šæ—¥çš„è‚¡å¸‚è¶¨å‹¢ã€ï¼Œæ‘˜è¦æ˜¯ä»Šæ—¥çš„ï¼Œä½†æœå°‹çµæœæ˜¯ 12 æœˆåº•çš„
- å•ã€Œç¶“å…¸è³½ä¸­è¯éšŠ43äººåå–®ã€ï¼Œçµæœæ˜¯ 11 æœˆçš„æ–°è

**Agent å…±è­˜**: 5/5 ç¢ºèªã€‚`retriever.py:817-936` çš„ `search()` æ–¹æ³•å®Œå…¨æ²’æœ‰æ™‚é–“éæ¿¾æ©Ÿåˆ¶ã€‚`time_range_extractor.py` é›–ç„¶èƒ½æ­£ç¢ºè§£ææ™‚é–“ç¯„åœï¼Œä½†è§£æçµæœå¾æœªè¢« retriever ä½¿ç”¨ã€‚

**Dev æŒ‡ä»¤**: reasoning moduleï¼ˆdeep research modeï¼‰ä¸­æœ‰ temporal search çš„æˆç†Ÿåˆ¤æ–·æ©Ÿåˆ¶ï¼Œæ‡‰è©²ä¹Ÿåœ¨æ–°èæœå°‹åŠŸèƒ½ä¸­ä½¿ç”¨ã€‚ç•¶ç™¼ç¾æ˜¯ temporal search ä¸”æ‰¾ä¸åˆ°çµæœæ™‚ï¼Œè¦åœ¨æœå°‹çµæœæœ€ä¸Šæ–¹ç”¨ç´…å­—èªªæ˜ï¼šç³»çµ±æ‰¾ä¸åˆ°å®Œå…¨ç¬¦åˆæ—¥æœŸéœ€æ±‚çš„è³‡æ–™ï¼Œæ‰€ä»¥æ“´å¤§äº†æ—¥æœŸç¯„åœã€‚

**ä¿®å¾©è¨ˆç•«**:
- **æ­¥é©Ÿ 1 â€” èª¿æŸ¥ reasoning module çš„ temporal search æ©Ÿåˆ¶**: è®€å– `reasoning/` ç›¸é—œç¨‹å¼ç¢¼ï¼Œæ‰¾åˆ° temporal search çš„åˆ¤æ–·é‚è¼¯å’Œå¯¦ä½œæ–¹å¼
- **æ­¥é©Ÿ 2 â€” åœ¨ retriever åŠ å…¥æ™‚é–“éæ¿¾**: åœ¨ `retriever.py` çš„ `search()` æ–¹æ³•ä¸­ï¼ŒåŠ å…¥ Qdrant payload filterï¼Œä½¿ç”¨ `FieldCondition` å° `datePublished` æ¬„ä½åšæ™‚é–“ç¯„åœéæ¿¾
- **æ­¥é©Ÿ 3 â€” å¯¦ä½œ fallback æ©Ÿåˆ¶**: ç•¶åš´æ ¼æ™‚é–“éæ¿¾çµæœç‚º 0 æ™‚ï¼Œè‡ªå‹•æ“´å¤§æ™‚é–“ç¯„åœï¼Œä¸¦è¨­å®š flag æ¨™è¨˜ã€Œå·²æ“´å¤§ç¯„åœã€
- **æ­¥é©Ÿ 4 â€” å‰ç«¯ç´…å­—æç¤º**: åœ¨æœå°‹çµæœæœ€ä¸Šæ–¹é¡¯ç¤ºç´…è‰²æç¤ºï¼šã€Œç³»çµ±æ‰¾ä¸åˆ°å®Œå…¨ç¬¦åˆæ—¥æœŸéœ€æ±‚çš„è³‡æ–™ï¼ˆ{åŸå§‹ç¯„åœ}ï¼‰ï¼Œå·²æ“´å¤§æœå°‹ç¯„åœè‡³ {æ“´å¤§å¾Œç¯„åœ}ã€
- **æ­¥é©Ÿ 5 â€” ç¢ºä¿ Summarize Agent èˆ‡ Retrieval åŒæ­¥**: ç•¶æœå°‹çµæœçš„æ—¥æœŸèˆ‡æŸ¥è©¢æ—¥æœŸä¸ç¬¦æ™‚ï¼Œæ‘˜è¦ä¸­éœ€æ˜ç¢ºæ¨™æ³¨

---

### Bug #13: å¼•ç”¨é€£çµ private:// å•é¡Œ

**User Report**: æ·±åº¦å ±å‘Šä¸­çš„è³‡æ–™ä¾†æº [4], [5], [6] é»æ“Šå¾Œç„¡æ³•å°å‘ï¼Œç¶²å€å‘ˆç¾ç‚º `private://demo_user_001/...`ã€‚

**Agent å…±è­˜**: 5/5 ç¢ºèªã€‚å¾Œç«¯ `user_qdrant_provider.py:167` ç”Ÿæˆ `private://` URLï¼Œä½†å‰ç«¯ `addCitationLinks()` æ²’æœ‰è™•ç†æ­¤å”è­°ã€‚

**Dev æŒ‡ä»¤**: æŒ‰ç…§ Agent å»ºè­°ä¿®å¾©ã€‚

**ä¿®å¾©è¨ˆç•«**:
- **æª”æ¡ˆ**: `static/news-search.js`
- **ä¿®æ”¹ä½ç½®**: `addCitationLinks()` å‡½æ•¸
- **åšæ³•**: åœ¨ `urn:llm:knowledge:` æª¢æ¸¬ä¹‹å¾Œã€ä¸€èˆ¬ URL è™•ç†ä¹‹å‰ï¼ŒåŠ å…¥ `private://` è™•ç†ï¼š
  ```javascript
  if (url.startsWith('private://')) {
      return `<span class="citation-private" title="ç§äººæ–‡ä»¶ä¾†æº">[${num}]<sup>ğŸ“</sup></span>`;
  }
  ```
- **CSS**: åœ¨ `news-search.css` åŠ å…¥ `.citation-private` æ¨£å¼ï¼ˆé¡ä¼¼ `.citation-urn` ä½†ç”¨ä¸åŒé¡è‰²/æ¨£å¼å€åˆ†ï¼‰
- **é©—è­‰**: ä¸Šå‚³ç§äººæ–‡ä»¶ â†’ æ·±åº¦ç ”ç©¶ â†’ ç¢ºèªç§äººæ–‡ä»¶å¼•ç”¨é¡¯ç¤ºç‚ºä¸å¯é»æ“Šçš„ç‰¹æ®Šæ¨™è¨˜ã€‚

---

### Bug #17: çŸ¥è­˜åœ–è­œæ”¶ä¸èµ·ä¾†ï¼ˆKG toggle å®Œå…¨ç„¡æ•ˆï¼‰

**User Report**: çŸ¥è­˜åœ–è­œæ”¶ä¸èµ·ä¾†ã€‚

**Agent å…±è­˜**: Agent #4 ç™¼ç¾åœ–å½¢æ¨¡å¼ä¸‹ toggle ç„¡æ•ˆï¼ˆåªæ“ä½œ `kgDisplayContent`ï¼Œä¸æ§åˆ¶ `kgGraphView`ï¼‰ã€‚Agent #5 ç™¼ç¾åˆ—è¡¨æ¨¡å¼ä¹Ÿç„¡æ•ˆï¼ˆinline `style.display` è¦†è“‹ `.collapsed` class çš„ CSS å„ªå…ˆç´šï¼‰ã€‚

**Dev æŒ‡ä»¤**: ä¾ç…§ Agent å»ºè­°ä¿®å¾©ï¼Œå› ç‚ºæ¯”è¼ƒè¤‡é›œï¼Œéœ€è¦ææ¸…æ¥š 5 å€‹ Agent çš„ç ”è®€è„ˆçµ¡å†å¯¦ä½œã€‚

**ä¿®å¾©è¨ˆç•«**:

**å‰ç½®ç†è§£ â€” å•é¡Œå…¨è²Œ**:
1. HTML çµæ§‹ï¼š`kgDisplayContainer` åŒ…å« `kgGraphView`ï¼ˆåœ–å½¢è¦–åœ–ï¼‰ã€`kgDisplayContent`ï¼ˆåˆ—è¡¨è¦–åœ–ï¼‰ã€`kgLegend`ï¼ˆåœ–ä¾‹ï¼‰
2. ä¸‰å¥—ç¨ç«‹çš„ JS æ§åˆ¶ï¼š
   - `kgToggleButton`ï¼ˆæ”¶èµ·/å±•é–‹ï¼‰â€” åªæ“ä½œ `kgDisplayContent` çš„ `.collapsed` class
   - `kgViewToggle`ï¼ˆåœ–å½¢/åˆ—è¡¨åˆ‡æ›ï¼‰â€” ç”¨ inline `style.display` åˆ‡æ›å…©å€‹è¦–åœ–
   - `kgToggle` checkboxï¼ˆé€²éšè¨­å®šï¼‰â€” å•Ÿç”¨/åœç”¨ KG åŠŸèƒ½
3. **åœ–å½¢æ¨¡å¼ä¸‹**: toggle æ“ä½œå·²ç¶“ `display: none` çš„ `kgDisplayContent`ï¼Œ`kgGraphView` ä¸å—å½±éŸ¿
4. **åˆ—è¡¨æ¨¡å¼ä¸‹**: inline `style.display: block` å„ªå…ˆç´šé«˜æ–¼ `.collapsed { display: none }`

**å¯¦ä½œæ–¹æ¡ˆ**:
- **æª”æ¡ˆ**: `static/news-search.js`, `static/news-search.css`, `static/news-search-prototype.html`
- **æ–¹æ¡ˆ**: åœ¨ `kgGraphView`ã€`kgDisplayContent`ã€`kgLegend` å¤–å±¤å¢åŠ ä¸€å€‹åŒ…è£å®¹å™¨ `kgContentWrapper`ï¼Œtoggle æŒ‰éˆ•æ“ä½œæ­¤åŒ…è£å®¹å™¨è€Œéå–®ä¸€å­å…ƒç´ 
- **ä¿®æ”¹ 1 â€” HTML**: åœ¨ `kgGraphView`ã€`kgDisplayContent`ã€`kgLegend` å¤–å±¤åŠ  `<div id="kgContentWrapper">`
- **ä¿®æ”¹ 2 â€” JS**: `kgToggleButton` çš„ click handler æ”¹ç‚ºæ“ä½œ `kgContentWrapper` çš„ `style.display`ï¼ˆè€Œéä¾è³´ CSS classï¼‰ï¼Œç¢ºä¿ä¸å— inline style å„ªå…ˆç´šå•é¡Œå½±éŸ¿
  ```javascript
  const wrapper = document.getElementById('kgContentWrapper');
  toggleButton.addEventListener('click', () => {
      const isCollapsed = wrapper.style.display === 'none';
      wrapper.style.display = isCollapsed ? '' : 'none';
      // æ›´æ–°åœ–ç¤ºå’Œæ–‡å­—
  });
  ```
- **ä¿®æ”¹ 3 â€” CSS**: ç§»é™¤ `.kg-display-content.collapsed` è¦å‰‡ï¼ˆä¸å†éœ€è¦ï¼‰
- **é©—è­‰**: åœ–å½¢æ¨¡å¼ä¸‹æŒ‰æ”¶èµ· â†’ æ•´å€‹ KG éš±è—ï¼›åˆ—è¡¨æ¨¡å¼ä¸‹æŒ‰æ”¶èµ· â†’ æ•´å€‹ KG éš±è—ï¼›å±•é–‹å¾Œæ¢å¾©åŸç‹€ã€‚

---

### Bug #22: å¼•ç”¨æ ¼å¼ä¸é€šé †

**User Report**: å¼•ç”¨çš„æ™‚å€™å¯«æ³•åä¸é€šé †ï¼Œæœƒèªªã€Œæ ¹æ“šå ±å°ï¼Œåœ¨[6]ä¸­æåˆ°ï¼Œ(å…§å®¹)ã€ã€‚

**Agent å…±è­˜**: 5/5 ç¢ºèªã€‚Writer prompt æœ‰ citation whitelist æ©Ÿåˆ¶ä½†ç¼ºå°‘å¼•ç”¨çš„ã€Œèªæ³•é¢¨æ ¼ã€æŒ‡å¼•ã€‚

**Dev æŒ‡ä»¤**: è«‹åœ¨ prompt ä¸­çµ¦äºˆå¼•ç”¨èªæ³•æŒ‡å¼•ã€‚

**ä¿®å¾©è¨ˆç•«**:
- **æª”æ¡ˆ**: `code/python/reasoning/prompts/writer.py`
- **ä¿®æ”¹ä½ç½®**: `_citation_rules()` æˆ–é¡ä¼¼æ–¹æ³•
- **åŠ å…¥å…§å®¹**:
  ```
  **å¼•ç”¨èªæ³•é¢¨æ ¼**ï¼š
  å¼•ç”¨æ¨™è¨˜ [N] æ‡‰è‡ªç„¶åµŒå…¥å¥å­ä¸­ï¼Œä¸è¦è®“å¼•ç”¨ç ´å£é–±è®€æµæš¢æ€§ã€‚

  âœ… æ­£ç¢ºç¯„ä¾‹ï¼š
  - ã€Œå°ç©é›»è‚¡åƒ¹ä¸Šæ¼² 3%[1]ã€‚ã€
  - ã€Œæ ¹æ“šå ±å°[1]ï¼Œå°ç©é›»è‚¡åƒ¹ä¸Šæ¼² 3%ã€‚ã€
  - ã€Œå¤šé …ç ”ç©¶é¡¯ç¤º[2][3]ï¼ŒAI ç”¢æ¥­æŒçºŒæˆé•·ã€‚ã€

  âŒ éŒ¯èª¤ç¯„ä¾‹ï¼ˆçµ•å°ç¦æ­¢ï¼‰ï¼š
  - ã€Œæ ¹æ“šå ±å°ï¼Œåœ¨[1]ä¸­æåˆ°ï¼Œå°ç©é›»è‚¡åƒ¹ä¸Šæ¼² 3%ã€‚ã€
  - ã€Œåœ¨[1]å ±å°ä¸­ï¼Œæåˆ°å°ç©é›»è‚¡åƒ¹ä¸Šæ¼² 3%ã€‚ã€
  - ã€Œä¾æ“š[1]æ‰€è¿°çš„å…§å®¹ä¾†çœ‹ï¼Œ...ã€

  åŸå‰‡ï¼šå¼•ç”¨æ¨™è¨˜æ”¾åœ¨å¥æœ«æˆ–ç·Šè·Ÿåœ¨ä¾†æºæè¿°ä¹‹å¾Œï¼Œä¸è¦æ‹†é–‹å¥å­ã€‚
  ```
- **é©—è­‰**: æ·±åº¦ç ”ç©¶ä»»æ„ä¸»é¡Œï¼Œæª¢æŸ¥å¼•ç”¨æ ¼å¼æ˜¯å¦è‡ªç„¶ã€‚

---

### Bug #25: å¼•ç”¨æ•¸å­—å¤ªå¤§æ²’æœ‰è¶…é€£çµ

**User Report**: å¼•ç”¨æ•¸å­—å¤ªå¤§æ™‚ï¼ˆå¦‚ [15], [20]ï¼‰ï¼Œæ²’æœ‰è¶…é€£çµã€‚

**Agent å…±è­˜**: 5/5 ç¢ºèªã€‚å‰ç«¯ bounds check é‚è¼¯æ­£ç¢ºï¼Œå•é¡Œåœ¨å¾Œç«¯ `source_map` å¯èƒ½ä¸åŒ…å«æ‰€æœ‰å¼•ç”¨çš„ sourceã€‚

**Dev æŒ‡ä»¤**: å»ºè­°ä¿®å¾©æ–¹æ³•æ˜¯ï¼Ÿ

**å›æ‡‰ Dev è¨è«–**:

æ ¹å› æœ‰å…©å€‹å¯èƒ½ï¼š(1) Writer agent å¼•ç”¨äº† `analyst_citations` ç™½åå–®ä»¥å¤–çš„ IDï¼›(2) `source_map` åœ¨å¤šè¼ªè¿­ä»£ä¸­ç´¯ç©ä¸å®Œæ•´ã€‚

**å»ºè­°ä¿®å¾©æ–¹æ¡ˆ**:
- **æ–¹æ¡ˆ A â€” å¾Œç«¯é˜²ç¦¦ï¼ˆæ¨è–¦ï¼‰**: åœ¨ `orchestrator.py` çš„ `source_urls` æ§‹å»ºé‚è¼¯ä¸­ï¼Œç¢ºä¿é™£åˆ—é•·åº¦è¶³å¤ ã€‚å¦‚æœ Writer å¼•ç”¨äº†è¶…å‡ºç¯„åœçš„ IDï¼Œè‡ªå‹•å¡«å……ç©ºå­—ä¸²æˆ– placeholderï¼Œä¸¦åœ¨ log ä¸­è¨˜éŒ„è­¦å‘Šã€‚
- **æ–¹æ¡ˆ B â€” Writer prompt å¼·åŒ–**: åœ¨ Writer prompt ä¸­åŠ å…¥æ›´å¼·çš„ç´„æŸï¼šã€Œä½ åªèƒ½å¼•ç”¨ [1] åˆ° [N]ï¼ˆN = source æ•¸é‡ï¼‰ï¼Œçµ•å°ä¸è¦å¼•ç”¨è¶…å‡ºç¯„åœçš„æ•¸å­—ã€‚ã€
- **æ–¹æ¡ˆ C â€” å‰ç«¯é™ç´šé¡¯ç¤º**: ç•¶ `index >= sources.length` æ™‚ï¼Œä¸æ˜¯è¿”å›åŸæ–‡ `[20]`ï¼Œè€Œæ˜¯é¡¯ç¤ºç‚ºç„¡é€£çµçš„å¼•ç”¨æ¨™è¨˜ï¼ˆå¸¶ tooltip èªªæ˜ã€Œä¾†æºæš«ç„¡é€£çµã€ï¼‰ï¼Œè®“ç”¨æˆ¶çŸ¥é“é€™æ˜¯ä¸€å€‹å¼•ç”¨è€Œéæ™®é€šæ–‡å­—ã€‚
- **æ¨è–¦**: A + B + C ä¸‰ç®¡é½Šä¸‹ã€‚A ä¿® source_map ç´¯ç©å•é¡Œï¼ŒB å¾æºé ­æ¸›å°‘è¶Šç•Œå¼•ç”¨ï¼ŒC ä½œç‚ºæœ€å¾Œé˜²ç·šç¢ºä¿ UXã€‚

---

## P2 - ä¸­å„ªå…ˆ

### Bug #2: Free Conversation åªç”¨å‰ 10 å€‹ Cache çµæœ

**User Report**: è‡ªç”±å°è©±åªæœƒç”¨æœ€è¿‘ cache çš„å‰ 10 å€‹ï¼Œè€Œä¸æ˜¯æ‰€æœ‰çš„æœå°‹çµæœã€‚

**Agent å…±è­˜**: 5/5 ç¢ºèªé€™æ˜¯åˆ»æ„è¨­è¨ˆï¼ˆ`generate_answer.py:456-461` é™åˆ¶ 10 å€‹ï¼Œ`:591` å†é™åˆ¶ 8 å€‹ï¼‰ï¼Œé bugã€‚

**Dev æŒ‡ä»¤**:
1. Free convo æ¨¡å¼çš„å°è©±è¼¸å…¥æ¡†ä¸­ï¼Œç”¨ç°è‰² placeholder æ–‡å­—èªªæ˜ï¼šç ”ç©¶åŠ©ç†å›è©±åªæœƒåƒè€ƒã€Œæ‘˜è¦å…§å®¹ã€ä»¥åŠä½¿ç”¨è€…ã€Œé‡˜é¸æ–‡ç« ã€
2. Freeconvo çš„ context æ³¨å…¥æ”¹æˆåªçœ‹æ¯ä¸€æ¬¡ generate answer çš„çµæœï¼Œä»¥åŠä½¿ç”¨è€…é‡˜é¸çš„ã€Œé‡˜é¸æ–°èã€å…§å®¹ï¼ˆæ¨™é¡Œã€Linkã€æ‘˜è¦ï¼‰
3. é‡˜é¸åŠŸèƒ½ç›®å‰å¯èƒ½åªå­˜æ¨™é¡Œè·Ÿ hyperlinkï¼Œå¦‚æœæ˜¯çš„è©±ï¼Œéœ€è¦ä¿®æ”¹æˆä¹Ÿèƒ½å­˜æ‘˜è¦ï¼ˆåªæ˜¯ä¸é¡¯ç¤ºï¼‰

**ä¿®å¾©è¨ˆç•«**:
- **æ­¥é©Ÿ 1 â€” èª¿æŸ¥é‡˜é¸åŠŸèƒ½ç›®å‰å­˜å„²çš„è³‡æ–™çµæ§‹**: æª¢æŸ¥å‰ç«¯é‡˜é¸åŠŸèƒ½çš„è³‡æ–™çµæ§‹ï¼Œç¢ºèªæ˜¯å¦åªå­˜æ¨™é¡Œå’Œ hyperlink
- **æ­¥é©Ÿ 2 â€” æ“´å±•é‡˜é¸è³‡æ–™**: å¦‚æœåªå­˜æ¨™é¡Œå’Œ linkï¼ŒåŠ å…¥ snippet/æ‘˜è¦æ¬„ä½ï¼ˆå‰ç«¯ä¸é¡¯ç¤ºï¼Œä½†å¾Œç«¯ context æ³¨å…¥æ™‚ä½¿ç”¨ï¼‰
- **æ­¥é©Ÿ 3 â€” ä¿®æ”¹ context æ³¨å…¥é‚è¼¯**: `synthesize_free_conversation()` æ”¹ç‚ºæ³¨å…¥ï¼š
  - æœ¬æ¬¡ generate answer çš„æ‘˜è¦çµæœ
  - ä½¿ç”¨è€…é‡˜é¸çš„æ–°èï¼ˆæ¨™é¡Œ + Link + æ‘˜è¦ï¼‰
- **æ­¥é©Ÿ 4 â€” å‰ç«¯ placeholder**: åœ¨ Free Conversation çš„è¼¸å…¥æ¡†åŠ å…¥ç°è‰² placeholder æ–‡å­—ï¼šã€Œç ”ç©¶åŠ©ç†æœƒåƒè€ƒæ‘˜è¦å…§å®¹åŠæ‚¨é‡˜é¸çš„æ–‡ç« ä¾†å›ç­”ã€

---

### Bug #3: åˆç†åŒ–éŒ¯èª¤ç­”æ¡ˆ

**User Report**: è©¢å•ã€Œç‚ºä»€éº¼åªæŸ¥å¾—åˆ°11/11çš„æ–°èã€ï¼ŒLLM èªªå› ç‚º 11/11 ç™¼ç”Ÿå¾ˆå¤šäº‹æƒ…ï¼Œç¡¬æ˜¯åˆç†åŒ–ã€‚

**Agent å…±è­˜**: 5/5 ç¢ºèªã€‚Prompt ç¼ºå°‘ç³»çµ±å…ƒè³‡è¨Šã€‚

**Dev æŒ‡ä»¤**: æŒ‰ç…§ Agent å»ºè­°ä¿®æ”¹ã€‚

**ä¿®å¾©è¨ˆç•«**:
- **æª”æ¡ˆ**: `code/python/methods/generate_answer.py`
- **ä¿®æ”¹ä½ç½®**: `synthesize_free_conversation()` çš„ä¸‰å€‹ prompt è®Šé«”
- **åŠ å…¥ç³»çµ±å…ƒè³‡è¨Š**ï¼ˆç²—é«”å¼·èª¿ï¼‰:
  ```
  **é‡è¦ç³»çµ±é™åˆ¶**ï¼š
  - ä½ åªèƒ½å­˜å–è³‡æ–™åº«ä¸­å·²æ”¶éŒ„çš„æ–°èï¼Œä¸ä»£è¡¨æ‰€æœ‰æ–°èã€‚
  - **å¦‚æœç”¨æˆ¶å•ã€Œç‚ºä»€éº¼åªæœ‰æŸæ—¥æœŸ/æŸä¸»é¡Œçš„æ–°èã€ï¼Œæœ€å¯èƒ½çš„åŸå› æ˜¯è³‡æ–™åº«æ”¶éŒ„ç¯„åœæœ‰é™ã€‚**
  - **çµ•å°ä¸è¦çŒœæ¸¬æˆ–åˆç†åŒ–æ–°èæ•¸é‡/æ—¥æœŸåˆ†å¸ƒçš„åŸå› ã€‚**
  - èª å¯¦å›ç­”ï¼šã€Œé€™å¯èƒ½æ˜¯å› ç‚ºè³‡æ–™åº«æ”¶éŒ„ç¯„åœçš„é™åˆ¶ï¼Œå»ºè­°èª¿æ•´æœå°‹æ¢ä»¶æˆ–æ™‚é–“ç¯„åœé‡æ–°æœå°‹ã€‚ã€
  ```

---

### Bug #4 + #5: æ·±åº¦ç ”ç©¶æ­§ç¾©æª¢æ¸¬ä¸å®Œæ•´

**User Report**:
- å•ã€ŒAIç™¼å±•ã€åªå• time ambiguityï¼Œæ²’å• scope ambiguity
- å•ã€Œæ™¶ç‰‡æ³•æ¡ˆã€æ²’å• entity ambiguityï¼Œé è¨­ç‚ºç¾åœ‹æ™¶ç‰‡æ³•æ¡ˆ

**Agent å…±è­˜**: 5/5 ç¢ºèªã€‚Prompt è¨­è¨ˆå®Œå–„ï¼Œä½† LLM è¡Œç‚ºæœ‰éš¨æ©Ÿæ€§ã€‚

**Dev æŒ‡ä»¤**:
- Bug #4: æ­¤å•é¡Œæ‡‰è©²å·²ç¶“éƒ¨ä»½è§£æ±ºã€‚æ˜¯å¦å¯ä»¥è®“ Clarification çš„åŠŸèƒ½ï¼Œåœ¨å‰ç«¯å¤šä¸€å€‹ã€Œæœ‰æ²’æœ‰å…¶ä»–ä½ æƒ³æ›´å…·é«”èšç„¦çš„å…§å®¹ï¼Ÿã€é¸é …ï¼Œä»¥åŠä½¿ç”¨è€…è¼¸å…¥æ¬„ä½ï¼Œå’Œã€Œæ²’æœ‰ã€æŒ‰éˆ•ã€‚
- Bug #5: ç›®å‰ clarification ä¸éœ€è¦æ›´å¤š hardcoded entityï¼Œå¾ŒçºŒè¨­è¨ˆæ‡‰å·²ç›¸å°å®Œæ•´æ¶µè“‹ï¼Œå¾…æ›´å¤šä½¿ç”¨è€…æ¸¬è©¦å›å ±ã€‚

**ä¿®å¾©è¨ˆç•«**:
- **Bug #4 å‰ç«¯ä¿®æ”¹**: åœ¨ Clarification å•é¡Œçš„é¸é …åˆ—è¡¨æœ€å¾Œï¼ŒåŠ å…¥ï¼š
  1. ã€Œæœ‰æ²’æœ‰å…¶ä»–ä½ æƒ³æ›´å…·é«”èšç„¦çš„å…§å®¹ï¼Ÿã€â€” é™„å¸¶è‡ªç”±æ–‡å­—è¼¸å…¥æ¬„ä½
  2. ã€Œæ²’æœ‰ï¼Œç›´æ¥é–‹å§‹ç ”ç©¶ã€â€” æŒ‰éˆ•
- **Bug #5**: æš«ä¸ä¿®æ”¹ï¼ŒæŒçºŒæ”¶é›†ç”¨æˆ¶å›å ±ã€‚å¦‚æœæœªä¾†å›å ±é »ç‡é«˜ï¼Œå†è€ƒæ…®åœ¨ prompt ä¸­å¢åŠ  few-shot ç¯„ä¾‹æˆ–é™ä½ temperatureã€‚

---

### Bug #14: æ‘˜è¦å›é¥‹æŒ‰éˆ• â€” ç„¡å¾Œç«¯é€šè¨Š + UX å¾®å¼±

**User Report**: æ‘˜è¦ã€Œæœ‰å¹«åŠ©ã€æŒ‰éˆ•æ²’æœ‰äº’å‹•æ„Ÿã€å›é¥‹æ„Ÿã€‚å¤šæ¨£æ€§æ–¹é¢ï¼Œ10 å€‹çµæœæœ‰ 4 å€‹æ˜¯å¤§è°·ç¿”å¹³ã€‚

**Agent å…±è­˜**: Agent #5 ç™¼ç¾å›é¥‹æŒ‰éˆ•å®Œå…¨ç„¡å¾Œç«¯é€šè¨Šï¼ˆæ˜¯æœªå®ŒæˆåŠŸèƒ½ï¼‰ã€‚UX æ–¹é¢ hover æ•ˆæœå¹¾ä¹ä¸å¯è¦‹ï¼Œclick å¾Œ 2 ç§’è‡ªå‹•æ¢å¾©ç„¡æ°¸ä¹…ç‹€æ…‹ã€‚

**Dev æŒ‡ä»¤**: åŠ ä¸€å€‹å°å°è©±æ¡†ï¼Œçµ¦äºˆæ­£é¢æˆ–è² é¢å›é¥‹ä¹‹å¾Œè·³å‡ºã€‚å°è©±æ¡† placeholder/hint textï¼šã€Œæ„Ÿè¬æä¾›æ„è¦‹ï¼Œæœ‰ä»»ä½•æ­£é¢ã€è² é¢é«”é©—ï¼Œæˆ–å…¶ä»–æ„è¦‹éƒ½æ­¡è¿å›é¥‹ï¼ã€ã€‚æ‰“å®ŒæŒ‰æäº¤ï¼Œé€åˆ°è³‡æ–™åº«æˆ– Google Sheetã€‚å°è©±æ¡†å¯ä»¥æŒ‰ "X" é—œé–‰ã€‚è«‹ç”¨ /plan ä¾†çœ‹æ€éº¼åšï¼Œè·Ÿ Dev å ±å‘Šã€‚

**ä¿®å¾©è¨ˆç•«**:
- éœ€è¦å•Ÿå‹• /plan é€²è¡Œå®Œæ•´è¨­è¨ˆã€‚åˆæ­¥æ–¹å‘ï¼š
  1. **å‰ç«¯**: é»æ“Š ğŸ‘/ğŸ‘ å¾Œå½ˆå‡ºå°å°è©±æ¡†ï¼ˆmodal/popoverï¼‰ï¼ŒåŒ…å«æ–‡å­—è¼¸å…¥å€å’Œæäº¤/é—œé–‰æŒ‰éˆ•
  2. **å¾Œç«¯**: å»ºç«‹ feedback API endpointï¼Œæ¥æ”¶å›é¥‹è³‡æ–™
  3. **å„²å­˜**: å­˜åˆ° SQLiteï¼ˆæœ¬åœ°é–‹ç™¼ï¼‰æˆ– PostgreSQLï¼ˆProductionï¼‰ï¼Œæˆ– Google Sheetï¼ˆç°¡æ˜“æ–¹æ¡ˆï¼‰
  4. **å¤šæ¨£æ€§**: è€ƒæ…®èª¿ä½ MMR lambdaï¼ˆç›®å‰ 0.7ï¼Œå»ºè­° 0.5-0.6ï¼‰

---

### Bug #23: æš«åœå°è©±æŒ‰éˆ•ç¼ºå¤± + é˜²æ­¢é‡è¤‡ç™¼é€

**User Report**: æ²’æœ‰æš«åœå°è©±æŒ‰éˆ•ï¼Œç„¡æ³•ä¸­æ–· AI å›æ‡‰ã€‚å¦å¤–ä½¿ç”¨è€…åæ˜  Mac IME å•é¡Œå°è‡´é‡è¤‡é€å‡ºã€‚

**Agent å…±è­˜**: 5/5 ç¢ºèªã€‚æ²’æœ‰ä»»ä½•ä¸²æµä¸­æ–·æ©Ÿåˆ¶ï¼ˆç„¡ `AbortController`ã€ç„¡å…¨å±€ `EventSource` å¼•ç”¨ï¼‰ã€‚

**Dev æŒ‡ä»¤**:
1. è¦æœ‰ abort é¸é …ï¼Œç¢ºå®š abort æ‰€æœ‰æ­£åœ¨é€²è¡Œçš„é€²ç¨‹ï¼ˆé¿å…æµªè²»è³‡æºï¼‰
2. ç•¶ä½¿ç”¨è€…é€å‡ºæœå°‹/è«‹æ±‚ï¼Œè¦æŠŠæœå°‹/ç™¼é€æŒ‰éˆ•ä»¥åŠ Enter é€å‡ºé—œæ‰ï¼Œæ”¹æˆ Abort æŒ‰éˆ•ã€‚å¦å‰‡å‰ç«¯æœƒé€£çºŒç™¼é€ç›¸åŒè«‹æ±‚ï¼Œå¾Œç«¯ä¾åºè·‘ï¼Œå¡è»Šå¡çˆ†ã€‚

**ä¿®å¾©è¨ˆç•«**:
- **æ­¥é©Ÿ 1 â€” å…¨å±€ä¸²æµå¼•ç”¨**: å°‡ `EventSource` å’Œ `fetch` çš„ `AbortController` å­˜ç‚ºæ¨¡çµ„ç´šè®Šæ•¸
- **æ­¥é©Ÿ 2 â€” UI ç‹€æ…‹æ©Ÿ**:
  - **é–’ç½®ç‹€æ…‹**: é¡¯ç¤ºæœå°‹/ç™¼é€æŒ‰éˆ•ï¼ŒEnter å¯é€å‡º
  - **è™•ç†ä¸­ç‹€æ…‹**: éš±è—æœå°‹/ç™¼é€æŒ‰éˆ•ï¼Œé¡¯ç¤ºã€Œåœæ­¢ç”Ÿæˆã€æŒ‰éˆ•ï¼Œç¦ç”¨ Enter é€å‡ºï¼ˆ`e.preventDefault()`ï¼‰
  - **Abort ç‹€æ…‹**: é»æ“Šåœæ­¢ â†’ `eventSource.close()` / `abortController.abort()` â†’ å›åˆ°é–’ç½®ç‹€æ…‹
- **æ­¥é©Ÿ 3 â€” å¾Œç«¯æ¸…ç†**: ç¢ºèªå‰ç«¯ abort å¾Œï¼Œå¾Œç«¯çš„ SSE é€£ç·šä¹Ÿæœƒæ­£ç¢ºé—œé–‰ï¼ˆaiohttp çš„ StreamResponse åœ¨ client disconnect æ™‚æ‡‰è‡ªå‹•æ¸…ç†ï¼‰
- **é©ç”¨ç¯„åœ**: æ–°èæœå°‹ã€æ·±åº¦ç ”ç©¶ã€Free Conversation ä¸‰å€‹æ¨¡å¼éƒ½éœ€è¦

---

## P3 - ä½å„ªå…ˆ / åŠŸèƒ½é™åˆ¶

### Bug #7: ç¼ºå°‘ç´«è‰²è™›ç·šæ¨™è¨˜ AI çŸ¥è­˜

**User Report**: å•éœ€è¦ LLM çŸ¥è­˜çš„å•é¡Œï¼Œæ²’æœ‰ç´«è‰²è™›ç·šæ¨™è¨˜å€åˆ† AI çŸ¥è­˜èˆ‡çœŸå¯¦ä¾†æºã€‚

**Agent å…±è­˜**: 5/5 ç¢ºèª pipeline å¾å¾Œç«¯åˆ°å‰ç«¯å®Œæ•´å¯¦ä½œã€‚å•é¡Œä¸æ˜¯ç¨‹å¼ç¢¼ bugï¼Œè€Œæ˜¯ Analyst agent åœ¨ç‰¹å®šæŸ¥è©¢ä¸­å¯èƒ½æ²’æœ‰è§¸ç™¼ `GapResolutionType.LLM_KNOWLEDGE`ã€‚

**Dev æŒ‡ä»¤**: LLM æ¨è«–éç¨‹ä¸­ä½¿ç”¨çš„å¸¸è­˜å¾ˆå¤šä¾†è‡ª LLM knowledgeã€‚ä¹Ÿè¨±å¯ä»¥è®“ Analyst æ›´åš´æ ¼å®šç¾©å“ªäº›æ˜¯ä¾†è‡ª LLM Knowledge çš„ Claimï¼Ÿè«‹ç ”ç©¶ç›®å‰è§¸ç™¼é‚è¼¯ä»¥åŠå¦‚ä½•ä¿®æ”¹ã€‚

**å›æ‡‰ Dev è¨è«–**:

ç›®å‰è§¸ç™¼é‚è¼¯åœ¨ `orchestrator.py:1331-1350`ï¼Œç•¶ `gap.resolution == GapResolutionType.LLM_KNOWLEDGE` æ™‚è§¸ç™¼ã€‚ä½†å•é¡Œåœ¨æ–¼ Analyst agent çš„åˆ¤æ–·â€”â€”å®ƒå¯èƒ½æŠŠå¾ˆå¤šå¯¦éš›ä¸Šæ˜¯ LLM èƒŒæ™¯çŸ¥è­˜çš„ claim æ­¸é¡ç‚ºã€Œå¾æœå°‹çµæœæ¨è«–ã€è€Œéã€ŒLLM Knowledgeã€ã€‚

**å»ºè­°ä¿®æ”¹æ–¹å‘**:
1. **ç ”ç©¶ Analyst prompt ä¸­ gap analysis çš„å®šç¾©**: æª¢æŸ¥ `reasoning/prompts/analyst.py` ä¸­å¦‚ä½•å®šç¾© `GapResolutionType`ï¼Œç‰¹åˆ¥æ˜¯ `LLM_KNOWLEDGE` çš„è§¸ç™¼æ¢ä»¶
2. **æ”¾å¯¬ LLM_KNOWLEDGE è§¸ç™¼æ¢ä»¶**: åœ¨ Analyst prompt ä¸­åŠ å…¥æ›´æ˜ç¢ºçš„æŒ‡å¼•ï¼š
   - å¦‚æœä¸€å€‹ claim ç„¡æ³•ç›´æ¥å¾æœå°‹çµæœä¸­æ‰¾åˆ°æ”¯æŒï¼Œå³ä½¿å®ƒæ˜¯ã€Œå¸¸è­˜ã€ï¼Œä¹Ÿæ‡‰æ¨™è¨˜ç‚º `LLM_KNOWLEDGE`
   - ä¾‹å¦‚ï¼šã€ŒEUV æ˜¯æ¥µç´«å¤–å…‰å¾®å½±æŠ€è¡“ã€é€™ç¨®èƒŒæ™¯çŸ¥è­˜ï¼Œå³ä½¿ Analyst ã€ŒçŸ¥é“ã€ï¼Œä¹Ÿæ‡‰æ¨™è¨˜
3. **å¢åŠ è§¸ç™¼ç¯„ä¾‹**: åœ¨ prompt ä¸­åŠ å…¥å“ªäº›æƒ…æ³æ‡‰è©²è§¸ç™¼ LLM_KNOWLEDGE çš„å…·é«”ä¾‹å­
4. é€™å€‹ä¿®æ”¹éœ€è¦å…ˆèª¿æŸ¥å®Œæ•´çš„ gap analysis æµç¨‹æ‰èƒ½ç¢ºå®šæœ€ä½³æ–¹æ¡ˆ

---

### Bug #8: æ²’æœ‰çœŸçš„åˆ—å‡º 12 æœˆåå¤§æ–°è

**User Report**: å•ã€Œæ¢åˆ—å‡º12æœˆ10å¤§æ–°èã€ï¼ŒLLM æ‰¾åˆ°äº†ä¸€ç¯‡å…¨å¹´åº¦åå¤§äº‹ä»¶çš„æ–°èï¼Œè€Œä¸æ˜¯è‡ªå·±çµ±è¨ˆã€‚

**Agent å…±è­˜**: 5/5 ç¢ºèªæ˜¯åŠŸèƒ½é™åˆ¶ã€‚ç³»çµ±æ˜¯èªæ„æœå°‹å¼•æ“ï¼Œç„¡èšåˆçµ±è¨ˆèƒ½åŠ›ã€‚

**Dev æŒ‡ä»¤**: æˆ‘å€‘å…¶å¯¦æœ‰ Decontextualization åŠŸèƒ½ï¼Œç›®å‰æ˜¯å¦‚ä½•é‹è¡Œçš„ï¼Ÿæ‡‰è©²è®“æ­¤æ©Ÿåˆ¶èƒ½æº–ç¢ºç†è§£ä½¿ç”¨è€…èªæ„ï¼Œä¸¦åŸ·è¡Œé©ç•¶æœå°‹ã€‚

**å›æ‡‰ Dev è¨è«–**:

ã€ŒDecontextualizationã€ï¼ˆå»èªå¢ƒåŒ–/æŸ¥è©¢é‡å¯«ï¼‰çš„ä½œç”¨æ˜¯å°‡æ¨¡ç³ŠæŸ¥è©¢è½‰æ›ç‚ºæ›´ç²¾ç¢ºçš„æœå°‹æ„åœ–ã€‚å°æ–¼ã€Œæ¢åˆ—å‡º12æœˆ10å¤§æ–°èã€é€™å€‹æŸ¥è©¢ï¼š

1. **ç›®å‰å•é¡Œ**: Decontextualization å¯èƒ½å°‡æ­¤æŸ¥è©¢ç›´æ¥è½‰ç‚ºå‘é‡æœå°‹ï¼ŒåŒ¹é…åˆ°ã€Œåå¤§æ–°èã€ç›¸é—œæ–‡ç« ï¼Œè€Œä¸æ˜¯ç†è§£ä½¿ç”¨è€…è¦çš„æ˜¯ã€Œå¤šä¸»é¡Œçš„12æœˆé‡è¦æ–°èç¶œåˆåˆ—è¡¨ã€
2. **ç†æƒ³è¡Œç‚º**: Decontextualization æ‡‰è©²è­˜åˆ¥å‡ºé€™æ˜¯ä¸€å€‹ã€Œèšåˆå‹æŸ¥è©¢ã€ï¼ˆaggregate queryï¼‰ï¼Œéœ€è¦æ‹†è§£ç‚ºå¤šå€‹å­æœå°‹ï¼š
   - æœå°‹ã€Œ12æœˆ æ”¿æ²»æ–°èã€
   - æœå°‹ã€Œ12æœˆ è²¡ç¶“æ–°èã€
   - æœå°‹ã€Œ12æœˆ ç¤¾æœƒæ–°èã€
   - ç­‰ç­‰ï¼Œç„¶å¾Œå¾çµæœä¸­ç¶œåˆå‡ºã€Œåå¤§ã€
3. **å»ºè­°**: éœ€è¦å…ˆèª¿æŸ¥ Decontextualization çš„ç›®å‰å¯¦ä½œï¼ˆå¯èƒ½åœ¨ `core/query_analysis/` ä¸­ï¼‰ï¼Œç„¶å¾Œåˆ¤æ–·æ˜¯å¦å¯ä»¥åŠ å…¥ã€Œèšåˆå‹æŸ¥è©¢ã€çš„è­˜åˆ¥å’Œè™•ç†

---

### Bug #9: ç„¡æ³•å­˜å–å³æ™‚æ–°èçš„å›è¦†

**User Report**: Free Conversation è¿½å•æ™‚ LLM å›è¦†ã€Œç„¡æ³•ç›´æ¥å­˜å–å³æ™‚æ–°èæ•¸æ“šã€ã€‚

**Agent å…±è­˜**: 5/5 ç¢ºèªã€‚Prompt ç¼ºå°‘ç³»çµ±èƒ½åŠ›èªªæ˜ã€‚

**Dev æŒ‡ä»¤**: å·²ç¶“è§£æ±º Free Conversation å’Œ Deep Research ä¹‹é–“çš„è³‡æ–™ pipeline å•é¡Œã€‚ä½†å¯ä»¥åœ¨ Free convo çš„ system prompt è£¡æç¤ºï¼šå¯ä»¥è§£é‡‹è‡ªå·±çš„èƒ½èˆ‡ä¸èƒ½ï¼Œä¸¦æä¾›ç”¨æˆ¶é©ç•¶çš„æ“ä½œå»ºè­°ã€‚

**ä¿®å¾©è¨ˆç•«**:
- åœ¨ `synthesize_free_conversation()` çš„ prompt ä¸­åŠ å…¥ç³»çµ±èƒ½åŠ›èªªæ˜ï¼š
  ```
  **ä½ çš„èƒ½åŠ›ç¯„åœ**ï¼š
  - ä½ å¯ä»¥åˆ†æå’Œè¨è«–å·²æœå°‹åˆ°çš„æ–°èæ–‡ç« 
  - ä½ å¯ä»¥å›ç­”åŸºæ–¼æœå°‹çµæœçš„å•é¡Œ
  - å¦‚æœç”¨æˆ¶çš„å•é¡Œè¶…å‡ºç›®å‰æœå°‹çµæœçš„ç¯„åœï¼Œå»ºè­°ä»–å€‘ï¼šä¿®æ”¹æœå°‹é—œéµå­—é‡æ–°æœå°‹ã€èª¿æ•´æ™‚é–“ç¯„åœã€æˆ–ä½¿ç”¨æ·±åº¦ç ”ç©¶æ¨¡å¼
  - ä¸è¦èªªã€Œæˆ‘ç„¡æ³•å­˜å–å³æ™‚æ–°èã€ï¼Œè€Œæ˜¯èªªã€Œç›®å‰æœå°‹çµæœä¸­æ²’æœ‰ç›¸é—œè³‡è¨Šï¼Œå»ºè­°æ‚¨é‡æ–°æœå°‹ [å…·é«”å»ºè­°]ã€
  ```

---

### Bug #12: æ²»å®‰æ”¿ç­–æ²’æ‰¾åˆ°å¼µæ–‡äº‹ä»¶

**User Report**: å•ã€Œå°ç£åœ¨12æœˆä¸­ï¼Œæ”¿åºœæœ‰å°æ²»å®‰æ”¿ç­–æœ‰æ–°çš„è«–è¿°æˆ–æ˜¯è¦åŠƒå—ã€ï¼Œæ²’æ‰¾å‡ºå¼µæ–‡éš¨æ©Ÿæ®ºäººäº‹ä»¶å¾Œçš„æ²»å®‰è¦åŠƒã€‚

**Agent å…±è­˜**: 5/5 ç¢ºèªã€‚èªæ„æœå°‹ç„¡æ³•é€£çµã€Œæ²»å®‰æ”¿ç­–ã€å’Œã€Œå¼µæ–‡äº‹ä»¶ã€ã€‚

**Dev æŒ‡ä»¤**: æŒ‰ç…§ç¬¬äºŒå€‹ agent å»ºè­°ä¿®å¾©ï¼ˆLLM-based query expansionï¼Œé hardcoded rule-basedï¼‰ã€‚

**ä¿®å¾©è¨ˆç•«**:
- **æ–¹æ¡ˆ**: åœ¨ Query Decomposition éšæ®µåŠ å…¥ LLM-based query expansion
- **å¯¦ä½œä½ç½®**: `core/query_analysis/` ä¸­çš„ query decomposition é‚è¼¯
- **åšæ³•**: åœ¨æœå°‹å‰ï¼Œè®“ LLM åˆ†ææŸ¥è©¢ä¸¦ç”Ÿæˆ 2-3 å€‹ç›¸é—œçš„æ“´å±•æŸ¥è©¢ã€‚ä¾‹å¦‚ï¼š
  - åŸå§‹: ã€Œæ²»å®‰æ”¿ç­–ã€
  - æ“´å±•: ã€Œæ²»å®‰æ”¿ç­–ã€ã€ã€Œé‡å¤§åˆ‘æ¡ˆ æ”¿åºœå›æ‡‰ã€ã€ã€ŒçŠ¯ç½ªé é˜² æ”¿ç­–ã€
- **æ³¨æ„**: ä½¿ç”¨ LLMï¼ˆè€Œé hardcoded è¦å‰‡ï¼‰ç¢ºä¿å¯æ“´å±•æ€§

---

### Bug #15: æŠ€è¡“å‹å·¥è‚¡ç¥¨æŸ¥è©¢å¤±æ•—

**User Report**: å•ã€ŒæŠ€è¡“å‹å·¥å¯èƒ½æ˜¯æœªä¾†ä¸æœƒè¢«AIå–ä»£çš„ç”¢æ¥­ï¼Œæœ‰æ²’æœ‰ç›¸é—œçš„è‚¡ç¥¨è³‡è¨Š?ã€ï¼Œå…¨é¢äº†è§£+å…¨é¢å›é¡§ç„¡æ³•å¾—åˆ°ç­”æ¡ˆã€‚

**Agent å…±è­˜**: 5/5 ç¢ºèªæ˜¯åŠŸèƒ½é™åˆ¶ï¼Œç³»çµ±ä¸æ”¯æ´ã€Œæ¦‚å¿µâ†’ç”¢æ¥­â†’å…¬å¸â†’è‚¡ç¥¨ä»£ç¢¼ã€æ¨ç†éˆã€‚

**Dev æŒ‡ä»¤**: æ‡‰è©²æœ‰ decontextualization æ©Ÿåˆ¶ä¾†å¹«å¿™ã€‚å¦å¤–ï¼Œcall API æ‡‰è©²å·²æœ‰ prompt èªªå¯ä»¥ä¸ç›´æ¥æŒ‡å®šè‚¡ç¥¨ä»£ç¢¼è€Œæ ¹æ“šèªæ„åˆ¤æ–·ã€‚é™¤éä¹‹å‰å¯¦ä½œä¸å®Œå…¨ï¼Œä¸å°±æ˜¯ agent æ²’æœ‰æŸ¥åˆ°ã€‚

**å›æ‡‰ Dev è¨è«–**:

é€™å€‹å•é¡Œå¯èƒ½æœ‰å…©å€‹å±¤é¢ï¼š

1. **Decontextualization å±¤é¢**: æŸ¥è©¢ã€ŒæŠ€è¡“å‹å·¥ä¸è¢«AIå–ä»£çš„ç”¢æ¥­çš„è‚¡ç¥¨ã€å¤ªæŠ½è±¡ã€‚Decontextualization æ‡‰è©²èƒ½å°‡å…¶æ‹†è§£ç‚ºæ›´å…·é«”çš„æœå°‹ï¼šã€Œæ°´é›»å·¥ æ¦‚å¿µè‚¡ã€ã€ã€ŒæŠ€è·æ•™è‚² ä¸Šå¸‚å…¬å¸ã€ç­‰ã€‚é€™å’Œ Bug #8 æ˜¯åŒé¡å•é¡Œâ€”â€”éœ€è¦å¢å¼·æŸ¥è©¢é‡å¯«çš„èƒ½åŠ›ã€‚

2. **API èª¿ç”¨å±¤é¢**: å¦‚æœ Tier 6 API çš„ stock æŸ¥è©¢ prompt å·²ç¶“æ”¯æ´èªæ„åˆ¤æ–·ï¼ˆä¸éœ€è¦ç›´æ¥æŒ‡å®šä»£ç¢¼ï¼‰ï¼Œé‚£å•é¡Œå¯èƒ½åœ¨ Analyst agent æ²’æœ‰æ­£ç¢ºåˆ¤æ–·éœ€è¦èª¿ç”¨ stock APIï¼Œæˆ–è€… Analyst çµ¦å‡ºçš„æŸ¥è©¢é—œéµå­—å¤ªæŠ½è±¡å°è‡´ API ç„¡æ³•åŒ¹é…ã€‚

**å»ºè­°èª¿æŸ¥**: å…ˆç¢ºèª Tier 6 API çš„ stock æŸ¥è©¢ prompt å¯¦éš›å…§å®¹ï¼Œä»¥åŠ Analyst åœ¨æ­¤æŸ¥è©¢ä¸­çš„æ±ºç­–éç¨‹ï¼ˆæ˜¯å¦å˜—è©¦äº† stock APIï¼Ÿå¦‚æœå˜—è©¦äº†ï¼Œç‚ºä»€éº¼å¤±æ•—ï¼Ÿï¼‰

---

### Bug #18-20: è¨˜è€…æ–‡ç« æœå°‹å•é¡Œ

**User Report**: æœå°‹ç‰¹å®šè¨˜è€…æ–‡ç« ï¼ˆéƒ­åˆè¯ã€ç‹å®ä»ã€ç‹è‹¥æ¨¸ï¼‰ï¼ŒçµæœåŒ…å«å…¶ä»–äººçš„æ–‡ç« ï¼Œæ™‚é–“è»¸æ²’ç…§é †åºã€‚

**Agent å…±è­˜**: 5/5 ç¢ºèªã€‚`retriever.py` é™¤äº† site åƒæ•¸å¤–æ²’æœ‰ä»»ä½• metadata payload filterã€‚

**Dev æŒ‡ä»¤**: Qdrant è£¡é¢ç¢ºå¯¦æœ‰ author è³‡è¨Šã€‚è«‹å¯¦éš›å»çœ‹æ€éº¼åšï¼Œä½¿ç”¨è€…è¦æ±‚çš„å…§å®¹æ˜¯å¯ä»¥åšåˆ°çš„ã€‚

**ä¿®å¾©è¨ˆç•«**:
- **æ­¥é©Ÿ 1 â€” ç¢ºèª Qdrant schema**: æŸ¥çœ‹ Qdrant collection ä¸­ payload æ˜¯å¦æœ‰ `author` æ¬„ä½åŠå…¶æ ¼å¼
- **æ­¥é©Ÿ 2 â€” Query Analysis è­˜åˆ¥ä½œè€…æ„åœ–**: åœ¨ `core/query_analysis/` ä¸­åŠ å…¥ã€Œä½œè€…æœå°‹ã€æ„åœ–è­˜åˆ¥ï¼ˆä¾‹å¦‚ã€ŒXXXè¨˜è€…çš„æ–‡ç« ã€ã€ã€ŒXXXå¯«çš„ã€ï¼‰
- **æ­¥é©Ÿ 3 â€” Retriever åŠ å…¥ author filter**: åœ¨ `retriever.py` çš„ `search()` ä¸­ï¼Œç•¶è­˜åˆ¥åˆ°ä½œè€…æ„åœ–æ™‚ï¼ŒåŠ å…¥ Qdrant `FieldCondition` å° `author` æ¬„ä½åšç²¾ç¢ºåŒ¹é…
- **æ­¥é©Ÿ 4 â€” æ’åºé¸é …**: æä¾›æ™‚é–“æ’åºé¸é …ï¼ˆé™¤äº†é è¨­çš„ç›¸é—œæ€§æ’åºï¼‰

---

### Bug #21: æ·±åº¦ç ”ç©¶è¨˜è€…æŸ¥è©¢è·‘ä¸å‡ºçµæœ

**User Report**: å•ã€Œææ˜€ç’‡è¨˜è€…æ˜¯èª°?ã€çµæœè·‘ä¸å‡ºä¾†ã€‚

**Agent å…±è­˜**: 5/5 ç¢ºèªæ˜¯é æœŸè¡Œç‚ºï¼ˆè³‡æ–™åº«åªæœ‰æ–°èæ–‡ç« ï¼Œæ²’æœ‰è¨˜è€…å€‹äººè³‡æ–™ï¼‰ã€‚

**Dev æŒ‡ä»¤**: å¦‚æœå¯ä»¥æœå°‹ Author è³‡è¨Šï¼Œå°±å¯ä»¥æ ¹æ“šæ™‚é–“ã€æ–°èæ¨™é¡Œã€æœå‹™åª’é«”ä¾†å¾—å‡ºçµæœã€‚é€™æ‡‰è©²åšå¾—åˆ°ã€‚

**å›æ‡‰ Dev è¨è«–**:

ç¢ºå¯¦å¯ä»¥åšåˆ°ã€‚ä¿®å¾©æ–¹å¼èˆ‡ Bug #18-20 ç›¸é—œï¼š

1. ç•¶ç”¨æˆ¶å•ã€ŒXXX æ˜¯èª°ï¼Ÿã€ä¸” XXX æ˜¯ä¸€å€‹è¨˜è€…åå­—æ™‚ï¼ˆå¯ä»¥é€šé Qdrant ä¸­çš„ author æ¬„ä½åæŸ¥ï¼‰ï¼Œç³»çµ±å¯ä»¥ï¼š
   - æœå°‹è©² author çš„æ‰€æœ‰æ–‡ç« 
   - å¾çµæœä¸­æå–ï¼šæœå‹™åª’é«”ã€æ’°å¯«ä¸»é¡Œé ˜åŸŸã€æ´»èºæ™‚é–“ç¯„åœã€ä»£è¡¨ä½œå“
   - ç”Ÿæˆé¡ä¼¼ã€ŒXXX æ˜¯ {åª’é«”} çš„è¨˜è€…ï¼Œä¸»è¦å ±å° {é ˜åŸŸ}ï¼Œè¿‘æœŸä½œå“åŒ…æ‹¬ {æ–‡ç« åˆ—è¡¨}ã€çš„å›ç­”

2. **å¯¦ä½œä¾è³´**: é€™éœ€è¦ Bug #18-20 çš„ author filter åŠŸèƒ½å…ˆå®Œæˆï¼Œç„¶å¾Œåœ¨ Deep Research çš„ Analyst agent ä¸­åŠ å…¥ã€Œäººç‰©æŸ¥è©¢ â†’ author filter æœå°‹ã€çš„é‚è¼¯ã€‚

---

## è·¨ Bug æ•´åˆä¿®å¾©

### æ•´åˆ 1: Free Conversation Prompt å…¨é¢å‡ç´š

Bug #1, #3, #9, #24 éƒ½æ¶‰åŠ `synthesize_free_conversation()` çš„ prompt æ”¹é€²ã€‚æ‡‰ä¸€æ¬¡æ€§ä¿®æ”¹ï¼š

- æ³¨å…¥ç•¶å‰æ—¥æœŸï¼ˆBug #1ï¼‰
- åŠ å…¥ç³»çµ±å…ƒè³‡è¨Š/é™åˆ¶èªªæ˜ï¼ˆBug #3ï¼‰
- åŠ å…¥ç³»çµ±èƒ½åŠ›èªªæ˜å’Œæ“ä½œå»ºè­°ï¼ˆBug #9ï¼‰
- è¦æ±‚ Markdown æ ¼å¼è¼¸å‡ºï¼ˆBug #24ï¼‰

### æ•´åˆ 2: Retriever æ¶æ§‹å‡ç´š

Bug #11, #16, #17ï¼ˆæ™‚é–“éƒ¨åˆ†ï¼‰, #18-20 éƒ½æ¶‰åŠ `retriever.py` ç¼ºå°‘ payload filterã€‚æ‡‰ä¸€æ¬¡æ€§åŠ å…¥ï¼š

- æ™‚é–“ç¯„åœéæ¿¾ï¼ˆ`datePublished` fieldï¼‰
- ä½œè€…éæ¿¾ï¼ˆ`author` fieldï¼‰
- Fallback æ©Ÿåˆ¶ï¼ˆåš´æ ¼éæ¿¾ç„¡çµæœæ™‚æ“´å¤§ç¯„åœ + æç¤ºç”¨æˆ¶ï¼‰

### æ•´åˆ 3: å‰ç«¯è¼¸å…¥é«”é©—

Bug #10, #23 éƒ½æ¶‰åŠå‰ç«¯è¼¸å…¥/ä¸²æµæ§åˆ¶ã€‚æ‡‰ä¸€èµ·ä¿®æ”¹ï¼š

- IME è™•ç†ï¼ˆBug #10ï¼‰
- Abort æŒ‰éˆ•å’Œç‹€æ…‹ç®¡ç†ï¼ˆBug #23ï¼‰
- è¼¸å…¥æ¡† placeholder èªªæ˜ï¼ˆBug #2 çš„å‰ç«¯éƒ¨åˆ†ï¼‰

---

*è¨ˆç•«å»ºç«‹æ—¥æœŸï¼š2026-01-29*

---

## Agent é©—è­‰å ±å‘Š #1

> é©—è­‰æ—¥æœŸï¼š2026-01-29
> é©—è­‰è€…ï¼šClaude Code (Verification Agent #1)
> æ–¹æ³•ï¼šé€é …è®€å–å¯¦éš›ç¨‹å¼ç¢¼ï¼Œèˆ‡ä¿®å¾©è¨ˆç•«äº¤å‰æ¯”å°

### é©—è­‰çµ±è¨ˆ

| çµæœ | Bug æ•¸é‡ | Bug ç·¨è™Ÿ |
|------|---------|---------|
| âœ… ä¿®å¾©è¨ˆç•«å¯è¡Œ | 13 å€‹ | #1, #3, #9, #10, #13, #22, #24, #4/#5, #7, #8, #12, #14, #21 |
| âš ï¸ è¨ˆç•«éœ€è¦è£œå…… | 8 å€‹ | #6, #11/#16, #17, #2, #25, #23, #15, #18-20 |
| âŒ è¨ˆç•«æœ‰å•é¡Œ | 0 å€‹ | â€” |

### é€é …é©—è­‰

---

#### Bug #1: æ—¥æœŸè¬Šç¨±å•é¡Œ
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨‹å¼ç¢¼é©—è­‰**: è®€å– `generate_answer.py:631-686`ï¼Œç¢ºèªä¸‰å€‹ prompt è®Šé«”ï¼ˆ`has_research_report` line 633ã€`has_cached_articles` line 648ã€`else` line 674ï¼‰å‡ç„¡æ—¥æœŸæ³¨å…¥ã€‚
- **è£œå……**: ç„¡ã€‚è¨ˆç•«æè¿°æº–ç¢ºï¼Œä¿®å¾©ç°¡å–®ç›´æ¥ã€‚

---

#### Bug #6: æ™‚é–“ç¯„åœè¨ˆç®—éŒ¯èª¤
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦è£œå……
- **ç¨‹å¼ç¢¼é©—è­‰**: è®€å– `time_range_extractor.py:38-88` å’Œ `:189-221`ã€‚
  - ç¢ºèªæ‰€æœ‰ `_zh` regex ç¢ºå¯¦åªç”¨ `(\d+)`ï¼Œç„¡æ³•åŒ¹é…ä¸­æ–‡æ•¸å­—ã€‚
  - Prefix ä¸ä¸€è‡´å·²ç¢ºèªï¼š`last_x_days_zh` åªç”¨ `æœ€è¿‘`ï¼Œ`last_x_months_zh`/`last_x_years_zh` ç”¨ `(?:è¿‘|æœ€è¿‘)`ã€‚
  - è§£æé‚è¼¯ line 196/202/209/217 ç¢ºå¯¦ç”¨ `int(match.group(1))`ã€‚
- **è£œå……/ä¿®æ­£**:
  1. **CHINESE_NUMBERS å­—å…¸ä¸å¤ å®Œæ•´**ï¼šè¨ˆç•«åªæ¶µè“‹åˆ° `åäºŒ`(12)ã€‚ä½†ä½¿ç”¨è€…å¯èƒ½èªªã€Œè¿‘åäº”å¤©ã€(15)ã€ã€Œéå»äºŒåå¹´ã€(20)ã€‚å»ºè­° `parse_number()` åŠ å…¥çµ„åˆæ•¸å­—è™•ç†é‚è¼¯ï¼ˆå¦‚ `åäº”` = 10+5 = 15ï¼Œ`äºŒå` = 2Ã—10 = 20ï¼‰ã€‚
  2. **`past_x_*_zh` prefix ä¹Ÿéœ€è¦æ“´å±•**ï¼šè¨ˆç•«åªæåˆ°çµ±ä¸€ `last_x_*_zh` çš„ prefix ç‚º `(?:è¿‘|æœ€è¿‘)`ï¼Œä½† `past_x_*_zh` çš„ `éå»` ä¹Ÿæ‡‰è©²åŠ å…¥ `è¿‘` çš„åŒ¹é…ï¼ˆä½¿ç”¨è€…å¯èƒ½èªªã€Œè¿‘ä¸‰å¤©ã€è€Œä¸æ˜¯ã€Œéå»ä¸‰å¤©ã€æˆ–ã€Œæœ€è¿‘ä¸‰å¤©ã€ï¼‰ã€‚å»ºè­°æ‰€æœ‰ `_zh` æ¨¡å¼çš„ prefix çµ±ä¸€ç‚º `(?:è¿‘|æœ€è¿‘|éå»)`ã€‚

---

#### Bug #10: Mac è¼¸å…¥æ³• Enter å•é¡Œ
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨‹å¼ç¢¼é©—è­‰**: è®€å– `news-search.js`ï¼Œæ‰¾åˆ° 4 å€‹ `keydown` listenerï¼š
  - **Line 378**: ESC é—œé–‰ history popup â€” ä¸æ¶‰åŠ Enterï¼Œä¸éœ€ä¿®æ”¹
  - **Line 1218**: ä¸»æœå°‹æ¡† â€” `if (e.key === 'Enter' && !e.shiftKey)` â€” **ç¼ºå°‘ `!e.isComposing`** â† é—œéµä¿®å¾©é»
  - **Line 4326**: é‡æ–°å‘½å input â€” Enter è§¸ç™¼ blur â€” éæœå°‹ç›¸é—œï¼Œä½å„ªå…ˆ
  - **Line 4656**: è³‡æ–™å¤¾é‡æ–°å‘½å â€” åŒä¸Š
- **è£œå……**: è¨ˆç•«æ­£ç¢ºã€‚ä¸»è¦ä¿®å¾©ç›®æ¨™æ˜¯ line 1218ï¼ˆæœå°‹æ¡†ï¼‰ã€‚å¦å¤–éœ€ç¢ºèª Free Conversation è¼¸å…¥æ¡†çš„ keydown handler æ˜¯å¦ä¹Ÿéœ€è¦ï¼ˆå¯èƒ½åœ¨ `performFreeConversation` ç›¸é—œçš„ input listener ä¸­ï¼‰ã€‚

---

#### Bug #11 + #16: æ™‚é–“éæ¿¾ç¼ºå¤±
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦è£œå……
- **ç¨‹å¼ç¢¼é©—è­‰**: è®€å– `retriever.py:817-937` `search()` æ–¹æ³•ã€‚ç¢ºèªå®Œå…¨æ²’æœ‰æ™‚é–“éæ¿¾é‚è¼¯ â€” åªåš endpoint parallel query + aggregate + deduplicateã€‚
- **è£œå……/ä¿®æ­£**:
  1. **æŠ½è±¡å±¤å•é¡Œ**ï¼š`retriever.py` æ˜¯çµ±ä¸€ä»‹é¢ï¼Œæ”¯æ´ Azure AI Searchã€Qdrantã€Milvus ç­‰å¤šå¾Œç«¯ã€‚è¨ˆç•«èªªã€ŒåŠ å…¥ Qdrant FieldConditionã€ï¼Œä½†ç›´æ¥åœ¨ `retriever.py` ä¸­åŠ å…¥ Qdrant ç‰¹å®šçš„ filter æœƒç ´å£æŠ½è±¡ã€‚å»ºè­°æ”¹ç‚ºï¼šåœ¨ `search()` çš„ `**kwargs` ä¸­å‚³å…¥é€šç”¨çš„ `time_filter` åƒæ•¸ï¼ˆå¦‚ `{"field": "datePublished", "gte": "2026-01-01", "lte": "2026-01-29"}`ï¼‰ï¼Œç”±å„ provider è‡ªè¡Œè½‰æ›ç‚ºå°æ‡‰çš„ filter æ ¼å¼ã€‚
  2. **æ™‚é–“è§£æçµæœçš„å‚³éè·¯å¾‘ä¸æ˜ç¢º**ï¼š`time_range_extractor.py` çš„çµæœå­˜åœ¨ `handler.temporal_range` ä¸­ï¼Œä½† `retriever.py:search()` çš„å‘¼å«æ–¹ï¼ˆ`baseHandler.py`ï¼‰å¦‚ä½•å°‡æ­¤çµæœå‚³çµ¦ retrieverï¼Ÿè¨ˆç•«æ²’æœ‰èªªæ˜é€™å€‹è³‡æ–™æµã€‚
  3. **Dev æŒ‡ä»¤å®Œæ•´æ€§**ï¼šDev è¦æ±‚ã€Œreasoning module ä¸­çš„ temporal search æ©Ÿåˆ¶ä¹Ÿæ‡‰è©²åœ¨æ–°èæœå°‹åŠŸèƒ½ä¸­ä½¿ç”¨ã€ã€‚è¨ˆç•«çš„æ­¥é©Ÿ 1 æœ‰æåˆ°èª¿æŸ¥ reasoning çš„ temporal searchï¼Œä½†ç¼ºå°‘å…·é«”çš„è¤‡ç”¨æ–¹æ¡ˆã€‚å»ºè­°åœ¨æ­¥é©Ÿ 1 å®Œæˆå¾Œï¼Œæ˜ç¢ºè¨˜éŒ„å¯è¤‡ç”¨çš„é‚è¼¯ã€‚

---

#### Bug #13: å¼•ç”¨é€£çµ private:// å•é¡Œ
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨‹å¼ç¢¼é©—è­‰**: è®€å– `news-search.js:1580-1603` `addCitationLinks()` å‡½æ•¸ã€‚ç¢ºèªï¼š
  - æœ‰ `urn:llm:knowledge:` è™•ç†ï¼ˆline 1592ï¼‰â†’ é¡¯ç¤º `[N]<sup>AI</sup>`
  - æœ‰ä¸€èˆ¬ URL è™•ç†ï¼ˆline 1598ï¼‰â†’ é¡¯ç¤º `<a>` é€£çµ
  - **æ²’æœ‰** `private://` è™•ç†
- **è£œå……**: è¨ˆç•«æº–ç¢ºã€‚å»ºè­°åœ¨ line 1596 ä¹‹å¾Œã€line 1598 ä¹‹å‰åŠ å…¥ `private://` æª¢æŸ¥ã€‚

---

#### Bug #17: çŸ¥è­˜åœ–è­œæ”¶ä¸èµ·ä¾†
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦è£œå……
- **ç¨‹å¼ç¢¼é©—è­‰**: è®€å– `news-search.js:2383-2401` KG toggle handlerï¼š
  ```javascript
  // Line 2385-2387: åªå–å¾— kgDisplayContentï¼Œæ²’æœ‰ kgGraphView
  const toggleButton = document.getElementById('kgToggleButton');
  const content = document.getElementById('kgDisplayContent');
  const icon = document.getElementById('kgToggleIcon');
  // Line 2391-2399: åªæ“ä½œ content çš„ .collapsed class
  ```
  - ç¢ºèªï¼štoggle åªæ“ä½œ `kgDisplayContent` çš„ `.collapsed` classï¼Œä¸å½±éŸ¿ `kgGraphView`ã€‚
  - Lines 2012-2013 å¼•ç”¨ `kgGraphView` å’Œ `kgDisplayContent` â€” åœ–å½¢/åˆ—è¡¨åˆ‡æ›å¯èƒ½ç”¨ inline styleã€‚
- **è£œå……/ä¿®æ­£**:
  1. è¨ˆç•«çš„ wrapper å®¹å™¨æ–¹æ¡ˆæŠ€è¡“ä¸Šå¯è¡Œï¼Œä½†éœ€ç¢ºèª `kgLegend` å…ƒç´ çš„ä½ç½®ã€‚å¦‚æœ `kgLegend` åœ¨ `kgDisplayContainer` å¤–é¢ï¼Œwrap å¯èƒ½éºæ¼å®ƒã€‚
  2. è¨ˆç•«èªªã€Œç§»é™¤ `.kg-display-content.collapsed` è¦å‰‡ã€â€” éœ€å…ˆç¢ºèªè©² CSS è¦å‰‡æ˜¯å¦åœ¨ `news-search.css` ä¸­å­˜åœ¨åŠæ˜¯å¦è¢«å…¶ä»–åœ°æ–¹å¼•ç”¨ã€‚
  3. **æ›´ç°¡å–®çš„æ›¿ä»£æ–¹æ¡ˆ**ï¼šä¸åŠ  wrapperï¼Œè€Œæ˜¯è®“ toggle handler ç›´æ¥æ“ä½œ `kgDisplayContainer` çš„ `style.display`ï¼ˆè€Œéå­å…ƒç´ ï¼‰ï¼Œå› ç‚º container å·²ç¶“åŒ…å«æ‰€æœ‰å­å…ƒç´ ã€‚é€™é¿å…äº† HTML çµæ§‹è®Šæ›´ã€‚éœ€å…ˆè®€ HTML ç¢ºèª `kgDisplayContainer` çš„çµæ§‹æ˜¯å¦é©åˆæ­¤æ–¹æ¡ˆã€‚

---

#### Bug #22: å¼•ç”¨æ ¼å¼ä¸é€šé †
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨‹å¼ç¢¼é©—è­‰**: è®€å– `reasoning/prompts/writer.py:178-285` `build_compose_prompt()` æ–¹æ³•ã€‚ç¢ºèªï¼š
  - Line 196-198: æœ‰å¼•ç”¨ç™½åå–®ç´„æŸï¼ˆåš´ç¦ç„¡ä¸­ç”Ÿæœ‰ï¼‰
  - Line 247-249: æœ‰ sources_used é™åˆ¶
  - **æ²’æœ‰** å¼•ç”¨ã€Œèªæ³•é¢¨æ ¼ã€æŒ‡å¼•
- **è£œå……/ä¿®æ­£**: è¨ˆç•«æåˆ°ä¿®æ”¹ `_citation_rules()` æ–¹æ³•ï¼Œä½†å¯¦éš›ç¨‹å¼ç¢¼ä¸­æ²’æœ‰é€™å€‹æ–¹æ³•ã€‚å¼•ç”¨é¢¨æ ¼æŒ‡å¼•æ‡‰åŠ å…¥ `build_compose_prompt()` çš„ prompt å­—ä¸²ä¸­ï¼Œå»ºè­°åœ¨ line 198ï¼ˆç™½åå–®èªªæ˜ï¼‰ä¹‹å¾Œã€line 200ï¼ˆä»»å‹™æµç¨‹ï¼‰ä¹‹å‰æ’å…¥ã€‚

---

#### Bug #25: å¼•ç”¨æ•¸å­—å¤ªå¤§æ²’æœ‰è¶…é€£çµ
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦è£œå……
- **ç¨‹å¼ç¢¼é©—è­‰**: è®€å– `orchestrator.py:1111-1139` source_urls æ§‹å»ºé‚è¼¯ï¼š
  ```python
  # Line 1114-1115: é™£åˆ—ç¯„åœç”± source_map çš„æœ€å¤§ key æ±ºå®š
  source_urls = []
  max_cid = max(self.source_map.keys()) if self.source_map else 0
  # Line 1121-1136: éæ­· 1 åˆ° max_cidï¼Œç¼ºå¤±çš„ ID å¡«ç©ºå­—ä¸²
  ```
  å‰ç«¯ `addCitationLinks()` (JS line 1588): `if (index >= 0 && index < sources.length)` â€” è¶…å‡º sources é•·åº¦çš„å¼•ç”¨ç›´æ¥è¿”å›åŸæ–‡ `[N]`ã€‚
- **æ ¹å› ç¢ºèª**: å¦‚æœ Writer å¼•ç”¨äº† `[15]` ä½† `source_map` æœ€å¤§ key æ˜¯ `10`ï¼Œ`source_urls` åªæœ‰ 10 å€‹å…ƒç´ ï¼Œå‰ç«¯æ­£ç¢ºåœ°ä¸ç‚º `[15]` å»ºç«‹é€£çµã€‚
- **è£œå……/ä¿®æ­£**:
  1. **æ–¹æ¡ˆ A éœ€è¦ç²¾ç¢ºä¿®æ­£**ï¼šå°‡ line 1115 æ”¹ç‚º `max_cid = max(max(self.source_map.keys(), default=0), max(final_report.sources_used, default=0))`ã€‚é€™ç¢ºä¿ source_urls é™£åˆ—è¦†è“‹ Writer å¯¦éš›ä½¿ç”¨çš„æ‰€æœ‰ citation IDã€‚ä½†è¶…å‡º source_map çš„ ID ä»æœƒæ˜¯ç©ºå­—ä¸²ã€‚
  2. **æ–¹æ¡ˆ B çš„ prompt ä½ç½®**ï¼šæ‡‰åŠ å…¥ `writer.py:build_compose_prompt()` ä¸­ï¼Œå…·é«”æ˜¯åœ¨ line 247 é™„è¿‘çš„ sources_used é™åˆ¶èªªæ˜ä¸­ï¼ŒåŠ å…¥æ›´å¼·çš„æ•¸å­—ç¯„åœç´„æŸã€‚
  3. **æ–¹æ¡ˆ C çš„å‰ç«¯å¯¦ä½œ**ï¼šä¿®æ”¹ `addCitationLinks()` çš„ line 1601ï¼Œå°‡ `return match` æ”¹ç‚ºè¿”å›å¸¶ tooltip çš„ spanã€‚

---

#### Bug #2: Free Conversation åªç”¨å‰ 10 å€‹ Cache çµæœ
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦è£œå……
- **ç¨‹å¼ç¢¼é©—è­‰**: è®€å– `news-search.js:2741-2758` `togglePinNewsCard()` å‡½æ•¸ï¼š
  ```javascript
  pinnedNewsCards.push({
      url,
      title,
      pinnedAt: Date.now()
  });
  ```
  **ç¢ºèªåªå­˜ urlã€titleã€pinnedAt â€” æ²’æœ‰ description/snippet**ã€‚
- **è£œå……/ä¿®æ­£**:
  1. **Dev æŒ‡ä»¤ç¬¬ 3 é»ç¢ºèª**ï¼šé‡˜é¸åŠŸèƒ½ç¢ºå¯¦åªå­˜æ¨™é¡Œå’Œ URLï¼ˆç„¡æ‘˜è¦ï¼‰ã€‚éœ€è¦ä¿®æ”¹ `togglePinNewsCard()` çš„åƒæ•¸ï¼Œå¢åŠ  `description` ä¸¦å­˜å…¥ `pinnedNewsCards` é™£åˆ—ã€‚
  2. **è³‡æ–™ä¾†æº**ï¼š`description` å¯å¾ news card çš„ `schema.description`ï¼ˆline 1111ï¼‰å–å¾—ã€‚éœ€è¦åœ¨å‘¼å« `togglePinNewsCard(url, title)` çš„åœ°æ–¹ä¹Ÿå‚³å…¥ descriptionã€‚
  3. **å¾Œç«¯ context æ³¨å…¥ä¿®æ”¹**ï¼šè¨ˆç•«çš„æ­¥é©Ÿ 3 æåˆ°ä¿®æ”¹ `synthesize_free_conversation()` çš„ context æ³¨å…¥ï¼Œä½†æ²’æœ‰èªªæ˜é‡˜é¸è³‡æ–™å¦‚ä½•å¾å‰ç«¯å‚³åˆ°å¾Œç«¯ã€‚ç›®å‰ Free Conversation çš„ POST è«‹æ±‚æ˜¯å¦åŒ…å«é‡˜é¸è³‡æ–™ï¼Ÿéœ€è¦ç¢ºèª API å”è­°ã€‚

---

#### Bug #3: åˆç†åŒ–éŒ¯èª¤ç­”æ¡ˆ
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨‹å¼ç¢¼é©—è­‰**: åŒ Bug #1ï¼Œå·²ç¢ºèª prompt ä¸­ç„¡ç³»çµ±é™åˆ¶èªªæ˜ã€‚è¨ˆç•«çš„ç³»çµ±å…ƒè³‡è¨ŠåŠ å…¥æ–¹æ¡ˆæ­£ç¢ºã€‚

---

#### Bug #4 + #5: æ·±åº¦ç ”ç©¶æ­§ç¾©æª¢æ¸¬
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨‹å¼ç¢¼é©—è­‰**: æœªæ·±å…¥é©—è­‰å‰ç«¯ clarification æ¸²æŸ“ç¨‹å¼ç¢¼ï¼Œä½†è¨ˆç•«æ–¹å‘ï¼ˆåŠ å…¥è‡ªç”±æ–‡å­—è¼¸å…¥å’Œã€Œæ²’æœ‰ã€æŒ‰éˆ•ï¼‰åˆç†ã€‚
- **è£œå……**: è¨ˆç•«æœªæŒ‡å®šå…·é«”çš„å‰ç«¯ä¿®æ”¹æª”æ¡ˆå’Œä½ç½®ã€‚éœ€ç¢ºèª clarification é¸é …çš„æ¸²æŸ“é‚è¼¯åœ¨ `news-search.js` çš„å“ªå€‹å‡½æ•¸ä¸­ã€‚

---

#### Bug #9: ç„¡æ³•å­˜å–å³æ™‚æ–°èçš„å›è¦†
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨‹å¼ç¢¼é©—è­‰**: åŒ Bug #1ï¼Œå·²ç¢ºèª prompt ä¸­ç„¡ç³»çµ±èƒ½åŠ›èªªæ˜ã€‚è¨ˆç•«æ–¹æ¡ˆæ­£ç¢ºã€‚

---

#### Bug #14: æ‘˜è¦å›é¥‹æŒ‰éˆ•
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œï¼ˆéœ€ /planï¼‰
- **ç¨‹å¼ç¢¼é©—è­‰**: æœªæ·±å…¥é©—è­‰ï¼ˆè¨ˆç•«æ˜ç¢ºèªªéœ€è¦å•Ÿå‹• /planï¼‰ã€‚åˆæ­¥æ–¹å‘åˆç†ã€‚
- **è£œå……**: Dev çš„å®Œæ•´æŒ‡ä»¤æ˜¯ã€ŒåŠ ä¸€å€‹å°å°è©±æ¡†ï¼Œçµ¦äºˆæ­£é¢æˆ–è² é¢å›é¥‹ä¹‹å¾Œè·³å‡ºã€‚å°è©±æ¡† placeholder: æ„Ÿè¬æä¾›æ„è¦‹...ã€‚æ‰“å®ŒæŒ‰æäº¤ï¼Œé€åˆ°è³‡æ–™åº«æˆ– Google Sheetã€‚ã€è¨ˆç•«æœ‰è¦†è“‹é€™äº›éœ€æ±‚ã€‚

---

#### Bug #23: æš«åœå°è©±æŒ‰éˆ•ç¼ºå¤±
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦è£œå……
- **ç¨‹å¼ç¢¼é©—è­‰**: è®€å– `news-search.js:1225-1254`ã€‚**ç™¼ç¾**ï¼š
  - `cancelActiveSearch()` å‡½æ•¸å·²å­˜åœ¨ï¼ˆline 1226ï¼‰ï¼Œä½¿ç”¨ `AbortController.abort()` å’Œ `EventSource.close()`
  - `currentSearchAbortController` åœ¨ `performSearch()` ä¸­å»ºç«‹ï¼ˆline 1246ï¼‰
  - ä½†é€™æ˜¯**å…§éƒ¨è‡ªå‹•å–æ¶ˆ**ï¼ˆæ–°æœå°‹å–æ¶ˆèˆŠæœå°‹ï¼‰ï¼Œ**æ²’æœ‰ç”¨æˆ¶å¯è¦‹çš„ UI æŒ‰éˆ•**
- **è£œå……/ä¿®æ­£**:
  1. è¨ˆç•«çš„æ­¥é©Ÿ 1 èªªã€Œå°‡ EventSource å’Œ AbortController å­˜ç‚ºæ¨¡çµ„ç´šè®Šæ•¸ã€â€” ä½† `currentSearchAbortController` å’Œ `currentSearchEventSource` **å·²ç¶“æ˜¯æ¨¡çµ„ç´šè®Šæ•¸**ï¼ˆline 1228-1234ï¼‰ã€‚æœå°‹åŠŸèƒ½çš„ abort åŸºç¤è¨­æ–½å·²å­˜åœ¨ã€‚
  2. çœŸæ­£ç¼ºå°‘çš„æ˜¯ï¼š(a) ç”¨æˆ¶å¯è¦‹çš„åœæ­¢æŒ‰éˆ• UIï¼›(b) Deep Research å’Œ Free Conversation çš„ abort åŸºç¤è¨­æ–½ï¼ˆæœå°‹åŠŸèƒ½å·²æœ‰ï¼Œä½†å…¶ä»–å…©å€‹æ¨¡å¼å¯èƒ½æ²’æœ‰ï¼‰ã€‚
  3. è¨ˆç•«æ‡‰åˆ©ç”¨ç¾æœ‰çš„ `cancelActiveSearch()` ä½œç‚ºåŸºç¤ï¼Œæ“´å±•åˆ°æ‰€æœ‰æ¨¡å¼ï¼Œä¸¦åŠ å…¥ UI ç‹€æ…‹æ©Ÿã€‚

---

#### Bug #24: å›è¦†æ²’æœ‰æ’ç‰ˆæ›è¡Œ
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨‹å¼ç¢¼é©—è­‰**: ç¢ºèªå‰ç«¯ä½¿ç”¨ `marked.parse()` åš Markdown æ¸²æŸ“ï¼Œå•é¡Œåœ¨ prompt æ²’æœ‰è¦æ±‚ Markdown æ ¼å¼ã€‚è¨ˆç•«çš„ã€Œåœ¨ prompt ä¸­åŠ å…¥ Markdown æ ¼å¼è¦æ±‚ã€æ–¹å‘æ­£ç¢ºã€‚
- **è£œå……**: è¨ˆç•«æ­£ç¢ºæåˆ°ã€Œçµ•å°ä¸è¦åœ¨å¾Œç«¯åš `\n` â†’ `<br>` æ›¿æ›ã€ã€‚

---

#### Bug #7: ç¼ºå°‘ç´«è‰²è™›ç·šæ¨™è¨˜ AI çŸ¥è­˜
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œï¼ˆéœ€é€²ä¸€æ­¥èª¿æŸ¥ï¼‰
- **ç¨‹å¼ç¢¼é©—è­‰**: è®€å– `orchestrator.py:1331-1350`ï¼Œç¢ºèª `GapResolutionType.LLM_KNOWLEDGE` è™•ç†é‚è¼¯å­˜åœ¨ã€‚è¨ˆç•«çš„èª¿æŸ¥æ–¹å‘æ­£ç¢ºã€‚

---

#### Bug #8: æ²’æœ‰çœŸçš„åˆ—å‡º 12 æœˆåå¤§æ–°è
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œï¼ˆåŠŸèƒ½é™åˆ¶ï¼Œéœ€é€²ä¸€æ­¥èª¿æŸ¥ Decontextualizationï¼‰
- **ç¨‹å¼ç¢¼é©—è­‰**: æœªæ·±å…¥é©—è­‰ Decontextualization ç¨‹å¼ç¢¼ï¼Œä½†è¨ˆç•«æ–¹å‘åˆç†ã€‚

---

#### Bug #12: æ²»å®‰æ”¿ç­–æ²’æ‰¾åˆ°å¼µæ–‡äº‹ä»¶
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨‹å¼ç¢¼é©—è­‰**: æœªæ·±å…¥é©—è­‰ query decomposition ç¨‹å¼ç¢¼ï¼Œä½† LLM-based query expansion æ–¹æ¡ˆåˆç†ã€‚

---

#### Bug #15: æŠ€è¡“å‹å·¥è‚¡ç¥¨æŸ¥è©¢å¤±æ•—
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦è£œå……
- **ç¨‹å¼ç¢¼é©—è­‰**: æœªè®€å– Tier 6 stock API promptã€‚è¨ˆç•«æ­£ç¢ºæŒ‡å‡ºéœ€è¦å…ˆèª¿æŸ¥ API prompt å’Œ Analyst æ±ºç­–éç¨‹ã€‚
- **è£œå……**: è¨ˆç•«ç¼ºå°‘å…·é«”çš„èª¿æŸ¥æ­¥é©Ÿã€‚å»ºè­°å…ˆè®€å– `reasoning/prompts/analyst.py` ä¸­çš„ Tier 6 API å‘¼å«åˆ¤æ–·é‚è¼¯ã€‚

---

#### Bug #18-20: è¨˜è€…æ–‡ç« æœå°‹å•é¡Œ
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦è£œå……
- **ç¨‹å¼ç¢¼é©—è­‰**: åŒ Bug #11/#16 çš„ retriever æŠ½è±¡å±¤å•é¡Œã€‚
- **è£œå……**: èˆ‡ Bug #11/#16 çš„ time filter é¢è‡¨ç›¸åŒçš„æŠ½è±¡å±¤è¨­è¨ˆå•é¡Œã€‚å»ºè­°ä¸€ä½µè¨­è¨ˆé€šç”¨çš„ payload filter æ©Ÿåˆ¶ï¼Œè€Œéåˆ†åˆ¥è™•ç† time å’Œ authorã€‚

---

#### Bug #21: æ·±åº¦ç ”ç©¶è¨˜è€…æŸ¥è©¢è·‘ä¸å‡ºçµæœ
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œï¼ˆä¾è³´ Bug #18-20ï¼‰
- **ç¨‹å¼ç¢¼é©—è­‰**: è¨ˆç•«æ­£ç¢ºæŒ‡å‡ºä¾è³´é—œä¿‚ã€‚

---

### éºæ¼ç™¼ç¾

1. **Bug #22: `_citation_rules()` æ–¹æ³•ä¸å­˜åœ¨** â€” è¨ˆç•«æåˆ°ä¿®æ”¹ `_citation_rules()` æ–¹æ³•ï¼Œä½† `writer.py` ä¸­æ²’æœ‰æ­¤æ–¹æ³•ã€‚å¯¦éš›æ‡‰ä¿®æ”¹ `build_compose_prompt()` æ–¹æ³•ï¼ˆline 135ï¼‰ã€‚

2. **Bug #23: ç¾æœ‰ abort åŸºç¤è¨­æ–½æœªè¢«è¨ˆç•«æåŠ** â€” `cancelActiveSearch()` å‡½æ•¸å’Œæ¨¡çµ„ç´š `AbortController`/`EventSource` è®Šæ•¸å·²å­˜åœ¨ï¼Œè¨ˆç•«æ‡‰åŸºæ–¼æ­¤æ“´å±•è€Œéå¾é›¶å»ºç«‹ã€‚

3. **Bug #2: å‰å¾Œç«¯è³‡æ–™å‚³éå”è­°ç¼ºå¤±** â€” è¨ˆç•«æè¿°äº†å‰ç«¯æ“´å±•é‡˜é¸è³‡æ–™å’Œå¾Œç«¯ä¿®æ”¹ context æ³¨å…¥ï¼Œä½†æ²’æœ‰èªªæ˜é‡˜é¸è³‡æ–™å¦‚ä½•å¾å‰ç«¯å‚³è¼¸åˆ°å¾Œç«¯ï¼ˆAPI è«‹æ±‚æ ¼å¼ï¼‰ã€‚

4. **è·¨ Bug æ•´åˆ 2 å¼•ç”¨éŒ¯èª¤** â€” è¨ˆç•«å°‡ Bug #17 æ­¸å…¥ã€ŒRetriever æ¶æ§‹å‡ç´šã€ï¼ˆæ•´åˆ 2ï¼‰ï¼Œä½† Bug #17 æ˜¯ KG toggle UI å•é¡Œï¼Œèˆ‡ retriever ç„¡é—œã€‚æ‡‰ç§»è‡³ã€Œå‰ç«¯è¼¸å…¥é«”é©—ã€ï¼ˆæ•´åˆ 3ï¼‰æˆ–ç¨ç«‹è™•ç†ã€‚

### æ–°å¢å»ºè­°

1. **Retriever é€šç”¨ Filter æ¶æ§‹**ï¼šBug #11/#16ï¼ˆtime filterï¼‰å’Œ Bug #18-20ï¼ˆauthor filterï¼‰éƒ½éœ€è¦åœ¨ retriever ä¸­åŠ å…¥ payload filterã€‚å»ºè­°è¨­è¨ˆä¸€å€‹é€šç”¨çš„ filter æ©Ÿåˆ¶ï¼š
   ```python
   async def search(self, query, site, num_results, filters=None, **kwargs):
       # filters = [{"field": "datePublished", "operator": "gte", "value": "2026-01-01"}, ...]
   ```
   å„ provider å†å°‡é€šç”¨ filter è½‰æ›ç‚ºè‡ªå·±çš„æ ¼å¼ï¼ˆQdrant â†’ `FieldCondition`, Azure â†’ OData filter ç­‰ï¼‰ã€‚

2. **Free Conversation æ•´åˆä¿®æ”¹é †åº**ï¼šBug #1, #3, #9, #24 éƒ½ä¿®æ”¹ `synthesize_free_conversation()` çš„ promptã€‚å»ºè­°å…ˆåˆä½µæ‰€æœ‰ä¿®æ”¹éœ€æ±‚ï¼Œä¸€æ¬¡æ€§ä¿®æ”¹ï¼Œé¿å…å¤šæ¬¡ PR è¡çªã€‚ä¿®æ”¹æ¸…å–®ï¼š
   - åŠ å…¥æ—¥æœŸï¼ˆ#1ï¼‰
   - åŠ å…¥ç³»çµ±é™åˆ¶èªªæ˜ï¼ˆ#3ï¼‰
   - åŠ å…¥ç³»çµ±èƒ½åŠ›èªªæ˜ï¼ˆ#9ï¼‰
   - åŠ å…¥ Markdown æ ¼å¼è¦æ±‚ï¼ˆ#24ï¼‰

3. **Bug #6 çš„ `parse_number()` éœ€è¦æ›´å®Œæ•´çš„ä¸­æ–‡æ•¸å­—è™•ç†**ï¼šå»ºè­°æ”¯æ´ã€Œåäº”ã€(15)ã€ã€ŒäºŒåã€(20)ã€ã€Œä¸‰åã€(30) ç­‰çµ„åˆæ•¸å­—ã€‚å¯åƒè€ƒ Python çš„ `cn2an` å¥—ä»¶æˆ–å¯¦ä½œç°¡å–®çš„çµ„åˆé‚è¼¯ã€‚

### è·¨ Bug æ•´åˆè©•ä¼°

1. **æ•´åˆ 1: Free Conversation Prompt å…¨é¢å‡ç´š** â€” âœ… åˆç†ã€‚å››å€‹ bug (#1, #3, #9, #24) éƒ½ä¿®æ”¹åŒä¸€å€‹å‡½æ•¸çš„ promptï¼Œä¸€æ¬¡æ€§ä¿®æ”¹æ•ˆç‡æœ€é«˜ã€‚

2. **æ•´åˆ 2: Retriever æ¶æ§‹å‡ç´š** â€” âš ï¸ æœ‰èª¤ã€‚Bug #17 (KG toggle) ä¸å±¬æ–¼ retriever æ¶æ§‹ï¼Œæ‡‰ç§»é™¤ã€‚æ­£ç¢ºç¯„åœæ‡‰ç‚º Bug #11/#16ï¼ˆtime filterï¼‰å’Œ Bug #18-20ï¼ˆauthor filterï¼‰ã€‚å»ºè­°è¨­è¨ˆé€šç”¨çš„ payload filter æ©Ÿåˆ¶ã€‚

3. **æ•´åˆ 3: å‰ç«¯è¼¸å…¥é«”é©—** â€” âœ… åˆç†ã€‚Bug #10 (IME), #23 (abort) å’Œ Bug #2 å‰ç«¯éƒ¨åˆ†å¯ä¸€èµ·è™•ç†ã€‚å»ºè­°åŠ å…¥ Bug #17 (KG toggle) åˆ°æ­¤æ•´åˆä¸­ï¼ˆå› ç‚ºéƒ½æ˜¯å‰ç«¯ JS ä¿®æ”¹ï¼‰ã€‚

---

*é©—è­‰å®Œæˆæ—¥æœŸï¼š2026-01-29*

---

## Agent é©—è­‰å ±å‘Š #2

> é©—è­‰æ—¥æœŸï¼š2026-01-29
> é©—è­‰è€…ï¼šClaude Code (Verification Agent #2)
> æ–¹æ³•ï¼šç¨ç«‹è®€å–ç¨‹å¼ç¢¼é©—è­‰ï¼Œèˆ‡ Agent #1 äº¤å‰æ¯”å°

### é©—è­‰çµ±è¨ˆ

| çµæœ | Bug æ•¸é‡ | Bug ç·¨è™Ÿ |
|------|---------|---------|
| âœ… ä¿®å¾©è¨ˆç•«å¯è¡Œ | 10 å€‹ | #1, #3, #9, #10, #13, #22, #24, #4/#5, #7, #8, #12, #14, #21 |
| âš ï¸ è¨ˆç•«éœ€è¦è£œå…… | 8 å€‹ | #6, #11/#16, #17, #2, #25, #23, #15, #18-20 |
| âŒ è¨ˆç•«æœ‰å•é¡Œ | 0 å€‹ | â€” |

### èˆ‡ Agent #1 çš„å·®ç•°

| Bug | Agent #1 åˆ¤æ–· | Agent #2 åˆ¤æ–· | å·®ç•°èªªæ˜ |
|-----|-------------|-------------|---------|
| #17 | âš ï¸ å»ºè­°ã€Œæ“ä½œ kgDisplayContainer çš„ style.displayã€ä½œç‚ºæ›´ç°¡å–®æ›¿ä»£ | âš ï¸ **åå° Agent #1 çš„æ›¿ä»£æ–¹æ¡ˆ** | Agent #1 çš„æ›¿ä»£æ–¹æ¡ˆæœ‰è‡´å‘½ç¼ºé™·ï¼š`kgDisplayContainer` åŒ…å« toggle button æœ¬èº«ï¼Œéš±è— container æœƒåŒæ™‚éš±è—æŒ‰éˆ•ï¼Œä½¿ç”¨è€…ç„¡æ³•é‡æ–°å±•é–‹ã€‚Wrapper æ–¹æ¡ˆæ­£ç¢ºã€‚ |
| #23 | âš ï¸ ç™¼ç¾æœå°‹å·²æœ‰ abort åŸºç¤è¨­æ–½ | âš ï¸ **è£œå……æ›´å®Œæ•´çš„åˆ†æ** | Agent #1 åªæåˆ°æœå°‹çš„ abort åŸºç¤è¨­æ–½ï¼Œæˆ‘è£œå……äº† Deep Researchï¼ˆEventSource æ˜¯å±€éƒ¨è®Šæ•¸ï¼‰å’Œ Free Conversationï¼ˆfetch ç„¡ AbortControllerï¼‰çš„å…·é«”ç¼ºå¤±åˆ†æã€‚ |
| #2 | âš ï¸ æŒ‡å‡ºå‰å¾Œç«¯å”è­°ç¼ºå¤± | âš ï¸ **åŒæ„ï¼Œä¸¦æå‡ºå…·é«”å”è­°æ–¹æ¡ˆ** | Agent #1 æ­£ç¢ºè­˜åˆ¥å•é¡Œï¼Œæˆ‘è£œå……äº† POST body çš„å…·é«”æ¬„ä½è¨­è¨ˆã€‚ |
| #10 | âœ… å¯è¡Œ | âœ… **åŒæ„ï¼Œè£œå……ä¸€å€‹ç´°ç¯€** | Agent #1 æåˆ°éœ€ç¢ºèª Free Conversation è¼¸å…¥æ¡†çš„ keydown handlerã€‚æˆ‘é©—è­‰ï¼šæœå°‹å’Œ Free Conversation å…±ç”¨åŒä¸€å€‹ inputï¼ˆline 1218ï¼‰ï¼ŒåŒä¸€å€‹ keydown handlerï¼Œä¿®å¾©ä¸€è™•å³è¦†è“‹å…©è€…ã€‚ |

### é€é …é©—è­‰

---

#### Bug #1: æ—¥æœŸè¬Šç¨±å•é¡Œ
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨ç«‹é©—è­‰**: è®€å– `generate_answer.py:631-686`ã€‚ä¸‰å€‹ prompt è®Šé«”ç¢ºèªï¼š
  - `has_research_report` (line 633): prompt é–‹é ­ç‚ºã€Œä½ æ˜¯ä¸€å€‹å°ˆæ¥­çš„å°ç£æ–°èåˆ†æåŠ©æ‰‹ã€â€” ç„¡æ—¥æœŸ
  - `has_cached_articles` (line 648): prompt é–‹é ­ç‚ºã€ŒYou are an AI assistant helping with Taiwan news analysisã€â€” ç„¡æ—¥æœŸ
  - `else` (line 674): prompt é–‹é ­ç‚ºã€ŒYou are an AI assistant helping with questions about Taiwan newsã€â€” ç„¡æ—¥æœŸ
- **èˆ‡ Agent #1 ä¸€è‡´**: æ˜¯ã€‚çµè«–ç›¸åŒï¼Œä¿®å¾©è¨ˆç•«æ­£ç¢ºã€‚

---

#### Bug #6: æ™‚é–“ç¯„åœè¨ˆç®—éŒ¯èª¤
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦è£œå……
- **ç¨ç«‹é©—è­‰**: è®€å– `time_range_extractor.py:38-88` (regex) å’Œ `:189-221` (parse logic)ã€‚
  - ç¢ºèªæ‰€æœ‰ 8 å€‹ `_zh` regex ç”¨ `(\d+)`ï¼Œä¸åŒ¹é…ä¸­æ–‡æ•¸å­—ã€‚
  - ç¢ºèª prefix ä¸ä¸€è‡´ï¼š`last_x_days_zh` ç”¨ `æœ€è¿‘`ï¼Œ`last_x_months_zh`/`last_x_years_zh` ç”¨ `(?:è¿‘|æœ€è¿‘)`ï¼Œ`past_x_days_zh`/`past_x_weeks_zh` ç”¨ `éå»`ã€‚
  - ç¢ºèªè§£æé‚è¼¯ lines 196/202/209/217 å…¨ç”¨ `int(match.group(1))`ã€‚
- **èˆ‡ Agent #1 ä¸€è‡´**: å¤§éƒ¨åˆ†ä¸€è‡´ã€‚åŒæ„ `parse_number()` éœ€æ”¯æ´çµ„åˆæ•¸å­—ï¼ˆåäº”=15ã€äºŒå=20ï¼‰ã€‚
- **è£œå……**:
  1. **Agent #1 éºæ¼çš„ prefix å•é¡Œ**ï¼šAgent #1 å»ºè­°æ‰€æœ‰ `_zh` æ¨¡å¼çµ±ä¸€ç‚º `(?:è¿‘|æœ€è¿‘|éå»)`ã€‚ä½†åŸå§‹ regex è¨­è¨ˆæœ‰ `past_x_*_zh`ï¼ˆå‰ç¶´ `éå»`ï¼‰å’Œ `last_x_*_zh`ï¼ˆå‰ç¶´ `æœ€è¿‘`ï¼‰çš„**èªæ„å€åˆ†**ã€‚çµ±ä¸€ prefix éœ€è¦å¯©æ…è€ƒæ…®æ˜¯å¦å°è‡´èªæ„æ··æ·†ï¼ˆä¾‹å¦‚ï¼šã€Œéå»ä¸‰å¤©ã€vsã€Œè¿‘ä¸‰å¤©ã€èªç¾©ä¸Šæ¥è¿‘ï¼Œåˆä½µå¯ä»¥ï¼›ä½†ä¸­æ–‡èªæ³•ä¸­ã€Œéå»ä¸‰å¹´ã€å’Œã€Œæœ€è¿‘ä¸‰å¹´ã€ç•¥æœ‰ä¸åŒæ™‚é–“æ„Ÿå—ï¼‰ã€‚å»ºè­°ï¼šä¿æŒ `past_x_*_zh` å’Œ `last_x_*_zh` åˆ†é–‹ï¼Œä½†å„è‡ªçš„ prefix éƒ½åŠ å…¥ `è¿‘`ï¼Œå³ `past_x_*_zh` = `(?:éå»|è¿‘)`, `last_x_*_zh` = `(?:æœ€è¿‘|è¿‘)`ã€‚
  2. **regex å­—å…ƒé¡è¦åŒ…å« `å…©`**ï¼šè¨ˆç•«çš„ `[ä¸€äºŒå…©ä¸‰å››äº”å…­ä¸ƒå…«ä¹å\d]+` æ­£ç¢ºåŒ…å«äº† `å…©`ã€‚ç¢ºèª OKã€‚

---

#### Bug #10: Mac è¼¸å…¥æ³• Enter å•é¡Œ
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨ç«‹é©—è­‰**: æœå°‹ `news-search.js` ä¸­æ‰€æœ‰ `keydown` handlerï¼Œæ‰¾åˆ° 4 è™•ï¼š
  - Line 378: `document.addEventListener('keydown')` â€” ESC é—œé–‰ historyï¼Œä¸æ¶‰åŠ Enter
  - **Line 1218**: `searchInput.addEventListener('keydown')` â€” `if (e.key === 'Enter' && !e.shiftKey)` â€” **ä¸»è¦ä¿®å¾©é»**ï¼Œç¼ºå°‘ `!e.isComposing`
  - Line 4326: rename input â€” Enter è§¸ç™¼ blur
  - Line 4656: folder rename input â€” Enter è§¸ç™¼ blur
- **èˆ‡ Agent #1 ä¸€è‡´**: æ˜¯ã€‚
- **é¡å¤–ç™¼ç¾**: Agent #1 æåˆ°ã€Œéœ€ç¢ºèª Free Conversation è¼¸å…¥æ¡†çš„ keydown handlerã€ã€‚æˆ‘é©—è­‰äº†ï¼š**æœå°‹å’Œ Free Conversation å…±ç”¨åŒä¸€å€‹ `searchInput`**ã€‚`performSearch()` (line 1239) æª¢æŸ¥ `currentMode === 'chat'` (line 1257)ï¼Œå¦‚æœæ˜¯å‰‡èª¿ç”¨ `performFreeConversation()`ã€‚å› æ­¤ï¼Œ**ä¿®å¾© line 1218 ä¸€è™•å³è¦†è“‹æœå°‹å’Œ Free Conversation å…©å€‹æ¨¡å¼**ã€‚ä¸éœ€è¦æ‰¾å¦ä¸€å€‹ handlerã€‚

---

#### Bug #11 + #16: æ™‚é–“éæ¿¾ç¼ºå¤±
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦å¯¦è³ªè£œå……
- **ç¨ç«‹é©—è­‰**: è®€å– `retriever.py:817-937`ã€‚`search()` æ–¹æ³•ï¼š
  - æ¥æ”¶ `query, site, num_results, **kwargs`
  - éæ­· enabled_endpointsï¼Œå°æ¯å€‹å»ºç«‹ `client.search()` task
  - ä½¿ç”¨ `asyncio.gather()` ä¸¦è¡ŒæŸ¥è©¢ï¼Œç„¶å¾Œ `_aggregate_results()`
  - **å®Œå…¨ç„¡ time filtering**ã€‚æ²’æœ‰ä»»ä½• `datePublished`ã€`date`ã€æˆ–æ™‚é–“ç›¸é—œçš„éæ¿¾é‚è¼¯ã€‚
- **Reasoning module çš„ temporal search æ©Ÿåˆ¶åˆ†æ**:
  - `time_range_extractor.py` è§£ææŸ¥è©¢ï¼Œçµæœå­˜å…¥ `handler.temporal_range`
  - `deep_research.py` å–å¾— `temporal_context`ï¼Œå‚³çµ¦ `orchestrator.run_research()`
  - `orchestrator.py` å°‡ `temporal_context` å‚³çµ¦ `analyst.research()` ä½œç‚º prompt åƒæ•¸
  - `analyst_prompt_builder.py:47-50` å°‡ temporal_context è½‰ç‚º `"Time Range: {start} to {end}"` å­—ä¸²æ³¨å…¥ Analyst prompt
  - **é—œéµç™¼ç¾**ï¼šreasoning module çš„ temporal search **ä¸æ˜¯** retriever å±¤ç´šçš„éæ¿¾ï¼Œè€Œæ˜¯ **prompt å±¤ç´šçš„ç´„æŸ**ã€‚Analyst åœ¨åˆ†ææ™‚æœƒè€ƒæ…®æ™‚é–“ç¯„åœï¼Œä½†æª¢ç´¢çš„æ–‡ä»¶æœ¬èº«æ²’æœ‰è¢«æ™‚é–“éæ¿¾ã€‚
- **èˆ‡ Agent #1 ä¸€è‡´**: å¤§éƒ¨åˆ†ä¸€è‡´ã€‚Agent #1 æ­£ç¢ºæŒ‡å‡ºæŠ½è±¡å±¤å•é¡Œå’Œè³‡æ–™æµä¸æ˜ç¢ºã€‚
- **è£œå…… â€” å…·é«”è¤‡ç”¨æ–¹æ¡ˆ**:
  Dev è¦æ±‚ã€Œreasoning module ä¸­çš„ temporal search æ©Ÿåˆ¶ä¹Ÿæ‡‰è©²åœ¨æ–°èæœå°‹åŠŸèƒ½ä¸­ä½¿ç”¨ã€ã€‚ä½† reasoning module çš„ temporal search åªæ˜¯ prompt-level ç´„æŸï¼Œä¸æ˜¯ retriever-level filterã€‚è¦åœ¨ä¸€èˆ¬æœå°‹ä¸­å¯¦ç¾æ™‚é–“éæ¿¾ï¼Œéœ€è¦ï¼š
  1. **Retriever å±¤ç´šéæ¿¾ï¼ˆæ–°å¢ï¼‰**ï¼šåœ¨ `retriever.py:search()` ä¸­æ¥æ”¶ `time_filter` åƒæ•¸ï¼Œå‚³çµ¦å„ provider client
  2. **Provider å¯¦ä½œ**ï¼šQdrant provider ç”¨ `FieldCondition` éæ¿¾ `datePublished`ï¼›å…¶ä»– provider å„è‡ªå¯¦ä½œ
  3. **è³‡æ–™æµ**ï¼š`baseHandler.py` åœ¨å‘¼å« `retriever.search()` æ™‚ï¼Œå¾ `handler.temporal_range` æå–æ™‚é–“ç¯„åœï¼Œè½‰ç‚ºé€šç”¨ filter æ ¼å¼å‚³å…¥
  4. **Fallback**ï¼šåš´æ ¼éæ¿¾çµæœç‚º 0 æ™‚ï¼Œæ“´å¤§ç¯„åœæˆ–ç§»é™¤éæ¿¾ï¼Œä¸¦è¨­ flag
  5. **å‰ç«¯æç¤º**ï¼šæ ¹æ“š flag åœ¨æœå°‹çµæœä¸Šæ–¹é¡¯ç¤ºç´…å­—æç¤º

  é€™æ¯” reasoning module çš„ prompt-level æ–¹æ¡ˆæ›´å¾¹åº•ï¼Œå› ç‚ºå®ƒåœ¨æª¢ç´¢éšæ®µå°±éæ¿¾æ‰ä¸ç›¸é—œçš„æ–‡ä»¶ã€‚

---

#### Bug #13: å¼•ç”¨é€£çµ private:// å•é¡Œ
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨ç«‹é©—è­‰**: è®€å– `news-search.js:1580-1603` `addCitationLinks()` å‡½æ•¸ï¼š
  - Line 1586: ç”¨ regex `/\[(\d+)\]/g` åŒ¹é…å¼•ç”¨æ¨™è¨˜
  - Line 1588: bounds check `index >= 0 && index < sources.length`
  - Line 1590: æª¢æŸ¥ `url` éç©º
  - Line 1592: è™•ç† `urn:llm:knowledge:` â†’ é¡¯ç¤º `[N]<sup>AI</sup>`
  - Line 1598: ä¸€èˆ¬ URL â†’ å»ºç«‹ `<a>` é€£çµ
  - **Line 1592-1598 ä¹‹é–“æ²’æœ‰ `private://` è™•ç†**
- **èˆ‡ Agent #1 ä¸€è‡´**: æ˜¯ã€‚è¨ˆç•«åœ¨ line 1596 ä¹‹å¾ŒåŠ å…¥ `private://` æª¢æŸ¥æ˜¯æ­£ç¢ºçš„æ’å…¥ä½ç½®ã€‚

---

#### Bug #17: çŸ¥è­˜åœ–è­œæ”¶ä¸èµ·ä¾†
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ è¨ˆç•«æ–¹å‘æ­£ç¢ºï¼Œä½†éœ€è¦ç´°ç¯€è£œå……ï¼›**Agent #1 çš„æ›¿ä»£æ–¹æ¡ˆæœ‰è‡´å‘½ç¼ºé™·**
- **ç¨ç«‹é©—è­‰ â€” HTML çµæ§‹**ï¼ˆè®€å– `news-search-prototype.html:417-448`ï¼‰ï¼š
  ```
  kgDisplayContainer (div#kgDisplayContainer)
  â”œâ”€â”€ kg-display-header (div.kg-display-header)
  â”‚   â”œâ”€â”€ kg-display-title â€” icon + "çŸ¥è­˜åœ–è­œ" + metadata
  â”‚   â””â”€â”€ controls (flex div)
  â”‚       â”œâ”€â”€ kgViewToggle â€” åœ–å½¢/åˆ—è¡¨åˆ‡æ›
  â”‚       â””â”€â”€ kgToggleButton â€” â–¼ æ”¶èµ·  â† toggle æŒ‰éˆ•åœ¨é€™è£¡
  â”œâ”€â”€ kgGraphView (div#kgGraphView) â€” åœ–å½¢è¦–åœ–
  â”œâ”€â”€ kgDisplayContent (div#kgDisplayContent) â€” åˆ—è¡¨è¦–åœ–
  â”œâ”€â”€ kgLegend (div#kgLegend) â€” åœ–ä¾‹
  â””â”€â”€ kgDisplayEmpty (div#kgDisplayEmpty) â€” ç©ºç‹€æ…‹
  ```
- **Toggle handler é©—è­‰**ï¼ˆ`news-search.js:2383-2401`ï¼‰ï¼š
  - åªæ“ä½œ `kgDisplayContent` çš„ `.collapsed` class
  - ä¸å½±éŸ¿ `kgGraphView`ï¼ˆåœ–å½¢æ¨¡å¼ä¸‹ toggle ç„¡æ•ˆ â† Bug æ ¹å› ä¹‹ä¸€ï¼‰
- **View toggle é©—è­‰**ï¼ˆ`news-search.js:2010-2041`ï¼‰ï¼š
  - ç”¨ inline `style.display = 'block'/'none'` åˆ‡æ› `graphView` å’Œ `listView`
  - inline style å„ªå…ˆç´š > `.collapsed` class â† Bug æ ¹å› ä¹‹äºŒ
- **Agent #1 æ›¿ä»£æ–¹æ¡ˆçš„è‡´å‘½ç¼ºé™·**ï¼š
  Agent #1 å»ºè­°ã€Œè®“ toggle handler ç›´æ¥æ“ä½œ `kgDisplayContainer` çš„ `style.display`ã€ã€‚**é€™æ˜¯éŒ¯èª¤çš„**ï¼Œå› ç‚º `kgDisplayContainer` **åŒ…å« toggle button æœ¬èº«**ï¼ˆ`kgToggleButton` åœ¨ `kg-display-header` å…§ï¼Œè€Œ header åœ¨ container å…§ï¼‰ã€‚éš±è— container æœƒåŒæ™‚éš±è— toggle buttonï¼Œä½¿ç”¨è€…ç„¡æ³•é‡æ–°å±•é–‹ã€‚
- **è¨ˆç•«çš„ Wrapper æ–¹æ¡ˆè©•ä¼°**ï¼š
  è¨ˆç•«çš„ wrapper æ–¹æ¡ˆæ˜¯æ­£ç¢ºæ–¹å‘ã€‚`kgContentWrapper` æ‡‰åŒ…è£ `kgGraphView`ã€`kgDisplayContent`ã€`kgLegend`ã€`kgDisplayEmpty`ï¼ˆ**è¨ˆç•«éºæ¼äº† `kgDisplayEmpty`**ï¼‰ï¼Œä¸åŒ…è£ headerã€‚Toggle æ“ä½œ wrapper çš„ `style.display`ï¼Œå³å¯ä¸€æ¬¡æ§åˆ¶æ‰€æœ‰å…§å®¹å€åŸŸï¼Œä¸å— view toggle çš„ inline style å½±éŸ¿ã€‚
- **è£œå……**: è¨ˆç•«ä¸­ã€Œç§»é™¤ `.kg-display-content.collapsed` è¦å‰‡ã€å¯è¡Œï¼Œå› ç‚º wrapper æ–¹æ¡ˆä½¿ç”¨ `style.display` ç›´æ¥æ§åˆ¶ï¼Œä¸å†éœ€è¦ `.collapsed` classã€‚

---

#### Bug #22: å¼•ç”¨æ ¼å¼ä¸é€šé †
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨ç«‹é©—è­‰**: è®€å– `writer.py:135-285` `build_compose_prompt()` æ–¹æ³•ï¼š
  - Line 194-198: å¼•ç”¨ç™½åå–®ç´„æŸ â€”ã€Œåš´ç¦ç„¡ä¸­ç”Ÿæœ‰ã€
  - Line 245-249: `sources_used` é™åˆ¶ â€” å¿…é ˆæ˜¯ `analyst_citations` å­é›†
  - **æ²’æœ‰ä»»ä½•å¼•ç”¨ã€Œèªæ³•é¢¨æ ¼ã€æˆ–ã€Œèªæ³•æ ¼å¼ã€çš„æŒ‡å¼•**
- **èˆ‡ Agent #1 ä¸€è‡´**: æ˜¯ã€‚
- **ç¢ºèª Agent #1 çš„ç™¼ç¾**: `_citation_rules()` æ–¹æ³•ç¢ºå¯¦ä¸å­˜åœ¨ã€‚å¼•ç”¨é¢¨æ ¼æŒ‡å¼•æ‡‰åŠ å…¥ `build_compose_prompt()` çš„ prompt å­—ä¸²ä¸­ï¼Œå»ºè­°åœ¨ line 198ï¼ˆç™½åå–®èªªæ˜ `{analyst_citations}`ï¼‰ä¹‹å¾Œã€line 200ï¼ˆ`---`ï¼‰ä¹‹å‰æ’å…¥ã€‚

---

#### Bug #25: å¼•ç”¨æ•¸å­—å¤ªå¤§æ²’æœ‰è¶…é€£çµ
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦è£œå……
- **ç¨ç«‹é©—è­‰**: è®€å– `orchestrator.py:1111-1139`ï¼š
  - Line 1115: `max_cid = max(self.source_map.keys()) if self.source_map else 0`
  - Line 1116: `writer_citations = final_report.sources_used` â€” Writer å¯¦éš›ä½¿ç”¨çš„å¼•ç”¨ ID
  - Line 1121-1136: éæ­· `range(1, max_cid + 1)` æ§‹å»º `source_urls`
  - **æ ¹å› ç¢ºèª**: å¦‚æœ Writer å¼•ç”¨ `[15]` ä½† `source_map` æœ€å¤§ key æ˜¯ 10ï¼Œ`source_urls` åªæœ‰ 10 å€‹å…ƒç´ ã€‚å‰ç«¯ `addCitationLinks()` çš„ bounds check (`index < sources.length`) æ­£ç¢ºæ‹’çµ•è¶Šç•Œå¼•ç”¨ã€‚
- **èˆ‡ Agent #1 ä¸€è‡´**: åŸºæœ¬ä¸€è‡´ã€‚
- **æ–¹æ¡ˆ A çš„å…·é«”ä¿®æ­£**:
  Line 1115 æ‡‰æ”¹ç‚ºï¼š
  ```python
  max_cid = max(
      max(self.source_map.keys(), default=0),
      max(final_report.sources_used, default=0)
  )
  ```
  é€™ç¢ºä¿ `source_urls` é•·åº¦è¦†è“‹ Writer ä½¿ç”¨çš„æ‰€æœ‰ citation IDã€‚è¶…å‡º `source_map` çš„ ID ä½ç½®æœƒæ˜¯ç©ºå­—ä¸²ï¼Œå‰ç«¯å¯é¸æ“‡é¡¯ç¤ºç‚ºã€Œä¾†æºæš«ç„¡é€£çµã€ï¼ˆæ–¹æ¡ˆ Cï¼‰ã€‚
- **æ–¹æ¡ˆ B æ³¨æ„äº‹é …**: è¨ˆç•«èªªåœ¨ Writer prompt ä¸­åŠ å…¥ç´„æŸã€‚å…·é«”ä½ç½®æ‡‰åœ¨ `writer.py:247` é™„è¿‘ï¼ŒåŠ å…¥ï¼šã€Œä½ çš„ sources_used ä¸­æ¯å€‹ ID ä¸å¾—è¶…é {max(analyst_citations)}ã€ã€‚

---

#### Bug #2: Free Conversation åªç”¨å‰ 10 å€‹ Cache çµæœ
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦å¯¦è³ªè£œå……
- **ç¨ç«‹é©—è­‰ â€” é‡˜é¸è³‡æ–™çµæ§‹**ï¼ˆ`news-search.js:2741-2758`ï¼‰ï¼š
  ```javascript
  pinnedNewsCards.push({
      url,
      title,
      pinnedAt: Date.now()
  });
  ```
  **ç¢ºèªåªå­˜ urlã€titleã€pinnedAt â€” æ²’æœ‰ description/snippet**ã€‚
- **ç¨ç«‹é©—è­‰ â€” POST è«‹æ±‚**ï¼ˆ`news-search.js:2438-2465`ï¼‰ï¼š
  ```javascript
  const requestBody = {
      query, site: 'all', generate_mode: 'generate',
      streaming: true, free_conversation: true,
      session_id, conversation_id, prev: allPrevQueries
  };
  // å¯é¸: research_report, include_private_sources, user_id
  ```
  **ç¢ºèª POST body æ²’æœ‰ä»»ä½•é‡˜é¸è³‡æ–™æ¬„ä½ã€‚**
- **èˆ‡ Agent #1 ä¸€è‡´**: æ˜¯ã€‚Agent #1 æ­£ç¢ºè­˜åˆ¥äº†æ‰€æœ‰å•é¡Œã€‚
- **è£œå…… â€” å…·é«”çš„å‰å¾Œç«¯å”è­°æ–¹æ¡ˆ**:
  1. **å‰ç«¯ä¿®æ”¹** `togglePinNewsCard()`: å¢åŠ  `description` åƒæ•¸ï¼š
     ```javascript
     function togglePinNewsCard(url, title, description) {
         // ...
         pinnedNewsCards.push({ url, title, description, pinnedAt: Date.now() });
     }
     ```
     å‘¼å«æ–¹éœ€å‚³å…¥ descriptionï¼ˆå¾ news card çš„ `schema.description` å–å¾—ï¼‰
  2. **å‰ç«¯ä¿®æ”¹** `performFreeConversation()`: åœ¨ requestBody ä¸­åŠ å…¥ï¼š
     ```javascript
     if (pinnedNewsCards.length > 0) {
         requestBody.pinned_articles = pinnedNewsCards.map(p => ({
             url: p.url, title: p.title, description: p.description || ''
         }));
     }
     ```
  3. **å¾Œç«¯ä¿®æ”¹** `synthesize_free_conversation()`: å¾ request è®€å– `pinned_articles`ï¼Œæ³¨å…¥ promptï¼š
     ```python
     pinned_articles = self.query_params.get("pinned_articles", [])
     if pinned_articles:
         pinned_context = "\n".join([f"- {a['title']}: {a['description']} ({a['url']})" for a in pinned_articles])
         prompt += f"\n\n**ä½¿ç”¨è€…é‡˜é¸çš„æ–‡ç« **:\n{pinned_context}\n"
     ```

---

#### Bug #23: æš«åœå°è©±æŒ‰éˆ•ç¼ºå¤±
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦å¯¦è³ªè£œå……
- **ç¨ç«‹é©—è­‰ â€” ä¸‰å€‹æ¨¡å¼çš„ abort ç¾ç‹€**:

  | æ¨¡å¼ | EventSource/Fetch | æ¨¡çµ„ç´šå¼•ç”¨ | AbortController | å¯ abort |
  |------|-------------------|-----------|----------------|---------|
  | **æœå°‹** | EventSource (line 1333) + fetch (line 1298) | âœ… `currentSearchEventSource`, `currentSearchAbortController` | âœ… line 1246 | âœ… å·²æœ‰ `cancelActiveSearch()` |
  | **Deep Research** | EventSource (line 1513) | âŒ å±€éƒ¨è®Šæ•¸ `const eventSource` | âŒ ç„¡ | âŒ å®Œå…¨ç„¡æ³• abort |
  | **Free Conversation** | fetch via `handlePostStreamingRequest` (line 748) | âŒ ç„¡å¼•ç”¨ | âŒ fetch ç„¡ signal åƒæ•¸ | âŒ å®Œå…¨ç„¡æ³• abort |

- **èˆ‡ Agent #1 çš„å·®ç•°**:
  Agent #1 æ­£ç¢ºç™¼ç¾æœå°‹åŠŸèƒ½å·²æœ‰ abort åŸºç¤è¨­æ–½ï¼Œä½†**æ²’æœ‰å…·é«”åˆ†æ Deep Research å’Œ Free Conversation çš„ç¼ºå¤±**ã€‚æˆ‘çš„åˆ†ææ›´å®Œæ•´ï¼š
  - Deep Research çš„ EventSource æ˜¯**å±€éƒ¨è®Šæ•¸** (`const eventSource = new EventSource(...)` at line 1513)ï¼Œæ²’æœ‰å­˜åˆ°æ¨¡çµ„ç´šè®Šæ•¸ï¼Œå¤–éƒ¨ç„¡æ³• close
  - Free Conversation çš„ `handlePostStreamingRequest()` (line 748) ä½¿ç”¨ `fetch()` æ™‚**å®Œå…¨æ²’æœ‰å‚³å…¥ AbortController çš„ signal**
- **è¨ˆç•«ä¿®æ­£å»ºè­°**:
  Step 1 æ‡‰æ”¹ç‚ºï¼š
  1. **æœå°‹æ¨¡å¼**ï¼šå·²æœ‰ `cancelActiveSearch()`ï¼Œç›´æ¥å¾©ç”¨
  2. **Deep Research æ¨¡å¼**ï¼š
     - æ–°å¢æ¨¡çµ„ç´šè®Šæ•¸ `let currentDeepResearchEventSource = null`
     - Line 1513 æ”¹ç‚º `currentDeepResearchEventSource = new EventSource(...)`
  3. **Free Conversation æ¨¡å¼**ï¼š
     - æ–°å¢æ¨¡çµ„ç´šè®Šæ•¸ `let currentFreeConvAbortController = null`
     - `handlePostStreamingRequest()` å¢åŠ  AbortController åƒæ•¸ï¼š`fetch(url, { ..., signal: abortController.signal })`
  4. **çµ±ä¸€ abort å‡½æ•¸**ï¼šå»ºç«‹ `cancelAllActiveRequests()` å‘¼å«ä¸‰å€‹æ¨¡å¼å„è‡ªçš„å–æ¶ˆé‚è¼¯

---

#### Bug #3: åˆç†åŒ–éŒ¯èª¤ç­”æ¡ˆ
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨ç«‹é©—è­‰**: åŒ Bug #1ï¼Œå·²ç¢ºèª prompt ä¸­ç„¡ç³»çµ±é™åˆ¶èªªæ˜ã€‚è¨ˆç•«çš„ç³»çµ±å…ƒè³‡è¨ŠåŠ å…¥æ–¹æ¡ˆæ­£ç¢ºã€‚

---

#### Bug #4 + #5: æ·±åº¦ç ”ç©¶æ­§ç¾©æª¢æ¸¬
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **é©—è­‰**: è¨ˆç•«æ–¹å‘åˆç†ï¼ˆåŠ å…¥è‡ªç”±æ–‡å­—è¼¸å…¥å’Œã€Œæ²’æœ‰ã€æŒ‰éˆ•ï¼‰ã€‚å‰ç«¯éœ€ä¿®æ”¹ clarification é¸é …çš„æ¸²æŸ“é‚è¼¯ã€‚

---

#### Bug #9: ç„¡æ³•å­˜å–å³æ™‚æ–°è
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨ç«‹é©—è­‰**: åŒ Bug #1ï¼Œå·²ç¢ºèª prompt ä¸­ç„¡ç³»çµ±èƒ½åŠ›èªªæ˜ã€‚

---

#### Bug #24: å›è¦†æ²’æœ‰æ’ç‰ˆæ›è¡Œ
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **é©—è­‰**: å‰ç«¯ç”¨ `marked.parse()` (line 2498) åš Markdown æ¸²æŸ“ï¼Œå•é¡Œåœ¨ prompt æ²’è¦æ±‚ Markdown æ ¼å¼ã€‚è¨ˆç•«æ­£ç¢ºã€‚

---

#### Bug #14: æ‘˜è¦å›é¥‹æŒ‰éˆ•
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œï¼ˆéœ€ /planï¼‰
- **é©—è­‰**: è¨ˆç•«æ–¹å‘åˆç†ï¼Œéœ€å®Œæ•´è¨­è¨ˆã€‚

---

#### Bug #7: ç¼ºå°‘ç´«è‰²è™›ç·šæ¨™è¨˜
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œï¼ˆéœ€èª¿æŸ¥ï¼‰
- **é©—è­‰**: è¨ˆç•«çš„èª¿æŸ¥æ–¹å‘æ­£ç¢ºã€‚

---

#### Bug #8: æ²’æœ‰çœŸçš„åˆ—å‡º 12 æœˆåå¤§æ–°è
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œï¼ˆåŠŸèƒ½é™åˆ¶ï¼Œéœ€èª¿æŸ¥ Decontextualizationï¼‰
- **é©—è­‰**: è¨ˆç•«æ–¹å‘åˆç†ã€‚

---

#### Bug #12: æ²»å®‰æ”¿ç­–æ²’æ‰¾åˆ°å¼µæ–‡äº‹ä»¶
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **é©—è­‰**: LLM-based query expansion æ–¹æ¡ˆåˆç†ã€‚

---

#### Bug #15: æŠ€è¡“å‹å·¥è‚¡ç¥¨æŸ¥è©¢
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦è£œå……
- **é©—è­‰**: åŒ Agent #1ï¼Œéœ€å…ˆèª¿æŸ¥ Tier 6 API prompt å’Œ Analyst æ±ºç­–éç¨‹ã€‚

---

#### Bug #18-20: è¨˜è€…æ–‡ç« æœå°‹
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦è£œå……
- **é©—è­‰**: èˆ‡ Bug #11/#16 é¢è‡¨ç›¸åŒçš„ retriever æŠ½è±¡å±¤å•é¡Œã€‚æ‡‰ä¸€ä½µè¨­è¨ˆé€šç”¨ payload filterã€‚

---

#### Bug #21: æ·±åº¦ç ”ç©¶è¨˜è€…æŸ¥è©¢
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œï¼ˆä¾è³´ Bug #18-20ï¼‰
- **é©—è­‰**: ä¾è³´é—œä¿‚æ­£ç¢ºã€‚

---

### éºæ¼ç™¼ç¾

1. **Bug #17: Agent #1 æ›¿ä»£æ–¹æ¡ˆæœ‰è‡´å‘½ç¼ºé™·** â€” Agent #1 å»ºè­°ã€Œæ“ä½œ `kgDisplayContainer` çš„ `style.display`ã€ä½œç‚ºæ›´ç°¡å–®æ›¿ä»£ã€‚ä½† `kgDisplayContainer` åŒ…å« `kg-display-header`ï¼ˆå…¶ä¸­æœ‰ toggle buttonï¼‰ï¼Œéš±è— container æœƒåŒæ™‚éš±è—æŒ‰éˆ•ï¼Œä½¿ç”¨è€…ç„¡æ³•é‡æ–°å±•é–‹ã€‚**æ­¤æ›¿ä»£æ–¹æ¡ˆä¸å¯æ¡ç”¨ã€‚**

2. **Bug #17: è¨ˆç•«éºæ¼ `kgDisplayEmpty`** â€” è¨ˆç•«èªª wrapper åŒ…è£ `kgGraphView`ã€`kgDisplayContent`ã€`kgLegend`ï¼Œä½†éºæ¼äº† `kgDisplayEmpty`ï¼ˆHTML line 445ï¼‰ã€‚æ­¤å…ƒç´ ä¹Ÿéœ€åŒ…å«åœ¨ wrapper ä¸­ã€‚

3. **Bug #10: æœå°‹èˆ‡ Free Conversation å…±ç”¨ input** â€” Agent #1 æ“”å¿ƒéœ€è¦é¡å¤–æ‰¾ Free Conversation çš„ keydown handlerã€‚å¯¦éš›ä¸Š `searchInput` çš„ `keydown` handlerï¼ˆline 1218ï¼‰è¦†è“‹äº†å…©å€‹æ¨¡å¼ï¼Œå› ç‚º `performSearch()` å…§éƒ¨æ ¹æ“š `currentMode === 'chat'` åˆ†æµåˆ° `performFreeConversation()`ã€‚ä¿®å¾©ä¸€è™•å³å¯ã€‚

4. **Bug #23: ä¸‰å€‹æ¨¡å¼çš„ abort ç¾ç‹€å·®ç•°å·¨å¤§** â€” æœå°‹å·²æœ‰å®Œæ•´ abort åŸºç¤è¨­æ–½ï¼›Deep Research çš„ EventSource æ˜¯å±€éƒ¨è®Šæ•¸ï¼Œå®Œå…¨ç„¡æ³•å¤–éƒ¨ abortï¼›Free Conversation çš„ fetch æ²’æœ‰ AbortController signalã€‚è¨ˆç•«éœ€è¦é‡å°ä¸‰è€…åˆ†åˆ¥è™•ç†ï¼Œè€Œéçµ±ä¸€æè¿°ã€‚

5. **Bug #11/#16: Reasoning module çš„ temporal search æ˜¯ prompt-levelï¼Œä¸æ˜¯ retriever-level** â€” Dev è¦æ±‚ã€Œè¤‡ç”¨ reasoning module çš„ temporal searchã€ï¼Œä½† reasoning module åªåœ¨ prompt ä¸­å‘ŠçŸ¥ Analyst æ™‚é–“ç¯„åœï¼Œä¸åœ¨æª¢ç´¢å±¤éæ¿¾ã€‚ä¸€èˆ¬æœå°‹éœ€è¦ retriever-level çš„ Qdrant filterï¼Œé€™æ˜¯å…¨æ–°å¯¦ä½œè€Œéè¤‡ç”¨ã€‚

### æ–°å¢å»ºè­°

1. **Bug #17 çš„ wrapper å…ƒç´ å®Œæ•´æ¸…å–®**ï¼š
   ```html
   <div id="kgContentWrapper">
       <div id="kgGraphView">...</div>
       <div id="kgDisplayContent">...</div>
       <div id="kgLegend">...</div>
       <div id="kgDisplayEmpty">...</div>
   </div>
   ```
   ä¸åŒ…å« `kg-display-header`ï¼ˆå« toggle button å’Œ view toggleï¼‰ã€‚

2. **Bug #23 çš„çµ±ä¸€ abort æ¶æ§‹**ï¼š
   ```javascript
   // æ¨¡çµ„ç´šè®Šæ•¸
   let currentSearchAbortController = null;      // å·²å­˜åœ¨
   let currentSearchEventSource = null;           // å·²å­˜åœ¨
   let currentDeepResearchEventSource = null;     // æ–°å¢
   let currentFreeConvAbortController = null;     // æ–°å¢

   function cancelAllActiveRequests() {
       cancelActiveSearch();  // å·²å­˜åœ¨
       if (currentDeepResearchEventSource) {
           currentDeepResearchEventSource.close();
           currentDeepResearchEventSource = null;
       }
       if (currentFreeConvAbortController) {
           currentFreeConvAbortController.abort();
           currentFreeConvAbortController = null;
       }
   }
   ```

3. **Bug #2 çš„ description ä¾†æº**ï¼šå‘¼å« `togglePinNewsCard()` çš„åœ°æ–¹éœ€è¦å‚³å…¥ descriptionã€‚ç›®å‰çš„å‘¼å«æ–¹åœ¨ news card æ¸²æŸ“ä¸­ï¼Œéœ€è¦è¿½è¹¤ `schema.description` å¾ card data å‚³åˆ° pin æŒ‰éˆ•çš„ click handlerã€‚

4. **Bug #6 çš„ `parse_number()` çµ„åˆæ•¸å­—é‚è¼¯**ï¼šå»ºè­°å¯¦ä½œå¦‚ä¸‹ï¼š
   ```python
   def parse_number(s):
       if s.isdigit():
           return int(s)
       if s in CHINESE_NUMBERS:
           return CHINESE_NUMBERS[s]
       # çµ„åˆæ•¸å­—ï¼šåäº”=15, äºŒå=20, äºŒåäº”=25
       if 'å' in s:
           parts = s.split('å')
           tens = CHINESE_NUMBERS.get(parts[0], 1) if parts[0] else 1
           ones = CHINESE_NUMBERS.get(parts[1], 0) if len(parts) > 1 and parts[1] else 0
           return tens * 10 + ones
       return int(s)  # fallback
   ```

### è·¨ Bug æ•´åˆè©•ä¼°

1. **æ•´åˆ 1: Free Conversation Prompt å…¨é¢å‡ç´š** â€” âœ… æ­£ç¢ºã€‚Bug #1ï¼ˆæ—¥æœŸï¼‰, #3ï¼ˆç³»çµ±é™åˆ¶ï¼‰, #9ï¼ˆèƒ½åŠ›èªªæ˜ï¼‰, #24ï¼ˆMarkdown æ ¼å¼ï¼‰éƒ½ä¿®æ”¹ `synthesize_free_conversation()` çš„ promptã€‚å¦å¤– Bug #2 çš„ context æ³¨å…¥ä¿®æ”¹ä¹Ÿåœ¨åŒä¸€å€‹å‡½æ•¸ã€‚å»ºè­° Bug #2 çš„å¾Œç«¯éƒ¨åˆ†ä¹Ÿç´å…¥æ­¤æ•´åˆã€‚

2. **æ•´åˆ 2: Retriever æ¶æ§‹å‡ç´š** â€” âš ï¸ **åŒæ„ Agent #1ï¼šBug #17 ä¸å±¬æ–¼æ­¤æ•´åˆ**ã€‚Bug #17 æ˜¯å‰ç«¯ KG toggle å•é¡Œï¼Œèˆ‡ retriever ç„¡é—œã€‚æ­£ç¢ºç¯„åœï¼šBug #11/#16ï¼ˆtime filterï¼‰+ Bug #18-20ï¼ˆauthor filterï¼‰ã€‚å»ºè­°è¨­è¨ˆé€šç”¨ `filters` åƒæ•¸ï¼Œå„ provider è‡ªè¡Œè½‰æ›ã€‚

3. **æ•´åˆ 3: å‰ç«¯è¼¸å…¥é«”é©—** â€” âœ… æ­£ç¢ºï¼Œä¸¦åŒæ„ Agent #1 å»ºè­°åŠ å…¥ Bug #17ã€‚ä¿®æ”¹ç¯„åœï¼š
   - Bug #10: IME `isComposing` è™•ç†ï¼ˆline 1218ï¼‰
   - Bug #23: Abort æŒ‰éˆ•å’Œ UI ç‹€æ…‹æ©Ÿï¼ˆä¸‰å€‹æ¨¡å¼ï¼‰
   - Bug #17: KG toggle wrapperï¼ˆHTML + JS + CSSï¼‰
   - Bug #2 å‰ç«¯éƒ¨åˆ†: é‡˜é¸è³‡æ–™æ“´å±• + placeholder æ–‡å­—
   - Bug #13: `addCitationLinks()` å¢åŠ  `private://` è™•ç†

   å»ºè­° Bug #13 ä¹Ÿç´å…¥æ­¤æ•´åˆï¼ˆå› ç‚ºæ˜¯å‰ç«¯ JS ä¿®æ”¹ï¼Œä¸”æ”¹å‹•å¾ˆå°ï¼‰ã€‚

---

*é©—è­‰å®Œæˆæ—¥æœŸï¼š2026-01-29*

---

## Agent é©—è­‰å ±å‘Š #3

> é©—è­‰æ—¥æœŸï¼š2026-01-29
> é©—è­‰è€…ï¼šClaude Code (Verification Agent #3)
> æ–¹æ³•ï¼šç¨ç«‹è®€å–ç¨‹å¼ç¢¼é©—è­‰ï¼Œèˆ‡ Agent #1 å’Œ Agent #2 äº¤å‰æ¯”å°

### é©—è­‰çµ±è¨ˆ

| çµæœ | Bug æ•¸é‡ | Bug ç·¨è™Ÿ |
|------|---------|---------|
| âœ… ä¿®å¾©è¨ˆç•«å¯è¡Œ | 10 å€‹ | #1, #3, #9, #10, #13, #24, #4/#5, #7, #8, #12, #14, #21 |
| âš ï¸ è¨ˆç•«éœ€è¦è£œå…… | 8 å€‹ | #6, #11/#16, #17, #2, #25, #22, #23, #15, #18-20 |
| âŒ è¨ˆç•«æœ‰å•é¡Œ | 0 å€‹ | â€” |

### èˆ‡å‰å…©è¼ª Agent çš„å·®ç•°

| Bug | Agent #1 | Agent #2 | Agent #3ï¼ˆæœ¬å ±å‘Šï¼‰ | å·®ç•°èªªæ˜ |
|-----|----------|----------|-------------------|---------|
| #17 | âš ï¸ å»ºè­°æ“ä½œ kgDisplayContainer | âš ï¸ åå° #1ï¼Œæ”¯æŒ wrapper | âš ï¸ **åŒæ„ #2ï¼Œä½†æå‡ºç¬¬ä¸‰æ–¹æ¡ˆ** | æå‡ºã€Œç„¡ HTML ä¿®æ”¹ã€æ›¿ä»£æ–¹æ¡ˆï¼štoggle handler éæ­· kgDisplayContainer é header å­å…ƒç´  |
| #22 | âœ… å¯è¡Œ | âœ… å¯è¡Œ | âš ï¸ **éœ€è¦è£œå……** | å…©ä½ Agent éƒ½æ¨™è¨˜ç‚ºå¯è¡Œï¼Œä½†è¨ˆç•«æŒ‡å®šçš„ `_citation_rules()` æ–¹æ³•ä¸å­˜åœ¨ï¼Œæ‡‰æ˜ç¢ºæŒ‡å®š `build_compose_prompt()` line 198 å¾Œæ’å…¥ |
| #10 | âœ… æåˆ°éœ€ç¢ºèª FC handler | âœ… ç¢ºèªå…±ç”¨ input | âœ… **åŒæ„ #2ï¼Œè£œå……è¡Œè™Ÿä¿®æ­£** | ç•¶å‰è¡Œè™Ÿç‚º line 1234ï¼ˆé 1218ï¼‰ï¼Œå¯èƒ½å› æª”æ¡ˆä¿®æ”¹åç§» |

---

### çˆ­è­°è£æ±º

---

#### çˆ­è­° 1: Bug #17 (KG toggle) çš„ä¿®å¾©æ–¹æ¡ˆ

**è£æ±ºï¼šAgent #2 æ­£ç¢ºï¼ŒAgent #1 çš„æ›¿ä»£æ–¹æ¡ˆä¸å¯æ¡ç”¨ã€‚ä½†æˆ‘æå‡ºç¬¬ä¸‰æ–¹æ¡ˆä½œç‚ºå‚™é¸ã€‚**

**æˆ‘çš„ç¨ç«‹é©—è­‰**ï¼š

è®€å– `news-search-prototype.html:369-400`ï¼ŒHTML çµæ§‹ç‚ºï¼š
```
kgDisplayContainer (div#kgDisplayContainer, line 369)
â”œâ”€â”€ kg-display-header (div.kg-display-header, line 370)
â”‚   â”œâ”€â”€ kg-display-title (line 371)
â”‚   â””â”€â”€ controls div (line 376)
â”‚       â”œâ”€â”€ kgViewToggle (div#kgViewToggle, line 378) â€” åœ–å½¢/åˆ—è¡¨åˆ‡æ›
â”‚       â””â”€â”€ kgToggleButton (button#kgToggleButton, line 382) â€” â–¼ æ”¶èµ·
â”œâ”€â”€ kgGraphView (div#kgGraphView, line 388) â€” åœ–å½¢è¦–åœ–
â”œâ”€â”€ kgDisplayContent (div#kgDisplayContent, line 392) â€” åˆ—è¡¨è¦–åœ–
â”œâ”€â”€ kgLegend (div#kgLegend, line 396) â€” åœ–ä¾‹
â””â”€â”€ kgDisplayEmpty (div#kgDisplayEmpty, line 397) â€” ç©ºç‹€æ…‹
```

**Agent #1 æ–¹æ¡ˆï¼ˆæ“ä½œ kgDisplayContainerï¼‰çš„è‡´å‘½ç¼ºé™·**ï¼š
- `kgToggleButton` åœ¨ `kgDisplayContainer > kg-display-header > controls` å…§éƒ¨
- éš±è— `kgDisplayContainer` æœƒåŒæ™‚éš±è— toggle æŒ‰éˆ•
- ä½¿ç”¨è€…ç„¡æ³•é‡æ–°å±•é–‹ â†’ **ä¸å¯æ¡ç”¨**

**è¨ˆç•«çš„ wrapper æ–¹æ¡ˆ**ï¼šæ­£ç¢ºã€‚åœ¨ kgGraphView/kgDisplayContent/kgLegend/kgDisplayEmpty å¤–åŠ  `kgContentWrapper` divã€‚

**æˆ‘çš„ç¬¬ä¸‰æ–¹æ¡ˆï¼ˆå‚™é¸ï¼‰**ï¼šä¸ä¿®æ”¹ HTMLï¼Œtoggle handler æ”¹ç‚ºï¼š
```javascript
toggleButton.addEventListener('click', () => {
    const container = document.getElementById('kgDisplayContainer');
    const children = container.children;
    const isCollapsed = graphView.style.display === 'none' && listView.style.display === 'none';
    for (const child of children) {
        if (!child.classList.contains('kg-display-header')) {
            child.style.display = isCollapsed ? '' : 'none';
        }
    }
    icon.textContent = isCollapsed ? 'â–¼' : 'â–¶';
    toggleButton.childNodes[1].textContent = isCollapsed ? ' æ”¶èµ·' : ' å±•é–‹';
});
```
å„ªé»ï¼šä¸éœ€ä¿®æ”¹ HTMLã€‚ç¼ºé»ï¼šå±•é–‹æ™‚éœ€è¦æ¢å¾©å„å…ƒç´ çš„æ­£ç¢º display ç‹€æ…‹ï¼ˆgraphView å’Œ listView è¦æ ¹æ“šç•¶å‰ view mode æ±ºå®šé¡¯ç¤ºå“ªå€‹ï¼‰ï¼Œé‚è¼¯è¼ƒè¤‡é›œã€‚

**æœ€çµ‚å»ºè­°**ï¼šè¨ˆç•«çš„ **wrapper æ–¹æ¡ˆæ›´ç©©å¥**ï¼Œå› ç‚ºå±•é–‹æ™‚ wrapper è¨­ç‚º `display: ''` å³å¯æ¢å¾©å­å…ƒç´ åŸç‹€æ…‹ï¼ˆå­å…ƒç´ çš„ inline style ä¸å—å½±éŸ¿ï¼‰ã€‚ç¬¬ä¸‰æ–¹æ¡ˆçš„å±•é–‹æ¢å¾©é‚è¼¯éœ€è¦è¿½è¹¤å„å…ƒç´ ä¹‹å‰çš„ display å€¼ï¼Œæ›´å®¹æ˜“å‡ºéŒ¯ã€‚

**é‡è¦è£œå……**ï¼ˆåŒæ„ Agent #2ï¼‰ï¼šwrapper å¿…é ˆåŒ…å« `kgDisplayEmpty` å…ƒç´ ã€‚

---

#### çˆ­è­° 2: Bug #11/#16 temporal search çš„è¤‡ç”¨

**è£æ±ºï¼šAgent #2 æ­£ç¢ºã€‚Reasoning module çš„ temporal search æ˜¯ prompt-level ç´„æŸï¼Œä¸æ˜¯ retriever-level filterã€‚**

**æˆ‘çš„ç¨ç«‹é©—è­‰**ï¼š

è®€å– `reasoning/prompts/analyst.py:45-65`ï¼š
```python
# Line 47-50: temporal_context è½‰ç‚ºæ–‡å­—æ³¨å…¥ prompt
if temporal_context:
    start_date = temporal_context.get('start', 'N/A')
    end_date = temporal_context.get('end', 'N/A')
    time_range = f"\n- Time Range: {start_date} to {end_date}"
```
é€™åªæ˜¯åœ¨ Analyst prompt ä¸­åŠ å…¥ `"Time Range: X to Y"` æ–‡å­—ã€‚**æ²’æœ‰**ä»»ä½• Qdrant filterã€payload filterã€æˆ– retriever å±¤ç´šçš„æ™‚é–“éæ¿¾ã€‚

æœå°‹ `temporal_context` ç”¨æ³•ï¼ˆindexer.py çµæœï¼‰ä¹Ÿç¢ºèªï¼š
- `deep_research.py`ï¼šå‚³é temporal_context çµ¦ orchestrator
- `orchestrator.py`ï¼šå‚³éçµ¦ analyst.research()
- `analyst.py`ï¼šä½œç‚º prompt åƒæ•¸
- **å…¨ç¨‹åªæ˜¯ prompt æ–‡å­—æ³¨å…¥**

**è¤‡ç”¨æ–¹æ¡ˆå»ºè­°**ï¼š
1. **å¯è¤‡ç”¨çš„éƒ¨åˆ†**ï¼š`time_range_extractor.py` çš„æ™‚é–“è§£æçµæœï¼ˆå·²å­˜åœ¨ï¼Œç›´æ¥ä½¿ç”¨ï¼‰
2. **ä¸å¯è¤‡ç”¨çš„éƒ¨åˆ†**ï¼šRetriever å±¤ç´šçš„ Qdrant filter æ˜¯**å…¨æ–°å¯¦ä½œ**
3. **Dev èªªã€Œä¹Ÿåœ¨æ–°èæœå°‹åŠŸèƒ½ä¸­ä½¿ç”¨ã€**ï¼šæœ€ä½³ç†è§£æ˜¯è¤‡ç”¨ã€Œæ™‚é–“æ„ŸçŸ¥ã€æ¦‚å¿µï¼Œè€Œéå­—é¢è¤‡ç”¨ prompt æ³¨å…¥æ©Ÿåˆ¶ã€‚å…·é«”åšæ³•ï¼š
   - `time_range_extractor.py` è§£ææŸ¥è©¢ â†’ å¾—åˆ° `temporal_range`
   - `baseHandler.py` å°‡ `temporal_range` è½‰ç‚º filter dict å‚³çµ¦ `retriever.search()`
   - `retriever.py` æ–°å¢ `filters` åƒæ•¸ï¼Œå‚³çµ¦å„ provider
   - Qdrant provider ç”¨ `FieldCondition` å° `datePublished` åš range filter
4. **Fallback**ï¼šåš´æ ¼éæ¿¾çµæœ 0 æ™‚ï¼Œç§»é™¤ filter é‡æŸ¥ï¼Œä¸¦è¨­ `time_filter_relaxed = True` flag é€šçŸ¥å‰ç«¯

---

#### çˆ­è­° 3: Bug #23 abort æ¶æ§‹çš„å®Œæ•´æ€§

**è£æ±ºï¼šAgent #2 çš„åˆ†ææœ€å®Œæ•´ä¸”æ­£ç¢ºã€‚ä¸‰å€‹æ¨¡å¼çš„ abort ç¾ç‹€å·®ç•°å·¨å¤§ã€‚**

**æˆ‘çš„ç¨ç«‹é©—è­‰**ï¼š

| æ¨¡å¼ | å»ºç«‹æ–¹å¼ | æ¨¡çµ„ç´šå¼•ç”¨ | abort æ©Ÿåˆ¶ | ç¾ç‹€ |
|------|---------|-----------|-----------|------|
| **æœå°‹** | EventSource (line 689) + fetch (line 1314) | âœ… `currentSearchAbortController` (line 68), `currentSearchEventSource` (line 69) | âœ… `cancelActiveSearch()` (line 1242) | âœ… å®Œæ•´ |
| **Deep Research** | `const eventSource = new EventSource(...)` (line 1529) | âŒ å±€éƒ¨ `const` è®Šæ•¸ | âŒ ç„¡å¤–éƒ¨ abort é€”å¾‘ | âŒ å®Œå…¨ç„¡æ³• abort |
| **Free Conversation** | `fetch()` via `handlePostStreamingRequest()` (line 764) | âŒ ç„¡ AbortController | âŒ fetch ç„¡ signal åƒæ•¸ | âŒ å®Œå…¨ç„¡æ³• abort |

**é—œéµç¨‹å¼ç¢¼è­‰æ“š**ï¼š
- æœå°‹å·²æœ‰ï¼šline 68-69 å®šç¾©æ¨¡çµ„ç´šè®Šæ•¸ï¼Œline 1242-1253 å®šç¾© `cancelActiveSearch()`ï¼Œline 1262 å»ºç«‹ `new AbortController()`
- Deep Researchï¼šline 1529 `const eventSource = new EventSource(deepResearchUrl.toString())` â€” `const` ä¸”ç‚ºå‡½æ•¸å±€éƒ¨è®Šæ•¸
- Free Conversationï¼šline 2481 å‘¼å« `handlePostStreamingRequest('/ask', requestBody, query)`ï¼Œè€Œ `handlePostStreamingRequest` (line 763-764) çš„ `fetch()` æ²’æœ‰å‚³å…¥ `signal`

**è¨ˆç•«ä¿®æ­£å»ºè­°**ï¼ˆåŒæ„ Agent #2ï¼‰ï¼š
- æœå°‹æ¨¡å¼ï¼šå¾©ç”¨ç¾æœ‰ `cancelActiveSearch()`
- Deep Researchï¼šæ–°å¢ `let currentDeepResearchEventSource = null`ï¼Œline 1529 æ”¹ç‚ºè³¦å€¼çµ¦æ­¤è®Šæ•¸
- Free Conversationï¼šæ–°å¢ `let currentFreeConvAbortController = null`ï¼Œ`handlePostStreamingRequest()` å¢åŠ  AbortController åƒæ•¸

---

#### çˆ­è­° 4: Bug #17 wrapper æ˜¯å¦éºæ¼ kgDisplayEmpty

**è£æ±ºï¼šAgent #2 æ­£ç¢ºã€‚`kgDisplayEmpty` å¿…é ˆåŒ…å«åœ¨ wrapper ä¸­ã€‚**

**æˆ‘çš„ç¨ç«‹é©—è­‰**ï¼š

HTML line 397-399ï¼š
```html
<div class="kg-display-empty" id="kgDisplayEmpty" style="display: none;">
    â„¹ï¸ æ­¤æŸ¥è©¢ä¸é©åˆç”ŸæˆçŸ¥è­˜åœ–è­œï¼ˆä¾‹å¦‚ï¼šç´”ç²¹çš„æ„è¦‹å•ç­”æˆ–å–®ä¸€æ•¸æ“šæŸ¥è©¢ï¼‰
</div>
```

æ­¤å…ƒç´ æ˜¯ `kgDisplayContainer` çš„ç›´æ¥å­å…ƒç´ ï¼Œèˆ‡ `kgGraphView`ã€`kgDisplayContent`ã€`kgLegend` åŒç´šã€‚ç•¶æŸ¥è©¢ä¸é©åˆ KG æ™‚æœƒé¡¯ç¤ºæ­¤ç©ºç‹€æ…‹ã€‚å¦‚æœ wrapper ä¸åŒ…å«å®ƒï¼Œæ”¶èµ· KG æ™‚æ­¤å…ƒç´ å¯èƒ½ä»ç„¶å¯è¦‹ã€‚

**å®Œæ•´çš„ wrapper æ‡‰åŒ…å«**ï¼š
1. `kgGraphView` (line 388)
2. `kgDisplayContent` (line 392)
3. `kgLegend` (line 396)
4. `kgDisplayEmpty` (line 397) â† è¨ˆç•«éºæ¼

---

### ä¸‰è¼ªé©—è­‰å…±è­˜

ä»¥ä¸‹æ˜¯ä¸‰å€‹ Agent éƒ½åŒæ„çš„çµè«–ï¼š

1. **Bug #1 âœ…**ï¼šä¸‰å€‹ prompt è®Šé«”å‡ç„¡æ—¥æœŸæ³¨å…¥ï¼Œä¿®å¾©è¨ˆç•«æ­£ç¢º
2. **Bug #6 âš ï¸**ï¼š8 å€‹ `_zh` regex ç¢ºå¯¦åªç”¨ `(\d+)`ï¼Œéœ€åŠ ä¸­æ–‡æ•¸å­—æ”¯æ´ï¼›prefix ä¸ä¸€è‡´éœ€çµ±ä¸€ï¼›`parse_number()` éœ€æ”¯æ´çµ„åˆæ•¸å­—
3. **Bug #10 âœ…**ï¼škeydown handler ç¼ºå°‘ `!e.isComposing`ï¼Œä¿®å¾©æ–¹æ¡ˆæ­£ç¢ºã€‚æœå°‹å’Œ FC å…±ç”¨åŒä¸€å€‹ input handlerï¼ˆAgent #2 ç™¼ç¾ï¼ŒAgent #3 ç¢ºèªï¼‰
4. **Bug #11/#16 âš ï¸**ï¼šretriever.py `search()` å®Œå…¨ç„¡æ™‚é–“éæ¿¾ã€‚éœ€æ–°å¢ retriever-level filterï¼ˆéå–®ç´”è¤‡ç”¨ reasoning prompt æ³¨å…¥ï¼‰
5. **Bug #13 âœ…**ï¼š`addCitationLinks()` ç„¡ `private://` è™•ç†ï¼Œè¨ˆç•«æ­£ç¢º
6. **Bug #17 âš ï¸**ï¼štoggle åªæ“ä½œ kgDisplayContent çš„ `.collapsed` classï¼Œä¸å½±éŸ¿ kgGraphViewã€‚wrapper æ–¹æ¡ˆæ–¹å‘æ­£ç¢ºï¼Œä½†éœ€åŒ…å« kgDisplayEmpty
7. **Bug #22 âœ…/âš ï¸**ï¼šWriter prompt ç„¡å¼•ç”¨èªæ³•é¢¨æ ¼æŒ‡å¼•ã€‚ä½† `_citation_rules()` æ–¹æ³•ä¸å­˜åœ¨ï¼Œéœ€æ”¹ç‚ºåœ¨ `build_compose_prompt()` ä¸­æ’å…¥
8. **Bug #25 âš ï¸**ï¼šsource_urls é•·åº¦ç”± source_map.keys() æ±ºå®šï¼Œä¸è¦†è“‹ Writer è¶…å‡ºç¯„åœçš„å¼•ç”¨ã€‚ä¸‰ç®¡é½Šä¸‹æ–¹æ¡ˆåˆç†
9. **Bug #2 âš ï¸**ï¼šé‡˜é¸è³‡æ–™åªå­˜ url/title/pinnedAtï¼ŒPOST body ç„¡é‡˜é¸è³‡æ–™æ¬„ä½
10. **Bug #23 âš ï¸**ï¼šæœå°‹æœ‰å®Œæ•´ abort åŸºç¤è¨­æ–½ï¼ŒDeep Research å’Œ Free Conversation å®Œå…¨ç„¡æ³• abort
11. **Bug #3, #9, #24 âœ…**ï¼šprompt ä¿®æ”¹æ–¹æ¡ˆæ­£ç¢º
12. **Bug #4/#5, #7, #8, #12, #14, #15, #18-20, #21 âœ…**ï¼šæ–¹å‘æ­£ç¢ºï¼ˆéƒ¨åˆ†éœ€é€²ä¸€æ­¥èª¿æŸ¥ï¼‰
13. **æ•´åˆ 2 æœ‰èª¤**ï¼šBug #17 ä¸å±¬æ–¼ Retriever æ¶æ§‹å‡ç´šï¼ˆä¸‰å€‹ Agent ä¸€è‡´ï¼‰

### ä»æœ‰åˆ†æ­§çš„é …ç›®

| é …ç›® | åˆ†æ­§ | å»ºè­° Dev æ±ºå®š |
|------|------|-------------|
| Bug #17 ä¿®å¾©æ–¹æ¡ˆ | wrapperï¼ˆè¨ˆç•« + Agent #2 + Agent #3 æ¨è–¦ï¼‰ vs éæ­·å­å…ƒç´ ï¼ˆAgent #3 å‚™é¸ï¼‰ | æ¨è–¦ wrapper æ–¹æ¡ˆï¼Œæ›´ç©©å¥ |
| Bug #6 prefix çµ±ä¸€ç­–ç•¥ | Agent #1 å»ºè­°å…¨éƒ¨çµ±ä¸€ç‚º `(?:è¿‘\|æœ€è¿‘\|éå»)` vs Agent #2 å»ºè­°æŒ‰èªæ„åˆ†çµ„ | å»ºè­° Agent #2 æ–¹æ¡ˆï¼š`past_` = `(?:éå»\|è¿‘)`ï¼Œ`last_` = `(?:æœ€è¿‘\|è¿‘)`ï¼Œä¿æŒèªæ„å€åˆ† |
| Bug #11/#16 ã€Œè¤‡ç”¨ã€çš„ç†è§£ | æ˜¯å­—é¢è¤‡ç”¨ prompt æ©Ÿåˆ¶ï¼Ÿé‚„æ˜¯è¤‡ç”¨ã€Œæ™‚é–“æ„ŸçŸ¥ã€æ¦‚å¿µï¼Ÿ | å»ºè­°ç†è§£ç‚ºè¤‡ç”¨ `time_range_extractor.py` çš„è§£æçµæœï¼Œä½† retriever filter æ˜¯æ–°å¯¦ä½œ |

### é€é …é©—è­‰

---

#### Bug #1: æ—¥æœŸè¬Šç¨±å•é¡Œ
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨ç«‹é©—è­‰**: è®€å– `generate_answer.py:631-686`ã€‚ä¸‰å€‹ prompt è®Šé«”ï¼š
  - `has_research_report` (line 633): ã€Œä½ æ˜¯ä¸€å€‹å°ˆæ¥­çš„å°ç£æ–°èåˆ†æåŠ©æ‰‹ã€â€” ç„¡æ—¥æœŸ
  - `has_cached_articles` (line 648): ã€ŒYou are an AI assistant helping with Taiwan news analysisã€â€” ç„¡æ—¥æœŸ
  - `else` (line 674): ã€ŒYou are an AI assistant helping with questions about Taiwan newsã€â€” ç„¡æ—¥æœŸ
- **ä¸‰è¼ªä¸€è‡´**: æ˜¯ã€‚ä¿®å¾©è¨ˆç•«æ­£ç¢ºä¸”ç°¡å–®ã€‚

---

#### Bug #6: æ™‚é–“ç¯„åœè¨ˆç®—éŒ¯èª¤
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦è£œå……
- **ç¨ç«‹é©—è­‰**: è®€å– `time_range_extractor.py:38-88` (regex) å’Œ `:189-221` (parse logic)ã€‚
  - 8 å€‹ `_zh` regex å…¨éƒ¨ç”¨ `(\d+)`ï¼Œç„¡æ³•åŒ¹é…ä¸­æ–‡æ•¸å­— â† ç¢ºèª
  - Prefix ä¸ä¸€è‡´ï¼š
    - `past_x_days_zh` (line 40): `éå»` â€” ä¸å« `è¿‘`
    - `last_x_days_zh` (line 41): `æœ€è¿‘` â€” ä¸å« `è¿‘`
    - `past_x_weeks_zh` (line 46): `éå»` â€” ä¸å« `è¿‘`
    - `last_x_weeks_zh` (line 47): `æœ€è¿‘` â€” ä¸å« `è¿‘`
    - `past_x_months_zh` (line 51): `éå»` â€” ä¸å« `è¿‘`
    - `last_x_months_zh` (line 52): `(?:è¿‘|æœ€è¿‘)` â€” åŒ…å« `è¿‘` âœ…
    - `past_x_years_zh` (line 56): `éå»` â€” ä¸å« `è¿‘`
    - `last_x_years_zh` (line 57): `(?:è¿‘|æœ€è¿‘)` â€” åŒ…å« `è¿‘` âœ…
  - åªæœ‰ months å’Œ years çš„ `last_x_*_zh` æœ‰ `è¿‘` å‰ç¶´ï¼Œå…¶ä»– 6 å€‹éƒ½ç¼ºå°‘
  - è§£æé‚è¼¯ (lines 196/202/209/217): å…¨ç”¨ `int(match.group(1))` â† ç¢ºèª
- **è£œå……**:
  1. åŒæ„ Agent #1: `parse_number()` éœ€æ”¯æ´çµ„åˆæ•¸å­—ï¼ˆåäº”=15, äºŒå=20ï¼‰
  2. åŒæ„ Agent #2 çš„åˆ†çµ„ç­–ç•¥: `past_` ç³»åˆ— = `(?:éå»|è¿‘)`, `last_` ç³»åˆ— = `(?:æœ€è¿‘|è¿‘)`
  3. **æ–°ç™¼ç¾**ï¼šä½¿ç”¨è€…èªªã€Œè¿‘ä¸‰å¤©ã€ç›®å‰ä¸æœƒè¢«ä»»ä½• `_days_zh` pattern åŒ¹é…åˆ°ï¼ˆå› ç‚º `past_x_days_zh` è¦ `éå»`, `last_x_days_zh` è¦ `æœ€è¿‘`ï¼‰ï¼Œé€™æ˜¯ä¸€å€‹è¼ƒå¸¸è¦‹çš„è¡¨è¿°ï¼Œå¿…é ˆä¿®å¾©

---

#### Bug #10: Mac è¼¸å…¥æ³• Enter å•é¡Œ
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨ç«‹é©—è­‰**: æœå°‹ `news-search.js` ä¸­æ‰€æœ‰ `keydown` handlerï¼š
  - Line 379: `document.addEventListener('keydown')` â€” ESC é—œé–‰ historyï¼Œä¸æ¶‰åŠ Enter
  - **Line 1234**: `searchInput.addEventListener('keydown')` â€” `if (e.key === 'Enter' && !e.shiftKey)` â€” **ä¸»è¦ä¿®å¾©é»ï¼Œç¼ºå°‘ `!e.isComposing`**
  - Line 4132: rename input â€” Enter è§¸ç™¼ blurï¼Œä½å„ªå…ˆ
  - Line 4452: folder rename input â€” Enter è§¸ç™¼ blurï¼Œä½å„ªå…ˆ
- **è¡Œè™Ÿæ³¨æ„**: å‰å…©è¼ª Agent å¼•ç”¨ line 1218ï¼Œç›®å‰ç¨‹å¼ç¢¼ç‚º line 1234ã€‚å¯èƒ½å› æª”æ¡ˆä¿®æ”¹åç§»ã€‚
- **åŒæ„ Agent #2**: æœå°‹å’Œ Free Conversation å…±ç”¨åŒä¸€å€‹ `searchInput`ï¼Œ`performSearch()` å…§éƒ¨æ ¹æ“š `currentMode` åˆ†æµã€‚ä¿®å¾© line 1234 ä¸€è™•å³è¦†è“‹å…©å€‹æ¨¡å¼ã€‚

---

#### Bug #11 + #16: æ™‚é–“éæ¿¾ç¼ºå¤±
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦å¯¦è³ªè£œå……
- **ç¨ç«‹é©—è­‰**: è®€å– `retriever.py:817-937`ã€‚
  - `search()` æ–¹æ³•ç°½å: `async def search(self, query, site, num_results=50, endpoint_name=None, **kwargs)`
  - å®Œå…¨ç„¡ time filtering â€” åªåš endpoint parallel query + aggregate + deduplicate
  - **kwargs ç¾å·²å­˜åœ¨**ï¼Œå¯ç”¨æ–¼å‚³å…¥ filter åƒæ•¸
- **Reasoning temporal search é©—è­‰**ï¼ˆè¦‹çˆ­è­°è£æ±º #2ï¼‰: prompt-level only
- **è£œå……**: åŒæ„ Agent #1 çš„é€šç”¨ filter æ¶æ§‹å»ºè­°ï¼ˆ`filters` åƒæ•¸ç”±å„ provider è½‰æ›ï¼‰ï¼ŒåŒæ„ Agent #2 çš„è³‡æ–™æµèªªæ˜

---

#### Bug #13: å¼•ç”¨é€£çµ private:// å•é¡Œ
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨ç«‹é©—è­‰**: è®€å– `news-search.js:1596-1618` `addCitationLinks()` å‡½æ•¸ï¼š
  - Line 1602: regex `/\[(\d+)\]/g`
  - Line 1604: bounds check
  - Line 1608: `urn:llm:knowledge:` â†’ `[N]<sup>AI</sup>`
  - Line 1614: ä¸€èˆ¬ URL â†’ `<a>` é€£çµ
  - Line 1617: out of range â†’ return original match
  - **ç„¡ `private://` è™•ç†** â† ç¢ºèª
- **ä¸‰è¼ªä¸€è‡´**: æ˜¯ã€‚åœ¨ line 1612 (urn è™•ç†çš„ `}` ä¹‹å¾Œ) åŠ å…¥ `private://` æª¢æŸ¥ã€‚

---

#### Bug #17: çŸ¥è­˜åœ–è­œæ”¶ä¸èµ·ä¾†
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦è£œå……ï¼ˆè¦‹çˆ­è­°è£æ±º #1 å’Œ #4ï¼‰
- **ç¨ç«‹é©—è­‰**:
  - HTML çµæ§‹å·²ç¢ºèªï¼ˆè¦‹çˆ­è­°è£æ±º #1ï¼‰
  - Toggle handler (`news-search.js:2399-2417`): åªæ“ä½œ `kgDisplayContent.classList`ï¼ˆ`.collapsed`ï¼‰ï¼Œä¸å½±éŸ¿ `kgGraphView` â† åœ–å½¢æ¨¡å¼ä¸‹ toggle ç„¡æ•ˆ
  - View toggle (`news-search.js:2026-2057`): ç”¨ inline `style.display = 'block'/'none'` åˆ‡æ› graphView/listView â† inline style å„ªå…ˆç´šé«˜æ–¼ `.collapsed` class
  - CSS (`news-search.css:775-777`): `.kg-display-content.collapsed { display: none; }` ç¢ºèªå­˜åœ¨
- **ä¿®å¾©å»ºè­°**: æ¡ç”¨ wrapper æ–¹æ¡ˆï¼ŒåŒ…å« 4 å€‹å­å…ƒç´ ï¼ˆkgGraphView, kgDisplayContent, kgLegend, kgDisplayEmptyï¼‰ï¼Œä¸åŒ…å« header

---

#### Bug #22: å¼•ç”¨æ ¼å¼ä¸é€šé †
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦è£œå……
- **ç¨ç«‹é©—è­‰**: è®€å– `writer.py:135-285` `build_compose_prompt()` æ–¹æ³•ï¼š
  - Line 196-198: å¼•ç”¨ç™½åå–®ç´„æŸï¼ˆã€Œåš´ç¦ç„¡ä¸­ç”Ÿæœ‰ã€ï¼‰
  - Line 247-249: `sources_used` é™åˆ¶ï¼ˆå¿…é ˆæ˜¯ `analyst_citations` å­é›†ï¼‰
  - **ç„¡ä»»ä½•å¼•ç”¨ã€Œèªæ³•é¢¨æ ¼ã€æˆ–ã€Œèªæ³•æ ¼å¼ã€æŒ‡å¼•** â† ç¢ºèª
- **è¨ˆç•«å•é¡Œ**: ä¿®æ”¹ä½ç½®å¯« `_citation_rules()` æˆ–é¡ä¼¼æ–¹æ³•ï¼Œä½†æ­¤æ–¹æ³•**ä¸å­˜åœ¨**ï¼ˆAgent #1 åœ¨éºæ¼ç™¼ç¾ä¸­æŒ‡å‡ºï¼ŒAgent #2 ä¹Ÿç¢ºèªï¼‰
- **æ­£ç¢ºåšæ³•**: åœ¨ `build_compose_prompt()` çš„ prompt å­—ä¸²ä¸­ï¼Œline 198 (`{analyst_citations}`) ä¹‹å¾Œã€line 200 (`---`) ä¹‹å‰æ’å…¥å¼•ç”¨èªæ³•é¢¨æ ¼æŒ‡å¼•
- **Agent #1 å’Œ #2 éƒ½æ¨™è¨˜ç‚º âœ… å¯è¡Œ**ï¼Œä½†æˆ‘èªç‚ºæ‡‰æ¨™è¨˜ç‚º âš ï¸ éœ€è¦è£œå……ï¼Œå› ç‚ºè¨ˆç•«æŒ‡å®šçš„ä¿®æ”¹ä½ç½®æœ‰èª¤

---

#### Bug #25: å¼•ç”¨æ•¸å­—å¤ªå¤§æ²’æœ‰è¶…é€£çµ
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦è£œå……
- **ç¨ç«‹é©—è­‰**: è®€å– `orchestrator.py:1111-1139`ï¼š
  - Line 1115: `max_cid = max(self.source_map.keys()) if self.source_map else 0`
  - Line 1116: `writer_citations = final_report.sources_used`
  - Line 1121: `for cid in range(1, max_cid + 1)` â€” åªå»ºåˆ° source_map çš„æœ€å¤§ key
  - å‰ç«¯ `addCitationLinks()` (JS line 1604): `index >= 0 && index < sources.length` â€” è¶…å‡º sources é•·åº¦è¿”å›åŸæ–‡
- **æ ¹å› ç¢ºèª**: ä¸‰è¼ªä¸€è‡´ã€‚source_urls ä¸è¦†è“‹ Writer è¶…å‡ºç¯„åœçš„å¼•ç”¨ã€‚
- **æ–¹æ¡ˆ A ä¿®æ­£**: åŒæ„ Agent #1 å’Œ #2 â€” å°‡ line 1115 æ”¹ç‚º `max(max(source_map.keys(), default=0), max(final_report.sources_used, default=0))`
- **æ³¨æ„**: æ–¹æ¡ˆ A ä¿®æ­£å¾Œï¼Œè¶…å‡º source_map çš„ ID ä»ç‚ºç©ºå­—ä¸²ã€‚æ–¹æ¡ˆ Cï¼ˆå‰ç«¯é™ç´šé¡¯ç¤ºï¼‰ä»æœ‰å¿…è¦ï¼Œå¦å‰‡é€™äº›å¼•ç”¨åœ¨ UI ä¸Šä¸å¯è¦‹ï¼ˆline 1606 `if (url)` æœƒ skip ç©ºå­—ä¸²ï¼‰

---

#### Bug #2: Free Conversation åªç”¨å‰ 10 å€‹ Cache çµæœ
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦å¯¦è³ªè£œå……
- **ç¨ç«‹é©—è­‰**:
  - `togglePinNewsCard(url, title)` (line 2757): åªæ¥æ”¶ url å’Œ title
  - `pinnedNewsCards.push({ url, title, pinnedAt: Date.now() })` (line 2770-2774): **ç„¡ description**
  - POST body (line 2455-2464): `{ query, site, generate_mode, streaming, free_conversation, session_id, conversation_id, prev }` â€” **ç„¡ pinned_articles**
  - å¯é¸æ¬„ä½ (line 2466-2476): `research_report`, `include_private_sources`, `user_id` â€” ä»ç„¡ pinned
- **ä¸‰è¼ªä¸€è‡´**: é‡˜é¸è³‡æ–™çµæ§‹éœ€æ“´å±•ï¼ŒPOST å”è­°éœ€å¢åŠ  pinned_articles æ¬„ä½
- **åŒæ„ Agent #2**: æå‡ºçš„å…·é«”å‰å¾Œç«¯å”è­°æ–¹æ¡ˆåˆç†

---

#### Bug #23: æš«åœå°è©±æŒ‰éˆ•ç¼ºå¤±
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦å¯¦è³ªè£œå……
- **ç¨ç«‹é©—è­‰**: è¦‹çˆ­è­°è£æ±º #3
- **ä¸‰è¼ªä¸€è‡´**: æœå°‹å·²æœ‰ abort åŸºç¤è¨­æ–½ï¼ŒDR å’Œ FC å®Œå…¨ç¼ºå¤±
- **è¨ˆç•«ä¿®æ­£**: Step 1 ä¸æ‡‰èªªã€Œå°‡ EventSource å’Œ AbortController å­˜ç‚ºæ¨¡çµ„ç´šè®Šæ•¸ã€ï¼ˆæœå°‹çš„å·²ç¶“æ˜¯ï¼‰ï¼Œè€Œæ‡‰åˆ†ä¸‰å€‹æ¨¡å¼è™•ç†

---

#### Bug #3: åˆç†åŒ–éŒ¯èª¤ç­”æ¡ˆ
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨ç«‹é©—è­‰**: åŒ Bug #1 ä½ç½®ï¼Œprompt ä¸­ç„¡ç³»çµ±é™åˆ¶èªªæ˜ã€‚
- **ä¸‰è¼ªä¸€è‡´**: æ˜¯ã€‚

---

#### Bug #4 + #5: æ·±åº¦ç ”ç©¶æ­§ç¾©æª¢æ¸¬
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **é©—è­‰**: æ–¹å‘åˆç†ã€‚å‰ç«¯ clarification é¸é …éœ€åŠ å…¥è‡ªç”±æ–‡å­—è¼¸å…¥å’Œã€Œæ²’æœ‰ã€æŒ‰éˆ•ã€‚

---

#### Bug #9: ç„¡æ³•å­˜å–å³æ™‚æ–°è
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨ç«‹é©—è­‰**: åŒ Bug #1 ä½ç½®ï¼Œprompt ä¸­ç„¡ç³»çµ±èƒ½åŠ›èªªæ˜ã€‚

---

#### Bug #24: å›è¦†æ²’æœ‰æ’ç‰ˆæ›è¡Œ
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨ç«‹é©—è­‰**: ç¢ºèªä¸‰å€‹ prompt è®Šé«”å‡æœªæ˜ç¢ºè¦æ±‚ Markdown æ ¼å¼ã€‚`has_cached_articles` é›–ç„¶ç”¨äº† `**ç²—é«”**` ç¤ºä¾‹ï¼Œä½†æ²’æœ‰ç³»çµ±æ€§è¦æ±‚ Markdown æ ¼å¼åŒ–ã€‚
- **æ­¥é©Ÿ 1 çµæœ**: prompt ä¸­ç¢ºå¯¦æ²’æœ‰ Markdown æ ¼å¼è¦æ±‚ â†’ éœ€åŸ·è¡Œæ­¥é©Ÿ 2

---

#### Bug #14: æ‘˜è¦å›é¥‹æŒ‰éˆ•
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œï¼ˆéœ€ /planï¼‰
- **é©—è­‰**: åˆæ­¥æ–¹å‘åˆç†ã€‚

---

#### Bug #7: ç¼ºå°‘ç´«è‰²è™›ç·šæ¨™è¨˜
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œï¼ˆéœ€èª¿æŸ¥ï¼‰
- **é©—è­‰**: èª¿æŸ¥æ–¹å‘æ­£ç¢ºã€‚

---

#### Bug #8: æ²’æœ‰çœŸçš„åˆ—å‡º 12 æœˆåå¤§æ–°è
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œï¼ˆåŠŸèƒ½é™åˆ¶ï¼Œéœ€èª¿æŸ¥ Decontextualizationï¼‰
- **é©—è­‰**: æ–¹å‘åˆç†ã€‚

---

#### Bug #12: æ²»å®‰æ”¿ç­–æ²’æ‰¾åˆ°å¼µæ–‡äº‹ä»¶
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **é©—è­‰**: LLM-based query expansion æ–¹æ¡ˆåˆç†ã€‚

---

#### Bug #15: æŠ€è¡“å‹å·¥è‚¡ç¥¨æŸ¥è©¢
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦è£œå……
- **é©—è­‰**: éœ€å…ˆèª¿æŸ¥ Tier 6 stock API prompt å’Œ Analyst æ±ºç­–éç¨‹ã€‚

---

#### Bug #18-20: è¨˜è€…æ–‡ç« æœå°‹
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦è£œå……
- **é©—è­‰**: èˆ‡ Bug #11/#16 ç›¸åŒçš„ retriever æŠ½è±¡å±¤å•é¡Œã€‚æ‡‰ä¸€ä½µè¨­è¨ˆé€šç”¨ payload filter æ©Ÿåˆ¶ã€‚

---

#### Bug #21: æ·±åº¦ç ”ç©¶è¨˜è€…æŸ¥è©¢
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œï¼ˆä¾è³´ Bug #18-20ï¼‰
- **é©—è­‰**: ä¾è³´é—œä¿‚æ­£ç¢ºã€‚

---

### éºæ¼ç™¼ç¾

1. **Bug #22: è¨ˆç•«æŒ‡å®šçš„æ–¹æ³•åä¸å­˜åœ¨** â€” è¨ˆç•«å’Œ Agent #1 éƒ½æåˆ° `_citation_rules()` æ–¹æ³•ï¼Œä½† Agent #1 åœ¨ã€Œéºæ¼ç™¼ç¾ã€ä¸­å·²æŒ‡å‡ºæ­¤æ–¹æ³•ä¸å­˜åœ¨ã€‚Agent #2 ä¹Ÿç¢ºèªã€‚ä½†å…©ä½ Agent ä»å°‡æ­¤ bug æ¨™è¨˜ç‚º âœ… å¯è¡Œï¼Œæˆ‘èªç‚ºæ‡‰ç‚º âš ï¸ï¼Œå› ç‚ºä¿®æ”¹ä½ç½®æè¿°æœ‰èª¤ã€‚

2. **Bug #6: ã€Œè¿‘ä¸‰å¤©ã€ä¸åŒ¹é…ä»»ä½• pattern** â€” `past_x_days_zh` è¦æ±‚ `éå»` å‰ç¶´ï¼Œ`last_x_days_zh` è¦æ±‚ `æœ€è¿‘` å‰ç¶´ã€‚ä½¿ç”¨è€…å¸¸èªªã€Œè¿‘ä¸‰å¤©ã€ä½†ä¸æœƒåŒ¹é…åˆ°ä»»ä½• `_days_zh` æ¨¡å¼ã€‚é€™æ¯” months/years çš„å‰ç¶´å•é¡Œæ›´åš´é‡ï¼Œå› ç‚º days æ˜¯æœ€å¸¸ç”¨çš„æ™‚é–“ç¯„åœã€‚åŒæ¨£å•é¡Œä¹Ÿå½±éŸ¿ `_weeks_zh`ã€‚

3. **Bug #25: æ–¹æ¡ˆ A ä¿®æ­£å¾Œçš„ç©ºå­—ä¸²å•é¡Œ** â€” å³ä½¿å°‡ `max_cid` æ“´å¤§åˆ°è¦†è“‹ writer_citationsï¼Œè¶…å‡º source_map çš„ ID ä½ç½®ç‚ºç©ºå­—ä¸²ã€‚ä½†å‰ç«¯ line 1606 `if (url)` æœƒè·³éç©ºå­—ä¸²ï¼Œä¸æœƒå»ºç«‹é€£çµä¹Ÿä¸æœƒé¡¯ç¤ºç‚ºç‰¹æ®Šæ¨™è¨˜ã€‚å› æ­¤**æ–¹æ¡ˆ Cï¼ˆå‰ç«¯é™ç´šé¡¯ç¤ºï¼‰ä¸åƒ…æ˜¯ã€Œæœ€å¾Œé˜²ç·šã€ï¼Œè€Œæ˜¯ A æ–¹æ¡ˆçš„å¿…è¦è£œå……**ã€‚

4. **Bug #10: è¡Œè™Ÿåç§»** â€” å‰å…©è¼ª Agent å¼•ç”¨ line 1218 ä½œç‚º keydown handler ä½ç½®ï¼Œä½†ç›®å‰ç¨‹å¼ç¢¼ä¸­è©² handler åœ¨ line 1234ã€‚å»ºè­°ä¿®å¾©æ™‚ä»¥ `searchInput.addEventListener('keydown'` ä½œç‚ºå®šä½ä¾æ“šè€Œéè¡Œè™Ÿã€‚

5. **Bug #17: CSS `.collapsed` è¦å‰‡çš„ç§»é™¤æ˜¯å®‰å…¨çš„** â€” ç¢ºèª `news-search.css:775-777` çš„ `.kg-display-content.collapsed { display: none; }` åªåœ¨ KG toggle handler ä¸­ä½¿ç”¨ï¼ˆline 2407-2413 æ“ä½œæ­¤ classï¼‰ã€‚å¦‚æœæ”¹ç”¨ wrapper æ–¹æ¡ˆï¼Œæ­¤ CSS è¦å‰‡å’Œ toggle handler ä¸­çš„ class æ“ä½œéƒ½å¯ä»¥å®‰å…¨ç§»é™¤ã€‚

6. **Bug #23: `handlePostStreamingRequest` çš„ streaming read abort** â€” Free Conversation ä½¿ç”¨ `handlePostStreamingRequest()` (line 763)ï¼Œå…§éƒ¨ç”¨ `response.body.getReader()` åš streaming readã€‚åŠ å…¥ AbortController signal çµ¦ `fetch()` å¾Œï¼Œabort æ™‚ `response.body` æœƒè¢« cancelï¼Œ`reader.read()` æœƒ throw AbortErrorã€‚åªéœ€å‚³å…¥ signal å³å¯ï¼Œä¸éœ€é¡å¤–å‘¼å« `reader.cancel()`ã€‚

### æ–°å¢å»ºè­°

1. **Bug #17: çµ±ä¸€ç§»é™¤ `.collapsed` æ©Ÿåˆ¶** â€” æ¡ç”¨ wrapper æ–¹æ¡ˆå¾Œï¼Œtoggle handler ä¸å†éœ€è¦æ“ä½œ classï¼Œæ”¹ç‚ºæ“ä½œ wrapper çš„ `style.display`ã€‚å»ºè­°åŒæ™‚ï¼š
   - ç§»é™¤ CSS `.kg-display-content.collapsed` è¦å‰‡ (line 775-777)
   - ç§»é™¤ JS toggle handler ä¸­çš„ `classList.add/remove('collapsed')` é‚è¼¯ (line 2407-2414)
   - æ›¿æ›ç‚º wrapper `style.display` æ“ä½œ

2. **Bug #23: `handlePostStreamingRequest` å¢åŠ  signal åƒæ•¸** â€” ä¿®æ”¹å‡½æ•¸ç°½åï¼š
   ```javascript
   async function handlePostStreamingRequest(url, body, query, abortSignal = null) {
       const response = await fetch(url, {
           method: 'POST',
           headers: { 'Content-Type': 'application/json', 'Accept': 'text/event-stream' },
           body: JSON.stringify(body),
           signal: abortSignal  // æ–°å¢
       });
       // ... å…¶é¤˜ä¸è®Šï¼Œabort æ™‚ reader.read() æœƒè‡ªå‹• throw AbortError
   }
   ```

3. **å»ºè­°ä¿®å¾©é †åºï¼ˆåŸºæ–¼ä¸‰è¼ªé©—è­‰ï¼‰**ï¼š
   - **Phase 1ï¼ˆå¿«é€Ÿä¿®å¾©ï¼Œå¯ä¸€æ¬¡ PRï¼‰**: Bug #1, #3, #9, #24ï¼ˆæ•´åˆ 1: prompt ä¿®æ”¹ï¼‰+ Bug #10ï¼ˆIMEï¼‰+ Bug #13ï¼ˆprivate://ï¼‰
   - **Phase 2ï¼ˆå‰ç«¯è¤‡é›œä¿®æ”¹ï¼‰**: Bug #17ï¼ˆKG toggleï¼‰+ Bug #23ï¼ˆabort æ¶æ§‹ï¼‰
   - **Phase 3ï¼ˆå¾Œç«¯æ¶æ§‹ï¼‰**: Bug #11/#16 + Bug #18-20ï¼ˆretriever filter æ¶æ§‹ï¼‰
   - **Phase 4ï¼ˆåŠŸèƒ½å®Œå–„ï¼‰**: Bug #2ï¼ˆé‡˜é¸æ“´å±•ï¼‰+ Bug #6ï¼ˆä¸­æ–‡æ•¸å­—ï¼‰+ Bug #22 + #25ï¼ˆå¼•ç”¨ä¿®å¾©ï¼‰
   - **Phase 5ï¼ˆèª¿æŸ¥å¾Œä¿®å¾©ï¼‰**: Bug #7, #8, #12, #14, #15, #21

### è·¨ Bug æ•´åˆè©•ä¼°

1. **æ•´åˆ 1: Free Conversation Prompt å…¨é¢å‡ç´š** â€” âœ… ä¸‰è¼ªä¸€è‡´åŒæ„ã€‚Bug #1ï¼ˆæ—¥æœŸï¼‰+ #3ï¼ˆç³»çµ±é™åˆ¶ï¼‰+ #9ï¼ˆèƒ½åŠ›èªªæ˜ï¼‰+ #24ï¼ˆMarkdown æ ¼å¼ï¼‰ä¸€æ¬¡æ€§ä¿®æ”¹ `synthesize_free_conversation()`ã€‚åŒæ„ Agent #2 å»ºè­°å°‡ Bug #2 å¾Œç«¯éƒ¨åˆ†ä¹Ÿç´å…¥ã€‚

2. **æ•´åˆ 2: Retriever æ¶æ§‹å‡ç´š** â€” âš ï¸ ä¸‰è¼ªä¸€è‡´åŒæ„ Bug #17 ä¸å±¬æ–¼æ­¤æ•´åˆã€‚æ­£ç¢ºç¯„åœï¼šBug #11/#16ï¼ˆtime filterï¼‰+ Bug #18-20ï¼ˆauthor filterï¼‰ã€‚å»ºè­°è¨­è¨ˆé€šç”¨ `filters` åƒæ•¸ã€‚

3. **æ•´åˆ 3: å‰ç«¯è¼¸å…¥é«”é©—** â€” âœ… ä¸‰è¼ªä¸€è‡´åŒæ„ã€‚Bug #10ï¼ˆIMEï¼‰+ #23ï¼ˆabortï¼‰+ #2 å‰ç«¯éƒ¨åˆ† + Bug #17ï¼ˆKG toggleï¼‰ã€‚åŒæ„ Agent #2 å»ºè­°åŠ å…¥ Bug #13ï¼ˆprivate://ï¼Œæ”¹å‹•å°ï¼‰ã€‚

### æœ€çµ‚å»ºè­°

ç¶“éä¸‰è¼ªç¨ç«‹é©—è­‰ï¼Œæ‰€æœ‰ä¿®å¾©è¨ˆç•«çš„**æ–¹å‘éƒ½æ˜¯æ­£ç¢ºçš„**ï¼Œæ²’æœ‰ä»»ä½•è¨ˆç•«è¢«æ¨™è¨˜ç‚º âŒ æœ‰å•é¡Œã€‚ä¸»è¦å·®ç•°åœ¨æ–¼å¯¦ä½œç´°ç¯€çš„å®Œæ•´æ€§ã€‚

**Dev éœ€è¦åšå‡ºçš„æ±ºå®š**ï¼š
1. **Bug #17**: æ¡ç”¨ wrapper æ–¹æ¡ˆï¼ˆæ¨è–¦ï¼‰é‚„æ˜¯éæ­·å­å…ƒç´ æ–¹æ¡ˆï¼Ÿ
2. **Bug #6**: prefix æ˜¯å…¨éƒ¨çµ±ä¸€ï¼ˆAgent #1ï¼‰é‚„æ˜¯æŒ‰èªæ„åˆ†çµ„ï¼ˆAgent #2 + Agent #3 æ¨è–¦ï¼‰ï¼Ÿ
3. **Bug #11/#16**: ã€Œè¤‡ç”¨ reasoning temporal searchã€çš„ç†è§£ â€” å»ºè­°è¤‡ç”¨è§£æçµæœï¼Œretriever filter ç‚ºæ–°å¯¦ä½œ
4. **Bug #25**: æ–¹æ¡ˆ A + B + C ä¸‰ç®¡é½Šä¸‹æ˜¯å¦ OKï¼Ÿç‰¹åˆ¥æ˜¯æ–¹æ¡ˆ C éœ€è¦å‰ç«¯ä¿®æ”¹

**æœ€é«˜å„ªå…ˆå»ºè­°**ï¼šå…ˆåŸ·è¡Œ Phase 1ï¼ˆprompt ä¿®æ”¹ + IME + private://ï¼‰ï¼Œé€™äº›ä¿®æ”¹é¢¨éšªæœ€ä½ã€å½±éŸ¿æœ€å¤§ã€å¯å¿«é€Ÿå®Œæˆã€‚

---

*é©—è­‰å®Œæˆæ—¥æœŸï¼š2026-01-29*

---

## Agent é©—è­‰å ±å‘Š #4

> é©—è­‰æ—¥æœŸï¼š2026-01-29
> é©—è­‰è€…ï¼šClaude Code (Verification Agent #4)
> æ–¹æ³•ï¼šç¨ç«‹è®€å–ç¨‹å¼ç¢¼é©—è­‰ï¼Œèˆ‡ Agent #1ã€#2ã€#3 äº¤å‰æ¯”å°

### é©—è­‰çµ±è¨ˆ

| çµæœ | Bug æ•¸é‡ | Bug ç·¨è™Ÿ |
|------|---------|---------|
| âœ… ä¿®å¾©è¨ˆç•«å¯è¡Œ | 9 å€‹ | #1, #3, #9, #10, #13, #24, #4/#5, #7, #8, #12, #14, #21 |
| âš ï¸ è¨ˆç•«éœ€è¦è£œå…… | 9 å€‹ | #6, #11/#16, #17, #2, #22, #25, #23, #15, #18-20 |
| âŒ è¨ˆç•«æœ‰å•é¡Œ | 0 å€‹ | â€” |

### èˆ‡å‰ä¸‰è¼ª Agent çš„å·®ç•°

| Bug | Agent #1 | Agent #2 | Agent #3 | Agent #4ï¼ˆæœ¬å ±å‘Šï¼‰ | å·®ç•°èªªæ˜ |
|-----|----------|----------|----------|-------------------|---------|
| #22 | âœ… | âœ… | âš ï¸ | âš ï¸ **åŒæ„ #3** | `_citation_rules()` ä¸å­˜åœ¨ï¼ˆåƒ…åœ¨ archive doc ä¸­ï¼‰ã€‚éœ€æŒ‡å®š `build_compose_prompt()` line 198 å¾Œæ’å…¥ |
| #25 | âš ï¸ | âš ï¸ | âš ï¸ | âš ï¸ **å¼·åŒ– #3 çµè«–** | Plan A å–®ç¨å¯¦æ–½å°ç”¨æˆ¶**ç„¡å¯è¦‹æ•ˆæœ**ï¼ˆè¦‹éºæ¼ç™¼ç¾ #1ï¼‰ã€‚Plan C æ‰æ˜¯ç”¨æˆ¶ç«¯ä¿®å¾© |
| #17 | âš ï¸ æ“ä½œ container | âš ï¸ åå° #1ï¼Œæ”¯æŒ wrapper | âš ï¸ åŒæ„ #2ï¼Œæç¬¬ä¸‰æ–¹æ¡ˆ | âš ï¸ **åŒæ„ wrapperï¼Œå¦æ±ºç¬¬ä¸‰æ–¹æ¡ˆ** | ç¬¬ä¸‰æ–¹æ¡ˆå±•é–‹æ¢å¾©é‚è¼¯éæ–¼è¤‡é›œï¼Œä¸å€¼å¾—ç¯€çœä¸€å€‹ HTML div |
| #10 | âœ… line 1218 | âœ… line 1218 | âœ… line 1234 | âœ… **ç¢ºèª line 1234** | è¡Œè™Ÿå·²åç§»ã€‚æ‡‰ä»¥ `searchInput.addEventListener('keydown'` å®šä½ |

---

### çˆ­è­°è£æ±º

---

#### çˆ­è­° 1: Bug #17 (KG toggle) çš„ä¿®å¾©æ–¹æ¡ˆ

**è£æ±ºï¼šWrapper æ–¹æ¡ˆæœ€å„ªã€‚Agent #1 æ–¹æ¡ˆä¸å¯æ¡ç”¨ã€‚Agent #3 ç¬¬ä¸‰æ–¹æ¡ˆä¸æ¨è–¦ã€‚**

**æˆ‘çš„ç¨ç«‹é©—è­‰**ï¼š

è®€å– `news-search-prototype.html`ï¼ŒHTML çµæ§‹ç¢ºèªï¼š
```
kgDisplayContainer (div#kgDisplayContainer, line 369)
â”œâ”€â”€ kg-display-header (div)
â”‚   â”œâ”€â”€ kg-display-title
â”‚   â””â”€â”€ controls
â”‚       â”œâ”€â”€ kgViewToggle (div#kgViewToggle, line 324 area)
â”‚       â””â”€â”€ kgToggleButton (button#kgToggleButton, line 382)
â”œâ”€â”€ kgGraphView (div#kgGraphView, line 388)
â”œâ”€â”€ kgDisplayContent (div#kgDisplayContent, line 392)
â”œâ”€â”€ kgLegend (div#kgLegend, line 396)
â””â”€â”€ kgDisplayEmpty (div#kgDisplayEmpty, line 397)
```

Toggle handler (`news-search.js:2401-2417`)ï¼šåªæ“ä½œ `content.classList`ï¼ˆ`kgDisplayContent` çš„ `.collapsed`ï¼‰ã€‚

View toggle (`news-search.js:2026-2057`)ï¼šç”¨ inline `style.display = 'block'/'none'` åˆ‡æ› `graphView`/`listView`ã€‚

CSS (`news-search.css:775-777`)ï¼š`.kg-display-content.collapsed { display: none; }`ã€‚

**Agent #1 æ–¹æ¡ˆè‡´å‘½ç¼ºé™·**ï¼ˆå››è¼ªä¸€è‡´ï¼‰ï¼š
`kgToggleButton` åœ¨ `kgDisplayContainer` å…§éƒ¨ï¼Œéš±è— container æœƒéš±è—æŒ‰éˆ•ï¼Œä½¿ç”¨è€…ç„¡æ³•é‡æ–°å±•é–‹ã€‚

**Agent #3 ç¬¬ä¸‰æ–¹æ¡ˆï¼ˆéæ­·å­å…ƒç´ ï¼‰çš„å•é¡Œ**ï¼š
å±•é–‹æ™‚éœ€è¦æ ¹æ“šç•¶å‰ view mode æ¢å¾©å„å…ƒç´ çš„æ­£ç¢º `display` å€¼ï¼ˆgraph mode: graphView=block, listView=none; list mode: åä¹‹ï¼‰ã€‚è€Œ wrapper æ–¹æ¡ˆçš„å±•é–‹åªéœ€ `wrapper.style.display = ''`ï¼Œå­å…ƒç´ è‡ªå‹•æ¢å¾©å…ˆå‰çš„ inline style ç‹€æ…‹ã€‚ç¬¬ä¸‰æ–¹æ¡ˆç‚ºçœä¸€å€‹ HTML div è€Œå¢åŠ äº†ä¸å¿…è¦çš„ç‹€æ…‹æ¢å¾©è¤‡é›œåº¦ã€‚

**æœ€çµ‚å»ºè­°**ï¼šwrapper æ–¹æ¡ˆï¼ŒåŒ…å« 4 å€‹å­å…ƒç´ ï¼ˆkgGraphView, kgDisplayContent, kgLegend, kgDisplayEmptyï¼‰ï¼Œä¸å« headerã€‚

---

#### çˆ­è­° 2: Bug #6 prefix çµ±ä¸€ç­–ç•¥

**è£æ±ºï¼šåŒæ„ Agent #2 + #3 çš„èªæ„åˆ†çµ„æ–¹æ¡ˆã€‚**

**æˆ‘çš„ç¨ç«‹é©—è­‰**ï¼š

è®€å– `time_range_extractor.py:38-88`ï¼Œå„ pattern çš„ prefixï¼š
- `past_x_days_zh` (line 40): `éå»` â€” ç¼º `è¿‘`
- `last_x_days_zh` (line 41): `æœ€è¿‘` â€” ç¼º `è¿‘`
- `past_x_weeks_zh` (line 46): `éå»` â€” ç¼º `è¿‘`
- `last_x_weeks_zh` (line 47): `æœ€è¿‘` â€” ç¼º `è¿‘`
- `past_x_months_zh` (line 51): `éå»` â€” ç¼º `è¿‘`
- `last_x_months_zh` (line 52): `(?:è¿‘|æœ€è¿‘)` âœ…
- `past_x_years_zh` (line 56): `éå»` â€” ç¼º `è¿‘`
- `last_x_years_zh` (line 57): `(?:è¿‘|æœ€è¿‘)` âœ…

**èªæ„åˆ†çµ„æ–¹æ¡ˆ**ï¼ˆAgent #2 åŸå‰µï¼ŒAgent #3 + #4 æ”¯æŒï¼‰ï¼š
- `past_*_zh` ç³»åˆ— â†’ `(?:éå»|è¿‘)` â€” ã€Œéå»ã€å’Œã€Œè¿‘ã€éƒ½å¯åŒ¹é…
- `last_*_zh` ç³»åˆ— â†’ `(?:æœ€è¿‘|è¿‘)` â€” ã€Œæœ€è¿‘ã€å’Œã€Œè¿‘ã€éƒ½å¯åŒ¹é…

**ç†ç”±**ï¼š
1. ã€Œè¿‘ä¸‰å¤©ã€åœ¨ä¸­æ–‡ä¸­æ—¢å¯ç†è§£ç‚ºã€Œéå»ä¸‰å¤©ã€ä¹Ÿå¯ç†è§£ç‚ºã€Œæœ€è¿‘ä¸‰å¤©ã€ï¼Œå…©çµ„éƒ½æ‡‰åŒ¹é…
2. Agent #1 å»ºè­°å…¨éƒ¨çµ±ä¸€ç‚º `(?:è¿‘|æœ€è¿‘|éå»)`ï¼Œä½†é€™æœƒå°è‡´ `past_x_days_zh` åŒ¹é…ã€Œæœ€è¿‘3å¤©ã€å’Œ `last_x_days_zh` ä¹ŸåŒ¹é…ã€Œæœ€è¿‘3å¤©ã€ï¼Œå…©å€‹ pattern é‡è¤‡åŒ¹é…åŒä¸€è¡¨è¿°
3. èªæ„åˆ†çµ„ä¿æŒè¨­è¨ˆæ„åœ–ï¼š`past_` = ç¢ºå®šçš„éå»ï¼Œ`last_` = æœ€è¿‘/è¿‘æœŸ

---

#### çˆ­è­° 3: Bug #11/#16 ã€Œè¤‡ç”¨ã€çš„ç†è§£

**è£æ±ºï¼šåŒæ„ Agent #2 + #3ã€‚Reasoning module çš„ temporal search æ˜¯ prompt-level ç´„æŸï¼ŒRetriever éœ€å…¨æ–° filter å¯¦ä½œã€‚**

**æˆ‘çš„ç¨ç«‹é©—è­‰**ï¼š

è®€å– `reasoning/prompts/analyst.py:45-65`ï¼š
```python
if temporal_context:
    start_date = temporal_context.get('start', 'N/A')
    end_date = temporal_context.get('end', 'N/A')
    time_range = f"\n- Time Range: {start_date} to {end_date}"
```
é€™åªæ˜¯åœ¨ Analyst prompt ä¸­åŠ å…¥æ–‡å­— `"Time Range: X to Y"`ã€‚Analyst åœ¨ã€Œæ€è€ƒã€æ™‚æœƒè€ƒæ…®æ™‚é–“ï¼Œä½† Qdrant æŸ¥è©¢æœ¬èº«æ²’æœ‰ä»»ä½•æ™‚é–“éæ¿¾ã€‚

è®€å– `retriever.py:817-874`ï¼š`search()` æ–¹æ³•çš„ `**kwargs` å‚³éçµ¦ `client.search()`ï¼Œä½†ç›®å‰æ²’æœ‰ä»»ä½• caller å‚³å…¥æ™‚é–“ç›¸é—œåƒæ•¸ã€‚

**è¤‡ç”¨æ–¹æ¡ˆ**ï¼š
1. **å¯è¤‡ç”¨**ï¼š`time_range_extractor.py` çš„æ™‚é–“è§£æçµæœï¼ˆå·²å®Œæˆï¼Œç›´æ¥ç”¨ï¼‰
2. **ä¸å¯è¤‡ç”¨**ï¼šRetriever å±¤ Qdrant filterï¼ˆå…¨æ–°å¯¦ä½œï¼‰
3. **è³‡æ–™æµ**ï¼š`baseHandler.py` å–å¾— `temporal_range` â†’ è½‰ç‚ºé€šç”¨ filter dict â†’ å‚³çµ¦ `retriever.search(**kwargs)` â†’ å„ provider è½‰æ›ç‚ºè‡ªå·±çš„ filter æ ¼å¼

---

### å° Agent #3 ç¨ç‰¹ç™¼ç¾çš„å›æ‡‰

#### 1. Bug #22 å‡ç´šç‚º âš ï¸

**åŒæ„ Agent #3ã€‚** æˆ‘ç¨ç«‹æœå°‹äº† `_citation_rules`ï¼Œåªåœ¨ archive doc (`P1.1-extract-prompts-detailed.md`) ä¸­æ‰¾åˆ° `citation_rules()` éœæ…‹æ–¹æ³•çš„è¨­è¨ˆç¨¿ï¼Œ**å¯¦éš› `writer.py` ä¸­ä¸å­˜åœ¨æ­¤æ–¹æ³•**ã€‚

`build_compose_prompt()` (line 135-285) æ˜¯ä¸€å€‹å¤§å‹ f-stringï¼Œå¼•ç”¨ç™½åå–®åœ¨ line 196-198ï¼Œå¼•ç”¨ ID é™åˆ¶åœ¨ line 245-249ï¼Œä½†**å®Œå…¨æ²’æœ‰å¼•ç”¨èªæ³•é¢¨æ ¼æŒ‡å¼•**ã€‚æ­£ç¢ºæ’å…¥é»ï¼šline 198 (`{analyst_citations}`) ä¹‹å¾Œã€line 200 (`---`) ä¹‹å‰ã€‚

Agent #1 å’Œ #2 æ¨™è¨˜ âœ… æ™‚å¯èƒ½èªç‚ºã€Œæ–¹å‘æ­£ç¢ºå³å¯ã€ï¼Œä½†ä¿®æ”¹ä½ç½®éŒ¯èª¤æœƒå°è‡´é–‹ç™¼è€…åœ¨ä¸å­˜åœ¨çš„æ–¹æ³•ä¸­æµªè²»æ™‚é–“ï¼Œæ¨™è¨˜ âš ï¸ æ›´æº–ç¢ºã€‚

#### 2. Bug #6 ã€Œè¿‘ä¸‰å¤©ã€ä¸åŒ¹é…ä»»ä½• pattern

**åŒæ„ Agent #3ã€‚** æˆ‘çš„ç¨ç«‹é©—è­‰ï¼š
- `past_x_days_zh` (line 40): `r'éå»\s*(\d+)\s*å¤©'` â€” prefix æ˜¯ `éå»`ï¼Œä¸åŒ¹é…ã€Œè¿‘ã€
- `last_x_days_zh` (line 41): `r'æœ€è¿‘\s*(\d+)\s*å¤©'` â€” prefix æ˜¯ `æœ€è¿‘`ï¼Œä¸åŒ¹é…ã€Œè¿‘ã€

ã€Œè¿‘ä¸‰å¤©ã€ä¸­ã€Œè¿‘ã€â‰ ã€Œéå»ã€ä¹Ÿâ‰ ã€Œæœ€è¿‘ã€ï¼Œæ‰€ä»¥ä¸åŒ¹é…ä»»ä½• `_days_zh` patternã€‚åŒç†ã€Œè¿‘ä¸‰é€±ã€ä¹Ÿä¸åŒ¹é…ã€‚é€™æ˜¯ä¸€å€‹é«˜é »è¡¨è¿°çš„é‡è¦éºæ¼ã€‚

prefix çµ±ä¸€ä¿®å¾©ï¼ˆ`past_` â†’ `(?:éå»|è¿‘)`, `last_` â†’ `(?:æœ€è¿‘|è¿‘)`ï¼‰å¯ä»¥è§£æ±ºæ­¤å•é¡Œã€‚

#### 3. Bug #25 æ–¹æ¡ˆ C æ˜¯ A çš„å¿…è¦è£œå……

**åŒæ„ Agent #3ï¼Œä¸¦é€²ä¸€æ­¥å¼·åŒ–æ­¤çµè«–ã€‚** è¦‹éºæ¼ç™¼ç¾ #1 â€” Plan A å–®ç¨å¯¦æ–½å°ç”¨æˆ¶ç«¯**å®Œå…¨æ²’æœ‰å¯è¦‹æ•ˆæœ**ã€‚

#### 4. Bug #10 è¡Œè™Ÿåç§»

**ç¢ºèª Agent #3 æ­£ç¢ºã€‚** æˆ‘çš„æœå°‹çµæœï¼š`searchInput.addEventListener('keydown'` åœ¨ **line 1234**ï¼Œä¸æ˜¯å‰å…©è¼ªå¼•ç”¨çš„ line 1218ã€‚å»ºè­°ä¿®å¾©æ™‚ä»¥å‡½æ•¸å/é—œéµå­—å®šä½ï¼Œä¸ä¾è³´è¡Œè™Ÿã€‚

#### 5. Bug #17 ç¬¬ä¸‰æ–¹æ¡ˆï¼ˆéæ­·å­å…ƒç´ ï¼‰

**ä¸æ¨è–¦ã€‚** Wrapper æ–¹æ¡ˆæ›´ç©©å¥ã€‚ç†ç”±è¦‹çˆ­è­°è£æ±º #1ï¼šç¬¬ä¸‰æ–¹æ¡ˆçš„å±•é–‹æ¢å¾©é‚è¼¯éœ€è¦è¿½è¹¤ view mode ç‹€æ…‹ï¼Œè€Œ wrapper æ–¹æ¡ˆå±•é–‹æ™‚å­å…ƒç´ è‡ªå‹•æ¢å¾©ã€‚å·¥ç¨‹æˆæœ¬å·®ç•°ï¼ˆå¤šä¸€å€‹ HTML div vs è¤‡é›œçš„ç‹€æ…‹æ¢å¾©é‚è¼¯ï¼‰æ˜é¡¯ä¸åˆ’ç®—ã€‚

#### 6. Bug #23 `handlePostStreamingRequest` çš„ signal å‚³å…¥

**åŒæ„ Agent #3ã€‚** æˆ‘çš„ç¨ç«‹é©—è­‰ï¼š

`handlePostStreamingRequest()` (line 763-764)ï¼š
```javascript
const response = await fetch(url, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json', 'Accept': 'text/event-stream' },
    body: JSON.stringify(body)
    // â† æ²’æœ‰ signal
});
const reader = response.body.getReader();
while (true) {
    const { done, value } = await reader.read();
    // ...
}
```

åŠ å…¥ `signal` å¾Œï¼Œabort æ™‚ `fetch` æœƒ rejectï¼ˆæˆ–å¦‚æœå·²æ‹¿åˆ° responseï¼Œ`response.body` è¢« cancelï¼‰ï¼Œ`reader.read()` è‡ªå‹• throw `AbortError`ã€‚ä¸éœ€è¦é¡å¤–å‘¼å« `reader.cancel()`ã€‚é€™æ˜¯ Fetch API + ReadableStream çš„æ¨™æº–è¡Œç‚ºã€‚

---

### å››è¼ªé©—è­‰å…±è­˜

ä»¥ä¸‹æ˜¯å››å€‹ Agent éƒ½åŒæ„çš„çµè«–ï¼š

1. **Bug #1 âœ…**ï¼šä¸‰å€‹ prompt è®Šé«”ï¼ˆ`has_research_report` line 633ã€`has_cached_articles` line 648ã€`else` line 674ï¼‰å‡ç„¡æ—¥æœŸæ³¨å…¥ã€‚ä¿®å¾©è¨ˆç•«æ­£ç¢ºã€‚
2. **Bug #6 âš ï¸**ï¼š8 å€‹ `_zh` regex å…¨ç”¨ `(\d+)` ç„¡æ³•åŒ¹é…ä¸­æ–‡æ•¸å­—ã€‚prefix ä¸ä¸€è‡´ï¼ˆåªæœ‰ months/years çš„ `last_*_zh` æœ‰ `è¿‘`ï¼‰ã€‚ã€Œè¿‘ä¸‰å¤©ã€ã€Œè¿‘ä¸‰é€±ã€ç„¡æ³•åŒ¹é…ä»»ä½• patternï¼ˆAgent #3 é¦–æ¬¡ç™¼ç¾ï¼ŒAgent #4 ç¢ºèªï¼‰ã€‚
3. **Bug #10 âœ…**ï¼šLine 1234 çš„ keydown handler ç¼ºå°‘ `!e.isComposing`ã€‚æœå°‹å’Œ FC å…±ç”¨åŒä¸€å€‹ `searchInput`ï¼ˆAgent #2 ç™¼ç¾ï¼ŒAgent #3 + #4 ç¢ºèªï¼‰ã€‚è¡Œè™Ÿå¾ 1218 åç§»è‡³ 1234ï¼ˆAgent #3 ç™¼ç¾ï¼ŒAgent #4 ç¢ºèªï¼‰ã€‚
4. **Bug #11/#16 âš ï¸**ï¼š`retriever.py:search()` å®Œå…¨ç„¡æ™‚é–“éæ¿¾ã€‚Reasoning module çš„ temporal search æ˜¯ prompt-level ç´„æŸï¼ˆ`analyst.py:47-50`ï¼‰ï¼Œä¸æ˜¯ retriever-level filterã€‚éœ€æ–°å»º retriever filterã€‚
5. **Bug #13 âœ…**ï¼š`addCitationLinks()` (line 1596-1618) è™•ç† `urn:llm:knowledge:` å’Œä¸€èˆ¬ URLï¼Œä½†ç„¡ `private://` è™•ç†ã€‚
6. **Bug #17 âš ï¸**ï¼šToggle handler (line 2401-2417) åªæ“ä½œ `kgDisplayContent.classList`ã€‚View toggle (line 2026-2057) ç”¨ inline `style.display`ã€‚Wrapper æ–¹æ¡ˆæ­£ç¢ºä¸”å¿…é ˆåŒ…å« `kgDisplayEmpty`ã€‚Agent #1 çš„ container æ–¹æ¡ˆä¸å¯æ¡ç”¨ï¼ˆå››è¼ªä¸€è‡´ï¼‰ã€‚
7. **Bug #22 âš ï¸**ï¼šWriter prompt ç„¡å¼•ç”¨èªæ³•é¢¨æ ¼æŒ‡å¼•ã€‚`_citation_rules()` æ–¹æ³•ä¸å­˜åœ¨ï¼ˆAgent #3 é¦–æ¬¡æå‡ºï¼ŒAgent #4 ç¢ºèªï¼‰ã€‚
8. **Bug #25 âš ï¸**ï¼š`source_urls` é•·åº¦ç”± `source_map.keys()` çš„ max æ±ºå®š (line 1115)ï¼Œä¸è¦†è“‹ Writer è¶…å‡ºç¯„åœçš„å¼•ç”¨ã€‚Plan C æ˜¯å¿…è¦çš„ç”¨æˆ¶ç«¯ä¿®å¾©ï¼ˆAgent #3 é¦–æ¬¡å¼·èª¿ï¼ŒAgent #4 é€²ä¸€æ­¥é©—è­‰ï¼‰ã€‚
9. **Bug #2 âš ï¸**ï¼š`togglePinNewsCard(url, title)` åªå­˜ `{ url, title, pinnedAt }` (line 2770-2773)ã€‚POST body (line 2455-2476) ç„¡ `pinned_articles` æ¬„ä½ã€‚
10. **Bug #23 âš ï¸**ï¼šæœå°‹æœ‰å®Œæ•´ abort åŸºç¤è¨­æ–½ï¼ˆline 68-69 æ¨¡çµ„ç´šè®Šæ•¸ + line 1242 `cancelActiveSearch()`ï¼‰ã€‚Deep Research `EventSource` æ˜¯å±€éƒ¨ `const` (line 1529)ã€‚Free Conversation `fetch` ç„¡ `signal` (line 764)ã€‚
11. **Bug #3, #9, #24 âœ…**ï¼šPrompt ä¿®æ”¹æ–¹æ¡ˆæ­£ç¢ºã€‚
12. **æ•´åˆ 2 æœ‰èª¤**ï¼šBug #17 ä¸å±¬æ–¼ Retriever æ¶æ§‹å‡ç´šï¼ˆå››è¼ªä¸€è‡´ï¼‰ã€‚

### ä»æœ‰åˆ†æ­§çš„é …ç›®

| é …ç›® | åˆ†æ­§ | å››è¼ªæŠ•ç¥¨ | å»ºè­° |
|------|------|---------|------|
| Bug #17 ä¿®å¾©æ–¹æ¡ˆ | wrapper vs éæ­·å­å…ƒç´  | wrapper: #2 + #3 + #4 = 3ç¥¨ / éæ­·: #3 å‚™é¸ = 0ç¥¨ | **Wrapper æ–¹æ¡ˆï¼ˆä¸‰ç¥¨å„ªå‹¢ï¼‰** |
| Bug #6 prefix çµ±ä¸€ | å…¨éƒ¨çµ±ä¸€ vs èªæ„åˆ†çµ„ | å…¨éƒ¨çµ±ä¸€: #1 = 1ç¥¨ / èªæ„åˆ†çµ„: #2 + #3 + #4 = 3ç¥¨ | **èªæ„åˆ†çµ„ï¼ˆä¸‰ç¥¨å„ªå‹¢ï¼‰** |
| Bug #22 åˆ†é¡ | âœ… å¯è¡Œ vs âš ï¸ éœ€è£œå…… | âœ…: #1 + #2 = 2ç¥¨ / âš ï¸: #3 + #4 = 2ç¥¨ | **å¹³ç¥¨ã€‚å»ºè­° Dev ä»¥ âš ï¸ ç‚ºæº–ï¼Œå› ç‚ºä¿®æ”¹ä½ç½®æœ‰èª¤** |

### é€é …é©—è­‰

---

#### Bug #1: æ—¥æœŸè¬Šç¨±å•é¡Œ
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨ç«‹é©—è­‰**: è®€å– `generate_answer.py:631-686`ã€‚ä¸‰å€‹ prompt è®Šé«”ï¼š
  - `has_research_report` (line 633): ã€Œä½ æ˜¯ä¸€å€‹å°ˆæ¥­çš„å°ç£æ–°èåˆ†æåŠ©æ‰‹ã€â€” ç„¡æ—¥æœŸ
  - `has_cached_articles` (line 648): ã€ŒYou are an AI assistant helping with Taiwan news analysisã€â€” ç„¡æ—¥æœŸ
  - `else` (line 674): ã€ŒYou are an AI assistant helping with questions about Taiwan newsã€â€” ç„¡æ—¥æœŸ
- **å››è¼ªä¸€è‡´**: æ˜¯ã€‚ä¿®å¾©è¨ˆç•«æ­£ç¢ºã€‚

---

#### Bug #6: æ™‚é–“ç¯„åœè¨ˆç®—éŒ¯èª¤
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦è£œå……
- **ç¨ç«‹é©—è­‰**: è®€å– `time_range_extractor.py:38-88` (regex) å’Œ `:189-221` (parse logic)ã€‚
  - 8 å€‹ `_zh` regex å…¨éƒ¨ç”¨ `(\d+)` â† ç¢ºèª
  - Prefix ä¸ä¸€è‡´ â† ç¢ºèªï¼ˆè¦‹çˆ­è­°è£æ±º #2ï¼‰
  - è§£æé‚è¼¯ (lines 196/202/209/217): å…¨ç”¨ `int(match.group(1))` â† ç¢ºèª
- **è£œå……**:
  1. åŒæ„ Agent #1: `parse_number()` éœ€æ”¯æ´çµ„åˆæ•¸å­—ï¼ˆåäº”=15, äºŒå=20 ç­‰ï¼‰ï¼Œè¨ˆç•«çš„ dict åªåˆ° 'åäºŒ' ä¸è¶³
  2. åŒæ„ Agent #2 + #3 çš„èªæ„åˆ†çµ„ prefix ç­–ç•¥
  3. åŒæ„ Agent #3: ã€Œè¿‘ä¸‰å¤©ã€ä¸åŒ¹é…ä»»ä½• `_days_zh` patternï¼Œä¿®å¾© prefix å¯è§£æ±º

---

#### Bug #10: Mac è¼¸å…¥æ³• Enter å•é¡Œ
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨ç«‹é©—è­‰**: æœå°‹ `news-search.js` ä¸­æ‰€æœ‰ `keydown` handlerï¼š
  - Line 379: `document.addEventListener('keydown')` â€” ESC é—œé–‰ historyï¼Œä¸æ¶‰åŠ Enter
  - **Line 1234**: `searchInput.addEventListener('keydown')` â€” `if (e.key === 'Enter' && !e.shiftKey)` â€” **ç¼ºå°‘ `!e.isComposing`**
  - Line 4123: rename input â€” Enter è§¸ç™¼ blur
  - Line 4443: folder rename input â€” Enter è§¸ç™¼ blur
- **å››è¼ªä¸€è‡´**: è¡Œè™Ÿç‚º 1234ï¼ˆé 1218ï¼‰ã€‚ä¿®å¾©ä¸€è™•å³è¦†è“‹æœå°‹å’Œ FC å…©å€‹æ¨¡å¼ã€‚

---

#### Bug #11 + #16: æ™‚é–“éæ¿¾ç¼ºå¤±
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦å¯¦è³ªè£œå……
- **ç¨ç«‹é©—è­‰**: è®€å– `retriever.py:817-874`ã€‚
  - `search()` æ–¹æ³•ç°½å: `async def search(self, query, site, num_results=50, endpoint_name=None, **kwargs)` (line 817-818)
  - å®Œå…¨ç„¡ time filtering â€” åªåš endpoint parallel query + aggregate + deduplicate
  - `**kwargs` å‚³éçµ¦ `client.search()`ï¼Œå¯ä½œç‚º filter å‚³å…¥ç®¡é“
- **Reasoning temporal search é©—è­‰**: `analyst.py:47-50` åƒ…æ³¨å…¥æ–‡å­— `"Time Range: X to Y"` åˆ° prompt â€” prompt-level only
- **åŒæ„ Agent #2 + #3**: Retriever filter æ˜¯å…¨æ–°å¯¦ä½œï¼Œå¯è¤‡ç”¨ `time_range_extractor.py` çš„è§£æçµæœ

---

#### Bug #13: å¼•ç”¨é€£çµ private:// å•é¡Œ
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨ç«‹é©—è­‰**: è®€å– `news-search.js:1596-1618` `addCitationLinks()` å‡½æ•¸ï¼š
  - Line 1602: regex `/\[(\d+)\]/g`
  - Line 1604: bounds check `index >= 0 && index < sources.length`
  - Line 1606: `if (url)` â€” ç©ºå­—ä¸²è·³é
  - Line 1608: `urn:llm:knowledge:` â†’ `[N]<sup>AI</sup>`
  - Line 1614: ä¸€èˆ¬ URL â†’ `<a>` é€£çµ
  - Line 1617: `return match` â€” out of range æˆ– URL ç‚ºç©ºæ™‚è¿”å›åŸæ–‡
  - **ç„¡ `private://` è™•ç†** â† ç¢ºèª
- **å››è¼ªä¸€è‡´**: åœ¨ line 1612 (`urn` è™•ç†çš„ `}` ä¹‹å¾Œ) åŠ å…¥ `private://` æª¢æŸ¥ã€‚

---

#### Bug #17: çŸ¥è­˜åœ–è­œæ”¶ä¸èµ·ä¾†
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦è£œå……ï¼ˆè¦‹çˆ­è­°è£æ±º #1ï¼‰
- **ç¨ç«‹é©—è­‰**:
  - HTML çµæ§‹: `kgDisplayContainer` (369) åŒ…å« header (å« toggleButton 382)ã€kgGraphView (388)ã€kgDisplayContent (392)ã€kgLegend (396)ã€kgDisplayEmpty (397)
  - Toggle handler (`news-search.js:2401-2417`): åªæ“ä½œ `content.classList`ï¼ˆ`.collapsed`ï¼‰ï¼Œä¸å½±éŸ¿ `kgGraphView` â† åœ–å½¢æ¨¡å¼ä¸‹ toggle ç„¡æ•ˆ
  - View toggle (`news-search.js:2042-2051`): `graphView.style.display = 'block'` / `listView.style.display = 'none'` â† inline style å„ªå…ˆç´šé«˜æ–¼ `.collapsed` class
  - CSS (`news-search.css:775-777`): `.kg-display-content.collapsed { display: none; }` ç¢ºèªå­˜åœ¨
- **ä¿®å¾©å»ºè­°**: Wrapper æ–¹æ¡ˆï¼ŒåŒ…å« kgGraphView + kgDisplayContent + kgLegend + kgDisplayEmpty

---

#### Bug #22: å¼•ç”¨æ ¼å¼ä¸é€šé †
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦è£œå……
- **ç¨ç«‹é©—è­‰**: è®€å– `writer.py:135-285` `build_compose_prompt()` æ–¹æ³•ï¼š
  - Line 196-198: å¼•ç”¨ç™½åå–®ç´„æŸï¼ˆåš´ç¦ç„¡ä¸­ç”Ÿæœ‰ + `{analyst_citations}`ï¼‰
  - Line 245-249: `sources_used` å¿…é ˆæ˜¯ `analyst_citations` å­é›†
  - **ç„¡ä»»ä½•å¼•ç”¨ã€Œèªæ³•é¢¨æ ¼ã€æˆ–ã€Œèªæ³•æ ¼å¼ã€æŒ‡å¼•** â† ç¢ºèª
- **è¨ˆç•«å•é¡Œ**: ä¿®æ”¹ä½ç½®å¯« `_citation_rules()` æˆ–é¡ä¼¼æ–¹æ³•ã€‚ç¨ç«‹æœå°‹çµæœï¼šæ­¤æ–¹æ³•åœ¨æ•´å€‹ codebase ä¸­**ä¸å­˜åœ¨**ï¼Œåƒ…åœ¨ archive doc (`P1.1-extract-prompts-detailed.md`) ä¸­æœ‰è¨­è¨ˆç¨¿ã€‚
- **æ­£ç¢ºåšæ³•**: åœ¨ `build_compose_prompt()` çš„ f-string ä¸­ï¼Œline 198 (`{analyst_citations}`) ä¹‹å¾Œã€line 200 (`---`) ä¹‹å‰æ’å…¥å¼•ç”¨èªæ³•é¢¨æ ¼æŒ‡å¼•ã€‚

---

#### Bug #25: å¼•ç”¨æ•¸å­—å¤ªå¤§æ²’æœ‰è¶…é€£çµ
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦è£œå……
- **ç¨ç«‹é©—è­‰**: è®€å– `orchestrator.py:1111-1139`ï¼š
  - Line 1115: `max_cid = max(self.source_map.keys()) if self.source_map else 0`
  - Line 1116: `writer_citations = final_report.sources_used`
  - Line 1121: `for cid in range(1, max_cid + 1)` â€” åªå»ºåˆ° source_map çš„æœ€å¤§ key
  - å‰ç«¯ `addCitationLinks()` (JS line 1604): `index >= 0 && index < sources.length` + line 1606 `if (url)` â€” è¶…å‡ºé•·åº¦æˆ–ç©ºå­—ä¸²éƒ½è¿”å›åŸæ–‡
- **æ ¹å› ç¢ºèª**: å››è¼ªä¸€è‡´ã€‚source_urls ä¸è¦†è“‹ Writer è¶…å‡ºç¯„åœçš„å¼•ç”¨ã€‚
- **Plan A æ•ˆæœåˆ†æ**: è¦‹éºæ¼ç™¼ç¾ #1ã€‚Plan A å–®ç¨å¯¦æ–½å°ç”¨æˆ¶ç«¯ç„¡å¯è¦‹æ•ˆæœã€‚
- **æ¨è–¦**: Aï¼ˆå¾Œç«¯è¨ºæ–·ï¼‰+ Bï¼ˆprompt ç´„æŸï¼‰+ Cï¼ˆå‰ç«¯é™ç´šé¡¯ç¤ºï¼‰ä¸‰ç®¡é½Šä¸‹ï¼Œå…¶ä¸­ **C æ˜¯å”¯ä¸€ç”¨æˆ¶å¯è¦‹çš„ä¿®å¾©**ã€‚

---

#### Bug #2: Free Conversation åªç”¨å‰ 10 å€‹ Cache çµæœ
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦å¯¦è³ªè£œå……
- **ç¨ç«‹é©—è­‰**:
  - `togglePinNewsCard(url, title)` (line 2757): åªæ¥æ”¶ 2 å€‹åƒæ•¸
  - `pinnedNewsCards.push({ url, title, pinnedAt: Date.now() })` (line 2770-2773): **ç„¡ description**
  - å‘¼å«è™• (line 2836): `togglePinNewsCard(news.url, news.title)` â€” ä¹Ÿåªå‚³ 2 å€‹åƒæ•¸
  - POST body (line 2455-2476): `{ query, site, generate_mode, streaming, free_conversation, session_id, conversation_id, prev }` + å¯é¸çš„ `research_report`, `include_private_sources`, `user_id` â€” **ç„¡ pinned_articles æ¬„ä½**
- **å››è¼ªä¸€è‡´**: é‡˜é¸è³‡æ–™çµæ§‹éœ€æ“´å±•ï¼ˆåŠ  descriptionï¼‰ï¼ŒPOST å”è­°éœ€å¢åŠ  `pinned_articles` æ¬„ä½ã€‚

---

#### Bug #23: æš«åœå°è©±æŒ‰éˆ•ç¼ºå¤±
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦å¯¦è³ªè£œå……
- **ç¨ç«‹é©—è­‰**:

| æ¨¡å¼ | å»ºç«‹æ–¹å¼ | æ¨¡çµ„ç´šå¼•ç”¨ | abort æ©Ÿåˆ¶ | ç¾ç‹€ |
|------|---------|-----------|-----------|------|
| **æœå°‹** | EventSource (line 689) â†’ å­˜å…¥ `currentSearchEventSource` (line 690) | âœ… line 68-69 | âœ… `cancelActiveSearch()` (line 1242) | âœ… å®Œæ•´ |
| **Deep Research** | `const eventSource = new EventSource(...)` (line 1529) | âŒ å±€éƒ¨ `const` è®Šæ•¸ | âŒ ç„¡å¤–éƒ¨ abort | âŒ å®Œå…¨ç„¡æ³• abort |
| **Free Conversation** | `fetch()` via `handlePostStreamingRequest()` (line 764) | âŒ ç„¡ AbortController | âŒ fetch ç„¡ signal | âŒ å®Œå…¨ç„¡æ³• abort |

- **è¨ˆç•«ä¿®æ­£**: Step 1 ä¸æ‡‰èªªã€Œå°‡ EventSource å’Œ AbortController å­˜ç‚ºæ¨¡çµ„ç´šè®Šæ•¸ã€ï¼ˆæœå°‹çš„å·²ç¶“æ˜¯ï¼‰ï¼Œè€Œæ‡‰æ˜ç¢ºï¼š
  - æœå°‹ï¼šå¾©ç”¨ `cancelActiveSearch()`
  - Deep Researchï¼šæ–°å¢ `let currentDeepResearchEventSource = null`
  - Free Conversationï¼šæ–°å¢ `let currentFreeConvAbortController = null` + ä¿®æ”¹ `handlePostStreamingRequest()` ç°½ååŠ å…¥ `signal` åƒæ•¸

---

#### Bug #3: åˆç†åŒ–éŒ¯èª¤ç­”æ¡ˆ
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨ç«‹é©—è­‰**: åŒ Bug #1 ä½ç½®ï¼Œprompt ä¸­ç„¡ç³»çµ±é™åˆ¶èªªæ˜ã€‚
- **å››è¼ªä¸€è‡´**: æ˜¯ã€‚

---

#### Bug #4 + #5: æ·±åº¦ç ”ç©¶æ­§ç¾©æª¢æ¸¬
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **é©—è­‰**: å‰ç«¯ clarification é¸é …éœ€åŠ å…¥è‡ªç”±æ–‡å­—è¼¸å…¥å’Œã€Œæ²’æœ‰ã€æŒ‰éˆ•ï¼Œæ–¹å‘åˆç†ã€‚

---

#### Bug #9: ç„¡æ³•å­˜å–å³æ™‚æ–°è
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨ç«‹é©—è­‰**: åŒ Bug #1 ä½ç½®ï¼Œprompt ä¸­ç„¡ç³»çµ±èƒ½åŠ›èªªæ˜ã€‚

---

#### Bug #24: å›è¦†æ²’æœ‰æ’ç‰ˆæ›è¡Œ
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨ç«‹é©—è­‰**: ä¸‰å€‹ prompt è®Šé«”å‡æœªç³»çµ±æ€§è¦æ±‚ Markdown æ ¼å¼ã€‚`has_cached_articles` æœ‰ `**ç²—é«”**` ç¤ºä¾‹ä½†ä¸æ˜¯æ ¼å¼è¦æ±‚ã€‚

---

#### Bug #14: æ‘˜è¦å›é¥‹æŒ‰éˆ•
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œï¼ˆéœ€ /planï¼‰
- **é©—è­‰**: åˆæ­¥æ–¹å‘åˆç†ã€‚

---

#### Bug #7: ç¼ºå°‘ç´«è‰²è™›ç·šæ¨™è¨˜
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œï¼ˆéœ€èª¿æŸ¥ï¼‰
- **é©—è­‰**: èª¿æŸ¥æ–¹å‘æ­£ç¢ºã€‚

---

#### Bug #8: æ²’æœ‰çœŸçš„åˆ—å‡º 12 æœˆåå¤§æ–°è
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œï¼ˆåŠŸèƒ½é™åˆ¶ï¼Œéœ€èª¿æŸ¥ï¼‰
- **é©—è­‰**: Decontextualization èª¿æŸ¥æ–¹å‘åˆç†ã€‚

---

#### Bug #12: æ²»å®‰æ”¿ç­–æ²’æ‰¾åˆ°å¼µæ–‡äº‹ä»¶
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **é©—è­‰**: LLM-based query expansion æ–¹æ¡ˆåˆç†ã€‚

---

#### Bug #15: æŠ€è¡“å‹å·¥è‚¡ç¥¨æŸ¥è©¢
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦è£œå……
- **é©—è­‰**: éœ€å…ˆèª¿æŸ¥ Tier 6 stock API prompt å’Œ Analyst æ±ºç­–éç¨‹ã€‚

---

#### Bug #18-20: è¨˜è€…æ–‡ç« æœå°‹
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦è£œå……
- **é©—è­‰**: èˆ‡ Bug #11/#16 ç›¸åŒçš„ retriever æŠ½è±¡å±¤å•é¡Œã€‚æ‡‰ä¸€ä½µè¨­è¨ˆé€šç”¨ payload filter æ©Ÿåˆ¶ï¼ˆ`filters` åƒæ•¸ï¼‰ï¼Œæ¶µè“‹æ™‚é–“å’Œä½œè€…ã€‚

---

#### Bug #21: æ·±åº¦ç ”ç©¶è¨˜è€…æŸ¥è©¢
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œï¼ˆä¾è³´ Bug #18-20ï¼‰
- **é©—è­‰**: ä¾è³´é—œä¿‚æ­£ç¢ºã€‚

---

### éºæ¼ç™¼ç¾

1. **Bug #25: Plan A å–®ç¨å¯¦æ–½å°ç”¨æˆ¶ç«¯ç„¡å¯è¦‹æ•ˆæœ**

   é€™æ˜¯å››è¼ªä¸­é¦–æ¬¡æ˜ç¢ºæŒ‡å‡ºçš„ã€‚å‰ä¸‰è¼ªéƒ½èªªã€ŒPlan C æ˜¯ Plan A çš„å¿…è¦è£œå……ã€ï¼Œä½†æ²’æœ‰è§£é‡‹**ç‚ºä»€éº¼**æ˜¯å¿…è¦çš„ã€‚æˆ‘çš„åˆ†æï¼š

   **ä¸åš Plan A æ™‚**ï¼šwriter å¼•ç”¨ `[15]`ï¼Œ`source_urls` é•·åº¦ 10 â†’ å‰ç«¯ `index=14 >= sources.length=10` â†’ `return match` â†’ é¡¯ç¤ºç´”æ–‡å­— `[15]`

   **åšäº† Plan Aï¼ˆæ“´å¤§ max_cidï¼‰ä½†ä¸åš Plan C æ™‚**ï¼šwriter å¼•ç”¨ `[15]`ï¼Œ`source_urls` é•·åº¦ 15ï¼Œä½† `sources[14] = ""` â†’ å‰ç«¯ `index=14 < sources.length=15` â†’ `if (url)` â†’ `""` æ˜¯ falsy â†’ è·³åˆ° `return match` â†’ é¡¯ç¤ºç´”æ–‡å­— `[15]`

   **çµæœå®Œå…¨ç›¸åŒ**ã€‚Plan A çš„ä½œç”¨æ˜¯å¾Œç«¯ loggingï¼ˆå¯ä»¥ç²¾ç¢º log å“ªäº› citation ID è¶…å‡º source_mapï¼‰ï¼Œä¸æ˜¯ç”¨æˆ¶ç«¯ä¿®å¾©ã€‚**Plan C æ‰æ˜¯å”¯ä¸€æœƒæ”¹è®Šç”¨æˆ¶é«”é©—çš„ä¿®å¾©**ã€‚

   å»ºè­°ï¼šPlan Aï¼ˆå¾Œç«¯è¨ºæ–·ï¼‰ + Plan Bï¼ˆprompt é é˜²ï¼‰ + Plan Cï¼ˆå‰ç«¯é™ç´šé¡¯ç¤ºï¼‰ä¸‰è€…ç¼ºä¸€ä¸å¯ï¼Œä½†å¯¦ä½œå„ªå…ˆé †åºæ‡‰ç‚º **C > B > A**ã€‚

2. **Bug #17: æ¡ç”¨ wrapper å¾Œæ‡‰æ¸…ç†èˆŠçš„ `.collapsed` æ©Ÿåˆ¶**

   åŒæ„ Agent #3 éºæ¼ç™¼ç¾ #5ï¼š
   - CSS `.kg-display-content.collapsed { display: none; }` (line 775-777) å¯å®‰å…¨ç§»é™¤
   - JS toggle handler ä¸­çš„ `classList.add/remove('collapsed')` (line 2407-2414) æ‡‰æ›¿æ›ç‚º wrapper `style.display` æ“ä½œ
   - ç¢ºèª `.collapsed` class åªåœ¨ KG toggle ä¸­ä½¿ç”¨ï¼Œç§»é™¤ä¸å½±éŸ¿å…¶ä»–åŠŸèƒ½

3. **Bug #6: `parse_number()` çš„è¨ˆç•«éœ€è¦æ›´å®Œæ•´çš„ä¸­æ–‡æ•¸å­—è§£æ**

   å››è¼ªå…±è­˜å·²æŒ‡å‡ºéœ€è¦çµ„åˆæ•¸å­—æ”¯æ´ï¼ˆåäº”=15, äºŒå=20ï¼‰ã€‚è£œå……ä¸€å€‹è¼•é‡å¯¦ä½œæ–¹æ¡ˆï¼š
   ```python
   def parse_number(s):
       """è§£æé˜¿æ‹‰ä¼¯æ•¸å­—æˆ–ä¸­æ–‡æ•¸å­—ï¼ˆå«çµ„åˆï¼‰"""
       if s.isdigit():
           return int(s)
       simple = {'ä¸€':1, 'äºŒ':2, 'å…©':2, 'ä¸‰':3, 'å››':4, 'äº”':5,
                 'å…­':6, 'ä¸ƒ':7, 'å…«':8, 'ä¹':9, 'å':10}
       if s in simple:
           return simple[s]
       # çµ„åˆæ•¸å­—ï¼šåX = 10+X, Xå = X*10, XåY = X*10+Y
       if 'å' in s:
           parts = s.split('å')
           tens = simple.get(parts[0], 1) if parts[0] else 1
           ones = simple.get(parts[1], 0) if len(parts) > 1 and parts[1] else 0
           return tens * 10 + ones
       return int(s)  # fallback
   ```
   æ¯”å¼•å…¥ `cn2an` å¤–éƒ¨å¥—ä»¶æ›´è¼•é‡ã€‚

4. **Bug #23: UI ç‹€æ…‹æ©Ÿéœ€è¦è€ƒæ…®è·¨æ¨¡å¼ abort**

   è¨ˆç•«æè¿°äº†ä¸‰æ…‹ï¼ˆé–’ç½®/è™•ç†ä¸­/abortï¼‰ï¼Œä½†æ²’æœ‰è™•ç†ç”¨æˆ¶åœ¨ã€Œè™•ç†ä¸­ã€ç‹€æ…‹ä¸‹**åˆ‡æ›æ¨¡å¼**çš„å ´æ™¯ã€‚ä¾‹å¦‚ï¼šDeep Research æ­£åœ¨è·‘ â†’ ç”¨æˆ¶é»æœå°‹ â†’ æœå°‹çš„ `cancelActiveSearch()` (line 1260) å–æ¶ˆèˆŠæœå°‹ï¼Œä½†ä¸æœƒå–æ¶ˆæ­£åœ¨è·‘çš„ Deep Research EventSourceã€‚å»ºè­°å»ºç«‹çµ±ä¸€çš„ `cancelAllActiveRequests()` å‡½æ•¸ï¼Œåœ¨ä»»ä½•æ–°æ“ä½œé–‹å§‹å‰å‘¼å«ã€‚

### æ–°å¢å»ºè­°

1. **Bug #25 å¯¦ä½œå„ªå…ˆé †åºèª¿æ•´**ï¼šCï¼ˆå‰ç«¯é™ç´šé¡¯ç¤ºï¼‰> Bï¼ˆprompt ç´„æŸï¼‰> Aï¼ˆå¾Œç«¯ max_cid æ“´å¤§ï¼‰ã€‚ç†ç”±ï¼šC æ˜¯å”¯ä¸€ç”¨æˆ¶å¯è¦‹çš„ä¿®å¾©ï¼ŒB å¾æºé ­æ¸›å°‘å•é¡Œï¼ŒA åªæ˜¯å¾Œç«¯è¨ºæ–·ã€‚

2. **Bug #23 çµ±ä¸€ abort å‡½æ•¸**ï¼š
   ```javascript
   function cancelAllActiveRequests() {
       cancelActiveSearch();  // å·²æœ‰
       if (currentDeepResearchEventSource) {
           currentDeepResearchEventSource.close();
           currentDeepResearchEventSource = null;
       }
       if (currentFreeConvAbortController) {
           currentFreeConvAbortController.abort();
           currentFreeConvAbortController = null;
       }
   }
   ```
   åœ¨ä»»ä½•æ–°æ“ä½œé–‹å§‹å‰å‘¼å«æ­¤å‡½æ•¸ã€‚

3. **ä¿®å¾©é †åºå»ºè­°ï¼ˆåŸºæ–¼å››è¼ªé©—è­‰ï¼‰**ï¼š
   - **Phase 1ï¼ˆå¿«é€Ÿä¿®å¾©ï¼Œä¸€æ¬¡ PRï¼‰**: Bug #1 + #3 + #9 + #24ï¼ˆæ•´åˆ 1: prompt ä¿®æ”¹ï¼‰+ Bug #10ï¼ˆIMEï¼‰+ Bug #13ï¼ˆprivate://ï¼‰
   - **Phase 2ï¼ˆå‰ç«¯è¤‡é›œä¿®æ”¹ï¼‰**: Bug #17ï¼ˆKG toggle wrapperï¼‰+ Bug #23ï¼ˆabort æ¶æ§‹ï¼‰+ Bug #22 + #25ï¼ˆå¼•ç”¨ä¿®å¾©ï¼ŒC å„ªå…ˆï¼‰
   - **Phase 3ï¼ˆå¾Œç«¯æ¶æ§‹ï¼‰**: Bug #11/#16 + Bug #18-20ï¼ˆretriever filter é€šç”¨æ¶æ§‹ï¼‰+ Bug #6ï¼ˆä¸­æ–‡æ•¸å­—ï¼‰
   - **Phase 4ï¼ˆåŠŸèƒ½å®Œå–„ï¼‰**: Bug #2ï¼ˆé‡˜é¸æ“´å±•ï¼‰
   - **Phase 5ï¼ˆèª¿æŸ¥å¾Œä¿®å¾©ï¼‰**: Bug #7, #8, #12, #14, #15, #21

### è·¨ Bug æ•´åˆè©•ä¼°

1. **æ•´åˆ 1: Free Conversation Prompt å…¨é¢å‡ç´š** â€” âœ… å››è¼ªä¸€è‡´ã€‚Bug #1 + #3 + #9 + #24 ä¸€æ¬¡æ€§ä¿®æ”¹ `synthesize_free_conversation()`ã€‚

2. **æ•´åˆ 2: Retriever æ¶æ§‹å‡ç´š** â€” âš ï¸ å››è¼ªä¸€è‡´ï¼šBug #17 ä¸å±¬æ–¼æ­¤æ•´åˆã€‚æ­£ç¢ºç¯„åœï¼šBug #11/#16ï¼ˆtime filterï¼‰+ Bug #18-20ï¼ˆauthor filterï¼‰ã€‚è¨­è¨ˆé€šç”¨ `filters` åƒæ•¸ã€‚

3. **æ•´åˆ 3: å‰ç«¯è¼¸å…¥é«”é©—** â€” âœ… å››è¼ªä¸€è‡´ã€‚Bug #10ï¼ˆIMEï¼‰+ #23ï¼ˆabortï¼‰+ #2 å‰ç«¯éƒ¨åˆ† + Bug #13ï¼ˆprivate://ï¼‰+ Bug #17ï¼ˆKG toggleï¼‰ã€‚

### æœ€çµ‚å»ºè­°

ç¶“éå››è¼ªç¨ç«‹é©—è­‰ï¼Œæ‰€æœ‰ä¿®å¾©è¨ˆç•«çš„**æ–¹å‘éƒ½æ˜¯æ­£ç¢ºçš„**ï¼Œæ²’æœ‰ä»»ä½•è¨ˆç•«è¢«æ¨™è¨˜ç‚º âŒã€‚

**å››è¼ªå…±è­˜çš„æ˜ç¢ºçµè«–**ï¼š
1. **Bug #17**: æ¡ç”¨ **wrapper æ–¹æ¡ˆ**ï¼ˆ3:0 æ”¯æŒï¼Œæ’é™¤ Agent #1 çš„ container æ–¹æ¡ˆï¼‰
2. **Bug #6 prefix**: æ¡ç”¨**èªæ„åˆ†çµ„**ï¼ˆ3:1ï¼ŒAgent #2 + #3 + #4 æ”¯æŒï¼‰
3. **Bug #11/#16**: è¤‡ç”¨ `time_range_extractor.py` è§£æçµæœï¼Œretriever filter ç‚º**æ–°å¯¦ä½œ**ï¼ˆ4:0ï¼‰
4. **Bug #25**: **ä¸‰ç®¡é½Šä¸‹ï¼ˆA+B+Cï¼‰**ï¼Œä½† C æ˜¯å”¯ä¸€ç”¨æˆ¶å¯è¦‹ä¿®å¾©ï¼Œå„ªå…ˆå¯¦æ–½ï¼ˆ4:0ï¼‰
5. **Bug #22**: ä¿®æ”¹ä½ç½®æ‡‰ç‚º `build_compose_prompt()` line 198 å¾Œï¼Œé `_citation_rules()`ï¼ˆ4:0 åŒæ„æ–¹æ³•ä¸å­˜åœ¨ï¼‰

**Dev éœ€è¦åšå‡ºçš„å”¯ä¸€æ±ºå®š**ï¼š
- Bug #22 åˆ†é¡ï¼šâœ… å¯è¡Œï¼ˆAgent #1 + #2ï¼‰vs âš ï¸ éœ€è£œå……ï¼ˆAgent #3 + #4ï¼‰â€” å¹³ç¥¨

**æœ€é«˜å„ªå…ˆå»ºè­°**ï¼šPhase 1ï¼ˆprompt ä¿®æ”¹ + IME + private://ï¼‰é¢¨éšªæœ€ä½ã€å½±éŸ¿æœ€å¤§ï¼Œå»ºè­°ç«‹å³åŸ·è¡Œã€‚

---

*é©—è­‰å®Œæˆæ—¥æœŸï¼š2026-01-29*

---

## Agent é©—è­‰å ±å‘Š #5

> é©—è­‰æ—¥æœŸï¼š2026-01-29
> é©—è­‰è€…ï¼šClaude Code (Verification Agent #5)
> æ–¹æ³•ï¼šç¨ç«‹è®€å–ç¨‹å¼ç¢¼é©—è­‰ï¼Œèˆ‡ Agent #1ã€#2ã€#3ã€#4 äº¤å‰æ¯”å°

### é©—è­‰çµ±è¨ˆ

| çµæœ | Bug æ•¸é‡ | Bug ç·¨è™Ÿ |
|------|---------|---------|
| âœ… ä¿®å¾©è¨ˆç•«å¯è¡Œ | 9 å€‹ | #1, #3, #9, #10, #13, #24, #4/#5, #7, #8, #12, #14, #21 |
| âš ï¸ è¨ˆç•«éœ€è¦è£œå…… | 9 å€‹ | #6, #11/#16, #17, #2, #22, #25, #23, #15, #18-20 |
| âŒ è¨ˆç•«æœ‰å•é¡Œ | 0 å€‹ | â€” |

### èˆ‡å‰å››è¼ª Agent çš„å·®ç•°

| Bug | Agent #1 | Agent #2 | Agent #3 | Agent #4 | Agent #5ï¼ˆæœ¬å ±å‘Šï¼‰ | å·®ç•°èªªæ˜ |
|-----|----------|----------|----------|----------|-------------------|---------|
| #22 | âœ… | âœ… | âš ï¸ | âš ï¸ | âš ï¸ **æ‰“ç ´å¹³å±€** | `_citation_rules()` ä¸å­˜åœ¨ï¼Œç¢ºèªã€‚å¦æå‡ºï¼šå¼•ç”¨èªæ³•é¢¨æ ¼æŒ‡å¼•æ‡‰æ’å…¥ã€Œè¼¸å‡ºè¦æ±‚ã€å€æ®µï¼ˆline 245-249 é™„è¿‘ï¼‰ï¼Œè€Œé Agent #3/#4 å»ºè­°çš„ line 198 å¾Œ |
| #25 | âš ï¸ | âš ï¸ | âš ï¸ | âš ï¸ | âš ï¸ **åŒæ„ #4 å¼·åŒ–çµè«–** | Plan A å–®ç¨å¯¦æ–½å°ç”¨æˆ¶ç«¯ç„¡å¯è¦‹æ•ˆæœï¼Œç¨ç«‹é©—è­‰ç¢ºèª |
| #17 | âš ï¸ æ“ä½œ container | âš ï¸ wrapper | âš ï¸ wrapper + ç¬¬ä¸‰æ–¹æ¡ˆ | âš ï¸ wrapper | âš ï¸ **wrapperï¼ˆ4:0 å®šè«–ï¼‰** | ç¨ç«‹ç¢ºèª wrapper æ˜¯å”¯ä¸€åˆç†æ–¹æ¡ˆ |
| #10 | âœ… line 1218 | âœ… line 1218 | âœ… line 1234 | âœ… line 1234 | âœ… **line 1235** | å‰å››è¼ªè¡Œè™Ÿå‡ä¸ç²¾ç¢ºï¼šline 1234 æ˜¯ click handlerï¼Œkeydown handler åœ¨ line 1235 |

---

### çˆ­è­°è£æ±º

---

#### çˆ­è­° 1: Bug #22 åˆ†é¡ â€” æ±ºå®šæ€§ç¬¬äº”ç¥¨

**è£æ±ºï¼šâš ï¸ éœ€è¦è£œå……ã€‚æœ€çµ‚æ¯”åˆ† 3:2ï¼ˆAgent #3 + #4 + #5 vs Agent #1 + #2ï¼‰ã€‚**

**æˆ‘çš„ç¨ç«‹é©—è­‰**ï¼š

1. æœå°‹ `_citation_rules` â€” æ•´å€‹ `writer.py` ä¸­ä¸å­˜åœ¨æ­¤æ–¹æ³•ã€‚åƒ…åœ¨ archive æ–‡ä»¶ `P1.1-extract-prompts-detailed.md` ä¸­æœ‰è¨­è¨ˆç¨¿ã€‚**ç¢ºèª Agent #3 + #4 çµè«–ã€‚**

2. `build_compose_prompt()` (line 135-285) æ˜¯ä¸€å€‹å¤§å‹ f-stringï¼š
   - Line 194-198: å¼•ç”¨ç™½åå–®ï¼ˆã€Œåš´ç¦ç„¡ä¸­ç”Ÿæœ‰ã€+ `{analyst_citations}`ï¼‰
   - Line 245-249: `sources_used` å¿…é ˆæ˜¯ç™½åå–®å­é›†
   - **å®Œå…¨æ²’æœ‰å¼•ç”¨ã€Œèªæ³•é¢¨æ ¼ã€æŒ‡å¼•**

3. **æ¨™è¨˜ âš ï¸ çš„ç†ç”±**ï¼šå¦‚æœé–‹ç™¼è€…æŒ‰åŸè¨ˆç•«æ‰¾ `_citation_rules()` æ–¹æ³•ï¼Œæœƒæµªè²»æ™‚é–“ã€‚é€™æ˜¯ä¸€å€‹å¯¦è³ªæ€§çš„ä¿®æ”¹ä½ç½®éŒ¯èª¤ï¼Œä¸åªæ˜¯ã€Œæ–¹å‘æ­£ç¢ºã€çš„å•é¡Œã€‚

**æ–°è§€é» â€” æ’å…¥ä½ç½®å»ºè­°**ï¼š

Agent #3 å’Œ #4 å»ºè­°æ’å…¥ line 198 å¾Œï¼ˆå¼•ç”¨ç™½åå–®å€æ®µï¼‰ã€‚ä½†æˆ‘èªç‚ºæ›´åˆé©çš„ä½ç½®æ˜¯ **line 249 é™„è¿‘**ï¼ˆã€ŒSources Used é™åˆ¶ã€å€æ®µä¹‹å¾Œï¼‰ï¼Œç†ç”±ï¼š

- Line 194-198 æ˜¯ **è¼¸å…¥è³‡æ–™** å€æ®µ â€” å‘Šè¨´ LLM ã€Œå“ªäº›å¼•ç”¨å¯ç”¨ã€
- Line 245-249 æ˜¯ **è¼¸å‡ºè¦æ±‚** å€æ®µ â€” å‘Šè¨´ LLM ã€Œå¦‚ä½•ä½¿ç”¨å¼•ç”¨ã€
- å¼•ç”¨èªæ³•é¢¨æ ¼æ˜¯ã€Œå¦‚ä½•å¯«å¼•ç”¨ã€çš„å•é¡Œï¼Œå±¬æ–¼è¼¸å‡ºè¦æ±‚ï¼Œèˆ‡ Sources Used é™åˆ¶æ”¾åœ¨ä¸€èµ·æ›´èªæ„é€£è²«

å»ºè­°åœ¨ line 249ï¼ˆSources Used é™åˆ¶çš„æœ€å¾Œä¸€è¡Œ `âŒ éŒ¯èª¤ï¼š...ï¼ˆ5 ä¸åœ¨ç™½åå–®ä¸­ï¼‰`ï¼‰ä¹‹å¾ŒåŠ å…¥ï¼š

```
### å¼•ç”¨èªæ³•é¢¨æ ¼

å¼•ç”¨æ¨™è¨˜ [N] æ‡‰è‡ªç„¶åµŒå…¥å¥å­ä¸­ï¼Œä¸è¦è®“å¼•ç”¨ç ´å£é–±è®€æµæš¢æ€§ã€‚

âœ… æ­£ç¢ºç¯„ä¾‹ï¼š
- ã€Œå°ç©é›»è‚¡åƒ¹ä¸Šæ¼² 3%[1]ã€‚ã€
- ã€Œæ ¹æ“šå ±å°[1]ï¼Œå°ç©é›»è‚¡åƒ¹ä¸Šæ¼² 3%ã€‚ã€

âŒ éŒ¯èª¤ç¯„ä¾‹ï¼ˆçµ•å°ç¦æ­¢ï¼‰ï¼š
- ã€Œæ ¹æ“šå ±å°ï¼Œåœ¨[1]ä¸­æåˆ°ï¼Œå°ç©é›»è‚¡åƒ¹ä¸Šæ¼² 3%ã€‚ã€
- ã€Œåœ¨[1]å ±å°ä¸­ï¼Œæåˆ°å°ç©é›»è‚¡åƒ¹ä¸Šæ¼² 3%ã€‚ã€

åŸå‰‡ï¼šå¼•ç”¨æ¨™è¨˜æ”¾åœ¨å¥æœ«æˆ–ç·Šè·Ÿåœ¨ä¾†æºæè¿°ä¹‹å¾Œï¼Œä¸è¦æ‹†é–‹å¥å­ã€‚
```

---

#### çˆ­è­° 2: Bug #6 prefix çµ±ä¸€ç­–ç•¥

**è£æ±ºï¼šåŒæ„èªæ„åˆ†çµ„æ–¹æ¡ˆã€‚æœ€çµ‚æ¯”åˆ† 4:1ï¼ˆAgent #2 + #3 + #4 + #5 vs Agent #1ï¼‰ã€‚**

**æˆ‘çš„ç¨ç«‹é©—è­‰**ï¼š

è®€å– `time_range_extractor.py:38-88`ï¼Œ8 å€‹ `_zh` pattern çš„ prefixï¼š

| Pattern | ç¾æœ‰ prefix | ç¼ºå¤± |
|---------|------------|------|
| `past_x_days_zh` (40) | `éå»` | ç¼º `è¿‘` |
| `last_x_days_zh` (41) | `æœ€è¿‘` | ç¼º `è¿‘` |
| `past_x_weeks_zh` (46) | `éå»` | ç¼º `è¿‘` |
| `last_x_weeks_zh` (47) | `æœ€è¿‘` | ç¼º `è¿‘` |
| `past_x_months_zh` (51) | `éå»` | ç¼º `è¿‘` |
| `last_x_months_zh` (52) | `(?:è¿‘\|æœ€è¿‘)` | âœ… |
| `past_x_years_zh` (56) | `éå»` | ç¼º `è¿‘` |
| `last_x_years_zh` (57) | `(?:è¿‘\|æœ€è¿‘)` | âœ… |

èªæ„åˆ†çµ„ä¿®å¾©ï¼š
- `past_*_zh` ç³»åˆ— â†’ `(?:éå»|è¿‘)` â€” ã€Œè¿‘ã€ä¹Ÿå¯è¡¨é”ã€Œéå»ã€èªæ„
- `last_*_zh` ç³»åˆ— â†’ `(?:æœ€è¿‘|è¿‘)` â€” ã€Œè¿‘ã€ä¹Ÿå¯è¡¨é”ã€Œæœ€è¿‘ã€èªæ„

é€™æ¯” Agent #1 çš„ã€Œå…¨éƒ¨çµ±ä¸€ç‚º `(?:è¿‘|æœ€è¿‘|éå»)`ã€æ›´å¥½ï¼Œå› ç‚ºå…¨éƒ¨çµ±ä¸€æœƒå°è‡´ `past_x_days_zh` å’Œ `last_x_days_zh` éƒ½åŒ¹é…ã€Œæœ€è¿‘3å¤©ã€ï¼Œé€ æˆé‡è¤‡åŒ¹é…å•é¡Œã€‚

---

#### çˆ­è­° 3: Bug #17 ä¿®å¾©æ–¹æ¡ˆ

**è£æ±ºï¼šWrapper æ–¹æ¡ˆã€‚æœ€çµ‚æ¯”åˆ† 4:0ï¼ˆAgent #2 + #3 + #4 + #5ï¼Œæ’é™¤ Agent #1 çš„ container æ–¹æ¡ˆï¼‰ã€‚**

**æˆ‘çš„ç¨ç«‹é©—è­‰**ï¼š

HTML çµæ§‹ï¼ˆ`news-search-prototype.html`ï¼‰ï¼š
```
kgDisplayContainer (line 369)
â”œâ”€â”€ kg-display-header (line 370)
â”‚   â”œâ”€â”€ kg-display-title (line 371)
â”‚   â””â”€â”€ controls (line 376)
â”‚       â”œâ”€â”€ kgViewToggle (line 378) â€” åœ–å½¢/åˆ—è¡¨åˆ‡æ›
â”‚       â””â”€â”€ kgToggleButton (line 382) â€” æ”¶èµ·/å±•é–‹æŒ‰éˆ•
â”œâ”€â”€ kgGraphView (line 388) â€” åœ–å½¢è¦–åœ–
â”œâ”€â”€ kgDisplayContent (line 392) â€” åˆ—è¡¨è¦–åœ–ï¼ˆåˆå§‹ display:noneï¼‰
â”œâ”€â”€ kgLegend (line 396) â€” åœ–ä¾‹
â””â”€â”€ kgDisplayEmpty (line 397) â€” ç©ºç‹€æ…‹
```

Toggle handler (`news-search.js:2407-2417`)ï¼š
```javascript
content.classList.contains('collapsed')
    ? content.classList.remove('collapsed') + icon='â–¼'
    : content.classList.add('collapsed') + icon='â–¶'
```
åªæ“ä½œ `kgDisplayContent` çš„ `.collapsed` classã€‚

View toggle (`news-search.js:2043-2052`)ï¼š
```javascript
graphView.style.display = 'block' / listView.style.display = 'none'  // åœ–å½¢æ¨¡å¼
graphView.style.display = 'none'  / listView.style.display = 'block' // åˆ—è¡¨æ¨¡å¼
```
ä½¿ç”¨ inline `style.display`ã€‚

CSS (`news-search.css:775-777`)ï¼š`.kg-display-content.collapsed { display: none; }`

**å•é¡Œç¢ºèª**ï¼š
1. **åœ–å½¢æ¨¡å¼**: Toggle æ“ä½œå·² `display:none` çš„ `kgDisplayContent`ï¼Œ`kgGraphView` ä¸å—å½±éŸ¿ â†’ toggle ç„¡æ•ˆ
2. **åˆ—è¡¨æ¨¡å¼**: Inline `style.display: block`ï¼ˆJS è¨­å®šï¼‰å„ªå…ˆç´š > `.collapsed { display: none }`ï¼ˆCSS classï¼‰â†’ toggle ç„¡æ•ˆ

**Agent #1 æ–¹æ¡ˆè‡´å‘½ç¼ºé™·**ï¼š`kgToggleButton` åœ¨ `kgDisplayContainer` å…§éƒ¨ï¼ˆline 382ï¼‰ï¼Œéš±è— container æœƒéš±è—æŒ‰éˆ•æœ¬èº«ã€‚

**Wrapper æ–¹æ¡ˆæ­£ç¢ºæ€§**ï¼šæ–°å¢ `<div id="kgContentWrapper">` åŒ…è£ kgGraphView + kgDisplayContent + kgLegend + kgDisplayEmptyï¼ˆä¸å« headerï¼‰ï¼Œtoggle æ“ä½œ `wrapper.style.display`ã€‚å±•é–‹æ™‚ `wrapper.style.display = ''`ï¼Œå­å…ƒç´ è‡ªå‹•æ¢å¾©å…ˆå‰çš„ inline styleã€‚

---

### å° Agent #4 ç¨ç‰¹ç™¼ç¾çš„å›æ‡‰

#### 1. Bug #25 Plan A ç„¡å¯è¦‹æ•ˆæœ

**åŒæ„ã€‚æˆ‘çš„ç¨ç«‹é©—è­‰å®Œå…¨ç¢ºèªæ­¤çµè«–ã€‚**

ä»£ç¢¼è¿½è¹¤ï¼š

**ä¸åš Plan A æ™‚**ï¼š
- Writer å¼•ç”¨ `[15]`
- `source_urls` é•·åº¦ 10ï¼ˆç”± `max(source_map.keys())` æ±ºå®šï¼Œline 1115ï¼‰
- å‰ç«¯ï¼š`index = 14 >= sources.length = 10` â†’ bounds check å¤±æ•— â†’ `return match` â†’ ç´”æ–‡å­— `[15]`

**åšäº† Plan Aï¼ˆæ“´å¤§ max_cidï¼‰ä½†ä¸åš Plan C**ï¼š
- `source_urls` é•·åº¦ 15ï¼Œä½† `sources[14] = ""`ï¼ˆcid=15 ä¸åœ¨ source_map â†’ å¡«ç©ºå­—ä¸²ï¼Œline 1136ï¼‰
- å‰ç«¯ï¼š`index = 14 < 15` â†’ bounds check é€šé â†’ `url = ""` â†’ `if (url)` â†’ `""` æ˜¯ falsy â†’ è·³é â†’ `return match` â†’ ç´”æ–‡å­— `[15]`

**çµæœå®Œå…¨ç›¸åŒ**ã€‚å…©æ¢ä»£ç¢¼è·¯å¾‘éƒ½åˆ°é” line 1618 çš„ `return match`ã€‚Plan A çš„å”¯ä¸€åƒ¹å€¼æ˜¯å¾Œç«¯ loggingï¼ˆline 1137 çš„ warningï¼‰ã€‚

#### 2. Bug #17 å¦æ±º Agent #3 ç¬¬ä¸‰æ–¹æ¡ˆï¼ˆéæ­·å­å…ƒç´ ï¼‰

**åŒæ„ã€‚** Wrapper æ–¹æ¡ˆåœ¨å±•é–‹æ™‚åªéœ€ `wrapper.style.display = ''`ï¼Œå­å…ƒç´ è‡ªå‹•æ¢å¾©å„è‡ªçš„ inline styleï¼ˆç”± view toggle è¨­å®šçš„ `block`/`none`ï¼‰ã€‚ç¬¬ä¸‰æ–¹æ¡ˆéœ€è¦è¿½è¹¤ç•¶å‰ view mode ä¾†æ±ºå®šæ¢å¾© graphView é‚„æ˜¯ listView çš„ display å€¼ï¼Œå¢åŠ ä¸å¿…è¦çš„ç‹€æ…‹ç®¡ç†è¤‡é›œåº¦ã€‚

#### 3. Bug #23 è·¨æ¨¡å¼ abort éºæ¼

**åŒæ„ã€‚æˆ‘çš„ç¨ç«‹é©—è­‰ç¢ºèªã€‚**

ä»£ç¢¼è¿½è¹¤ï¼š
- `performSearch()` (line 1261)ï¼š`cancelActiveSearch()` â†’ åªå–æ¶ˆ `currentSearchAbortController` å’Œ `currentSearchEventSource`
- Deep Research EventSource (line 1530)ï¼š`const eventSource` â€” å±€éƒ¨è®Šæ•¸ï¼Œç„¡æ³•å¾å¤–éƒ¨å­˜å–
- å ´æ™¯ï¼šDR æ­£åœ¨åŸ·è¡Œ â†’ ç”¨æˆ¶åˆ‡æ›åˆ°æœå°‹æ¨¡å¼ â†’ `cancelActiveSearch()` ä¸æœƒè§¸åŠ DR EventSource â†’ DR ç¹¼çºŒåœ¨èƒŒæ™¯æ¶ˆè€—ä¼ºæœå™¨è³‡æº

`cancelAllActiveRequests()` çµ±ä¸€å‡½æ•¸æ˜¯æ­£ç¢ºçš„è§£æ±ºæ–¹æ¡ˆã€‚

#### 4. Bug #6 parse_number() è¼•é‡å¯¦ä½œ

**åŒæ„ã€‚** Agent #4 çš„ `split('å')` æ–¹æ¡ˆæ­£ç¢ºè™•ç†æ‰€æœ‰å¸¸è¦‹ä¸­æ–‡æ•¸å­—ï¼š

| è¼¸å…¥ | split('å') | çµæœ |
|------|------------|------|
| åäº” | ['', 'äº”'] | 1Ã—10 + 5 = 15 âœ… |
| äºŒå | ['äºŒ', ''] | 2Ã—10 + 0 = 20 âœ… |
| äºŒåäº” | ['äºŒ', 'äº”'] | 2Ã—10 + 5 = 25 âœ… |
| ä¸‰å | ['ä¸‰', ''] | 3Ã—10 + 0 = 30 âœ… |
| å | ç›´æ¥æŸ¥è¡¨ | 10 âœ… |

æ–°èæœå°‹æ™‚é–“ç¯„åœçš„å¯¦éš›éœ€æ±‚ï¼ˆ1-30å¤©ã€1-12é€±ã€1-24æœˆã€1-10å¹´ï¼‰å…¨éƒ¨åœ¨æ­¤å‡½æ•¸è¦†è“‹ç¯„åœå…§ã€‚ç„¡éœ€å¼•å…¥ `cn2an` å¤–éƒ¨å¥—ä»¶ã€‚

---

### äº”è¼ªé©—è­‰å…±è­˜

ä»¥ä¸‹æ˜¯äº”å€‹ Agent å…¨éƒ¨åŒæ„çš„çµè«–ï¼ˆ5:0ï¼‰ï¼š

1. **Bug #1 âœ…**ï¼šä¸‰å€‹ prompt è®Šé«”ï¼ˆ`has_research_report` line 631ã€`has_cached_articles` line 647ã€`else` line 672ï¼‰å‡ç„¡æ—¥æœŸæ³¨å…¥ã€‚ä¿®å¾©è¨ˆç•«æ­£ç¢ºã€‚
2. **Bug #6 âš ï¸**ï¼š8 å€‹ `_zh` regex å…¨ç”¨ `(\d+)` ç„¡æ³•åŒ¹é…ä¸­æ–‡æ•¸å­—ã€‚prefix ä¸ä¸€è‡´ã€‚ã€Œè¿‘ä¸‰å¤©ã€ä¸åŒ¹é…ä»»ä½• `_days_zh` patternã€‚`parse_number()` éœ€æ”¯æ´çµ„åˆæ•¸å­—ã€‚
3. **Bug #10 âœ…**ï¼šæœå°‹/FC å…±ç”¨çš„ keydown handler ç¼ºå°‘ `!e.isComposing`ã€‚
4. **Bug #11/#16 âš ï¸**ï¼š`retriever.py:search()` å®Œå…¨ç„¡æ™‚é–“éæ¿¾ã€‚Reasoning module çš„ temporal search æ˜¯ prompt-level ç´„æŸï¼ˆ`analyst.py:47-50`ï¼‰ï¼Œä¸æ˜¯ retriever-level filterã€‚
5. **Bug #13 âœ…**ï¼š`addCitationLinks()` ç„¡ `private://` è™•ç†ã€‚åœ¨ `urn:llm:knowledge:` ä¹‹å¾ŒåŠ å…¥å³å¯ã€‚
6. **Bug #17 âš ï¸**ï¼šWrapper æ–¹æ¡ˆæ˜¯å”¯ä¸€æ­£ç¢ºæ–¹æ¡ˆï¼ˆ4:0ï¼Œæ’é™¤ Agent #1ï¼‰ã€‚å¿…é ˆåŒ…å« kgDisplayEmptyã€‚Agent #1 çš„ container æ–¹æ¡ˆå› æœƒéš±è— toggle button è€Œä¸å¯æ¡ç”¨ã€‚
7. **Bug #22 âš ï¸ï¼ˆ3:2 è£æ±ºï¼‰**ï¼š`_citation_rules()` ä¸å­˜åœ¨ã€‚ä¿®æ”¹ä½ç½®æ‡‰åœ¨ `build_compose_prompt()` çš„ f-string ä¸­ã€‚
8. **Bug #25 âš ï¸**ï¼šPlan A å–®ç¨å¯¦æ–½å°ç”¨æˆ¶ç«¯ç„¡å¯è¦‹æ•ˆæœã€‚Plan C æ˜¯å”¯ä¸€ç”¨æˆ¶å¯è¦‹ä¿®å¾©ã€‚A+B+C ä¸‰ç®¡é½Šä¸‹ï¼Œå„ªå…ˆé †åº C>B>Aã€‚
9. **Bug #2 âš ï¸**ï¼š`pinnedNewsCards` åªå­˜ `{ url, title, pinnedAt }`ï¼Œç„¡ descriptionã€‚POST body ç„¡ `pinned_articles` æ¬„ä½ã€‚
10. **Bug #23 âš ï¸**ï¼šæœå°‹æœ‰å®Œæ•´ abortã€‚DR EventSource æ˜¯å±€éƒ¨è®Šæ•¸ã€‚FC fetch ç„¡ signalã€‚éœ€çµ±ä¸€ abortã€‚
11. **Bug #3, #9, #24 âœ…**ï¼šPrompt ä¿®æ”¹æ–¹æ¡ˆæ­£ç¢ºã€‚
12. **æ•´åˆ 2 æœ‰èª¤**ï¼šBug #17 ä¸å±¬æ–¼ Retriever æ¶æ§‹å‡ç´šï¼ˆäº”è¼ªä¸€è‡´ï¼‰ã€‚

### ä»æœ‰åˆ†æ­§çš„é …ç›®

**äº”è¼ªé©—è­‰å¾Œï¼Œæ‰€æœ‰é‡å¤§åˆ†æ­§å·²è§£æ±ºã€‚**

| é …ç›® | æœ€çµ‚è£æ±º | ç¥¨æ•¸ | èªªæ˜ |
|------|---------|------|------|
| Bug #22 åˆ†é¡ | âš ï¸ éœ€è£œå…… | 3:2 | Agent #5 æ‰“ç ´å¹³å±€ã€‚`_citation_rules()` ä¸å­˜åœ¨æ˜¯äº‹å¯¦ï¼Œæ¨™è¨˜ âš ï¸ æ›´æº–ç¢º |
| Bug #6 prefix | èªæ„åˆ†çµ„ | 4:1 | å…±è­˜ç©©å›º |
| Bug #17 æ–¹æ¡ˆ | Wrapper | 4:0 | å…±è­˜ç©©å›ºï¼ˆæ’é™¤ Agent #1 çš„ container æ–¹æ¡ˆï¼‰ |

å”¯ä¸€çš„å¾®å°åˆ†æ­§ï¼šBug #22 çš„å¼•ç”¨èªæ³•é¢¨æ ¼**æ’å…¥ä½ç½®**ï¼š
- Agent #3 + #4ï¼šline 198 å¾Œï¼ˆå¼•ç”¨ç™½åå–®å€æ®µï¼‰
- Agent #5ï¼ˆæœ¬å ±å‘Šï¼‰ï¼šline 249 å¾Œï¼ˆè¼¸å‡ºè¦æ±‚å€æ®µï¼‰
- å…©å€‹ä½ç½®éƒ½å¯è¡Œï¼Œèªæ„ä¸Šã€Œè¼¸å‡ºè¦æ±‚ã€å€æ®µæ›´åˆé©

### é€é …é©—è­‰

---

#### Bug #1: æ—¥æœŸè¬Šç¨±å•é¡Œ
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨ç«‹é©—è­‰**: è®€å– `generate_answer.py:631-684`ã€‚ä¸‰å€‹ prompt è®Šé«”ï¼š
  - `has_research_report` (line 633): ã€Œä½ æ˜¯ä¸€å€‹å°ˆæ¥­çš„å°ç£æ–°èåˆ†æåŠ©æ‰‹ã€â€” ç„¡æ—¥æœŸ
  - `has_cached_articles` (line 648): ã€ŒYou are an AI assistant helping with Taiwan news analysisã€â€” ç„¡æ—¥æœŸ
  - `else` (line 674): ã€ŒYou are an AI assistant helping with questions about Taiwan newsã€â€” ç„¡æ—¥æœŸ
- **äº”è¼ªä¸€è‡´**: ä¿®å¾©è¨ˆç•«æ­£ç¢ºï¼Œåœ¨ä¸‰å€‹è®Šé«”é–‹é ­æ³¨å…¥ç•¶å‰æ—¥æœŸã€‚

---

#### Bug #6: æ™‚é–“ç¯„åœè¨ˆç®—éŒ¯èª¤
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦è£œå……
- **ç¨ç«‹é©—è­‰**: è®€å– `time_range_extractor.py:38-88` (regex) å’Œ `:189-221` (è§£æé‚è¼¯)ã€‚
  - 8 å€‹ `_zh` regex å…¨éƒ¨ç”¨ `(\d+)` â€” ç¢ºèª
  - Prefix ä¸ä¸€è‡´ï¼ˆåªæœ‰ months/years çš„ `last_*_zh` æœ‰ `(?:è¿‘|æœ€è¿‘)`ï¼‰â€” ç¢ºèª
  - Lines 196/202/209/217 å…¨ç”¨ `int(match.group(1))` â€” ç¢ºèªï¼Œä¸­æ–‡æ•¸å­—æœƒ ValueError
- **è£œå……**:
  1. åŒæ„èªæ„åˆ†çµ„ prefix ç­–ç•¥ï¼ˆ4:1 å…±è­˜ï¼‰
  2. åŒæ„ `parse_number()` çš„ `split('å')` è¼•é‡å¯¦ä½œï¼ˆAgent #4 æå‡ºï¼‰
  3. ã€Œè¿‘ä¸‰å¤©ã€ä¸åŒ¹é…ä»»ä½• `_days_zh` pattern â€” ç¢ºèªä¿®å¾© prefix å¯è§£æ±º

---

#### Bug #10: Mac è¼¸å…¥æ³• Enter å•é¡Œ
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨ç«‹é©—è­‰**: æœå°‹ `news-search.js` ä¸­æ‰€æœ‰ `keydown` handlerï¼š
  - Line 378: `document.addEventListener('keydown')` â€” ESC é—œé–‰ history popupï¼Œä¸æ¶‰åŠ Enter
  - **Line 1235**: `searchInput.addEventListener('keydown')` â€” `if (e.key === 'Enter' && !e.shiftKey)` â€” **ç¼ºå°‘ `!e.isComposing`**
  - Line 4131: rename input â€” Enter è§¸ç™¼ blur
  - Line 4451: folder rename input â€” Enter è§¸ç™¼ blur
- **è¡Œè™Ÿä¿®æ­£**: å‰å››è¼ªå¼•ç”¨ line 1218 æˆ– 1234 å‡ä¸ç²¾ç¢ºã€‚Line 1234 æ˜¯ `btnSearch.addEventListener('click', performSearch);`ï¼ˆclick handlerï¼‰ï¼Œkeydown handler åœ¨ **line 1235**ã€‚
- **è¦†è“‹ç¯„åœ**: `performSearch()` (line 1238) å…§éƒ¨æ ¹æ“š `currentMode` åˆ†æ”¯ï¼šsearch / free conversation / deep researchã€‚ä¿®å¾©ä¸€è™•è¦†è“‹æ‰€æœ‰æ¨¡å¼ã€‚
- **å…¨æª”æ¡ˆç¢ºèª**: æœå°‹ `isComposing` â€” æ•´å€‹ JS æª”æ¡ˆä¸­ **é›¶å€‹çµæœ**ã€‚
- **é¡å¤–è§€å¯Ÿ**: Lines 4131 å’Œ 4451 çš„ rename input ä¹Ÿæœ‰ Enter keydown ç„¡ `!e.isComposing`ï¼Œå¯èƒ½åœ¨ IME è¼¸å…¥ä¸­æ–‡åç¨±æ™‚è§¸ç™¼æ„å¤– blurã€‚ä½å„ªå…ˆä¿®å¾©ã€‚

---

#### Bug #11 + #16: æ™‚é–“éæ¿¾ç¼ºå¤±
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦å¯¦è³ªè£œå……
- **ç¨ç«‹é©—è­‰**:
  - `retriever.py:817-818`: `async def search(self, query, site, num_results=50, endpoint_name=None, **kwargs)` â€” ç„¡ä»»ä½•æ™‚é–“ç›¸é—œåƒæ•¸
  - å®Œå…¨ç„¡ time filtering â€” åªåš endpoint parallel query + aggregate + deduplicate
  - `analyst.py:45-50`: `time_range = f"\n- Time Range: {start_date} to {end_date}"` â€” ç´”æ–‡å­—æ³¨å…¥ promptï¼Œä¸å½±éŸ¿ Qdrant æŸ¥è©¢
- **äº”è¼ªä¸€è‡´**: Retriever filter æ˜¯å…¨æ–°å¯¦ä½œï¼Œå¯è¤‡ç”¨ `time_range_extractor.py` çš„æ™‚é–“è§£æçµæœ

---

#### Bug #13: å¼•ç”¨é€£çµ private:// å•é¡Œ
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨ç«‹é©—è­‰**: è®€å– `news-search.js:1597-1619` `addCitationLinks()` å‡½æ•¸ï¼š
  - Line 1603: regex `/\[(\d+)\]/g`
  - Line 1605: bounds check `index >= 0 && index < sources.length`
  - Line 1607: `if (url)` â€” ç©ºå­—ä¸²è·³é
  - Line 1609: `urn:llm:knowledge:` â†’ `<span>` ç‰¹æ®Šæ¨™è¨˜
  - Line 1615: ä¸€èˆ¬ URL â†’ `<a>` é€£çµ
  - Line 1618: `return match` â€” out of range æˆ–ç©º URL
  - **ç„¡ `private://` è™•ç†** â€” ç¢ºèª
- **äº”è¼ªä¸€è‡´**: åœ¨ line 1612ï¼ˆ`urn` è™•ç†çš„ `}` ä¹‹å¾Œï¼‰åŠ å…¥ `private://` æª¢æŸ¥

---

#### Bug #17: çŸ¥è­˜åœ–è­œæ”¶ä¸èµ·ä¾†
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦è£œå……ï¼ˆè¦‹çˆ­è­°è£æ±º #3ï¼‰
- **ç¨ç«‹é©—è­‰**:
  - HTML: `kgDisplayContainer` (369) åŒ…å« header (å« toggleButton 382)ã€kgGraphView (388)ã€kgDisplayContent (392)ã€kgLegend (396)ã€kgDisplayEmpty (397)
  - Toggle handler (`news-search.js:2407-2417`): åªæ“ä½œ `content.classList`ï¼ˆ`.collapsed`ï¼‰ï¼Œä¸å½±éŸ¿ `kgGraphView`
  - View toggle (`news-search.js:2043-2052`): inline `style.display` åˆ‡æ›
  - CSS (`news-search.css:775-777`): `.kg-display-content.collapsed { display: none; }`
- **ä¿®å¾©**: Wrapper æ–¹æ¡ˆï¼ŒåŒ…å« kgGraphView + kgDisplayContent + kgLegend + kgDisplayEmptyï¼Œä¸å« header

---

#### Bug #22: å¼•ç”¨æ ¼å¼ä¸é€šé †
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦è£œå…… â€” **æ±ºå®šæ€§ç¬¬äº”ç¥¨ï¼Œæ‰“ç ´ 2:2 å¹³å±€**
- **ç¨ç«‹é©—è­‰**: è®€å– `writer.py:135-285` `build_compose_prompt()` æ–¹æ³•ï¼š
  - Line 194-198: å¼•ç”¨ç™½åå–®ç´„æŸï¼ˆã€Œåš´ç¦ç„¡ä¸­ç”Ÿæœ‰ã€+ `{analyst_citations}`ï¼‰
  - Line 245-249: `sources_used` å¿…é ˆæ˜¯ `analyst_citations` å­é›†
  - **ç„¡ä»»ä½•å¼•ç”¨ã€Œèªæ³•é¢¨æ ¼ã€æŒ‡å¼•** â€” ç¢ºèª
- **è¨ˆç•«å•é¡Œ**: ä¿®æ”¹ä½ç½®å¯« `_citation_rules()` æˆ–é¡ä¼¼æ–¹æ³•ã€‚æœå°‹çµæœï¼šæ­¤æ–¹æ³•åœ¨æ•´å€‹ codebase ä¸­**ä¸å­˜åœ¨**ã€‚
- **ä¿®æ­£**: åœ¨ `build_compose_prompt()` çš„ f-string ä¸­æ’å…¥å¼•ç”¨èªæ³•é¢¨æ ¼æŒ‡å¼•ã€‚å»ºè­°ä½ç½®ï¼šline 249 å¾Œï¼ˆã€Œè¼¸å‡ºè¦æ±‚ã€å€æ®µï¼‰ï¼Œèˆ‡ Sources Used é™åˆ¶ç›¸é„°ã€‚

---

#### Bug #25: å¼•ç”¨æ•¸å­—å¤ªå¤§æ²’æœ‰è¶…é€£çµ
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦è£œå……
- **ç¨ç«‹é©—è­‰**: è®€å– `orchestrator.py:1111-1139`ï¼š
  - Line 1115: `max_cid = max(self.source_map.keys()) if self.source_map else 0`
  - Line 1121: `for cid in range(1, max_cid + 1)` â€” åªå»ºåˆ° source_map æœ€å¤§ key
  - Line 1136: `source_urls.append("")` â€” ç¼ºå¤±çš„ cid å¡«ç©ºå­—ä¸²
- **å‰ç«¯**: `addCitationLinks()` (JS line 1605): bounds check + line 1607 `if (url)` â€” è¶…å‡ºæˆ–ç©ºå­—ä¸²éƒ½ `return match`
- **Plan A æ•ˆæœç¢ºèª**: ç¨ç«‹è¿½è¹¤å…©æ¢ä»£ç¢¼è·¯å¾‘ï¼Œçµæœå®Œå…¨ç›¸åŒï¼ˆå‡åˆ°é” line 1618 `return match`ï¼‰ã€‚Agent #4 çš„åˆ†ææ­£ç¢ºã€‚
- **æ¨è–¦**: Cï¼ˆå‰ç«¯é™ç´šé¡¯ç¤ºï¼‰> Bï¼ˆprompt ç´„æŸï¼‰> Aï¼ˆå¾Œç«¯è¨ºæ–·ï¼‰

---

#### Bug #2: Free Conversation é‡˜é¸æ–‡ç« 
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦å¯¦è³ªè£œå……
- **ç¨ç«‹é©—è­‰**:
  - `togglePinNewsCard(url, title)` (line 2758): åªæ¥æ”¶ 2 å€‹åƒæ•¸
  - `pinnedNewsCards.push({ url, title, pinnedAt: Date.now() })` (line 2771-2774): **ç„¡ description/snippet**
  - POST body (line 2456-2477): `{ query, site, generate_mode, streaming, free_conversation, session_id, conversation_id, prev }` + å¯é¸ `research_report`, `include_private_sources`, `user_id` â€” **ç„¡ `pinned_articles` æ¬„ä½**
- **äº”è¼ªä¸€è‡´**: éœ€æ“´å±•é‡˜é¸è³‡æ–™çµæ§‹ï¼ˆåŠ  descriptionï¼‰+ POST å”è­°å¢åŠ  `pinned_articles` æ¬„ä½

---

#### Bug #23: æš«åœå°è©±æŒ‰éˆ•ç¼ºå¤±
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦å¯¦è³ªè£œå……
- **ç¨ç«‹é©—è­‰**:

| æ¨¡å¼ | å»ºç«‹æ–¹å¼ | æ¨¡çµ„ç´šå¼•ç”¨ | abort æ©Ÿåˆ¶ | ç¾ç‹€ |
|------|---------|-----------|-----------|------|
| **æœå°‹** | EventSource (line 690) â†’ `currentSearchEventSource` (line 691) | âœ… line 68-69 | âœ… `cancelActiveSearch()` (line 1243) | âœ… å®Œæ•´ |
| **Deep Research** | `const eventSource = new EventSource(...)` (line 1530) | âŒ å±€éƒ¨ `const` | âŒ ç„¡å¤–éƒ¨ abort | âŒ å®Œå…¨ç„¡æ³• abort |
| **Free Conversation** | `fetch()` via `handlePostStreamingRequest()` (line 764) | âŒ ç„¡ AbortController | âŒ fetch ç„¡ signal | âŒ å®Œå…¨ç„¡æ³• abort |

- **è·¨æ¨¡å¼ abort å•é¡Œ**ï¼ˆåŒæ„ Agent #4ï¼‰ï¼š`performSearch()` line 1261 å‘¼å« `cancelActiveSearch()`ï¼Œåªè™•ç†æœå°‹æ¨¡å¼çš„ EventSourceã€‚DR EventSource å’Œ FC fetch ä¸å—å½±éŸ¿ã€‚éœ€è¦ `cancelAllActiveRequests()` çµ±ä¸€å‡½æ•¸ã€‚

---

#### Bug #3: åˆç†åŒ–éŒ¯èª¤ç­”æ¡ˆ
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨ç«‹é©—è­‰**: åŒ Bug #1 ä½ç½®ï¼Œprompt ä¸­ç„¡ç³»çµ±é™åˆ¶èªªæ˜ã€‚
- **äº”è¼ªä¸€è‡´**: æ˜¯ã€‚

---

#### Bug #4 + #5: æ·±åº¦ç ”ç©¶æ­§ç¾©æª¢æ¸¬
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **é©—è­‰**: å‰ç«¯ clarification é¸é …åŠ å…¥è‡ªç”±æ–‡å­—è¼¸å…¥å’Œã€Œæ²’æœ‰ã€æŒ‰éˆ•ï¼Œæ–¹å‘åˆç†ã€‚

---

#### Bug #9: ç„¡æ³•å­˜å–å³æ™‚æ–°è
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨ç«‹é©—è­‰**: åŒ Bug #1 ä½ç½®ï¼Œprompt ä¸­ç„¡ç³»çµ±èƒ½åŠ›èªªæ˜ã€‚

---

#### Bug #24: å›è¦†æ²’æœ‰æ’ç‰ˆæ›è¡Œ
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **ç¨ç«‹é©—è­‰**: ä¸‰å€‹ prompt è®Šé«”å‡æœªç³»çµ±æ€§è¦æ±‚ Markdown æ ¼å¼ã€‚

---

#### Bug #14: æ‘˜è¦å›é¥‹æŒ‰éˆ•
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œï¼ˆéœ€ /planï¼‰
- **é©—è­‰**: åˆæ­¥æ–¹å‘åˆç†ã€‚

---

#### Bug #7: ç¼ºå°‘ç´«è‰²è™›ç·šæ¨™è¨˜
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œï¼ˆéœ€èª¿æŸ¥ï¼‰
- **é©—è­‰**: èª¿æŸ¥æ–¹å‘æ­£ç¢ºã€‚

---

#### Bug #8: æ²’æœ‰çœŸçš„åˆ—å‡º 12 æœˆåå¤§æ–°è
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œï¼ˆåŠŸèƒ½é™åˆ¶ï¼Œéœ€èª¿æŸ¥ï¼‰
- **é©—è­‰**: Decontextualization èª¿æŸ¥æ–¹å‘åˆç†ã€‚

---

#### Bug #12: æ²»å®‰æ”¿ç­–æ²’æ‰¾åˆ°å¼µæ–‡äº‹ä»¶
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œ
- **é©—è­‰**: LLM-based query expansion æ–¹æ¡ˆåˆç†ã€‚

---

#### Bug #15: æŠ€è¡“å‹å·¥è‚¡ç¥¨æŸ¥è©¢
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦è£œå……
- **é©—è­‰**: éœ€å…ˆèª¿æŸ¥ Tier 6 stock API prompt å’Œ Analyst æ±ºç­–éç¨‹ã€‚

---

#### Bug #18-20: è¨˜è€…æ–‡ç« æœå°‹
- **è¨ˆç•«å¯è¡Œæ€§**: âš ï¸ éœ€è¦è£œå……
- **é©—è­‰**: èˆ‡ Bug #11/#16 ç›¸åŒçš„ retriever payload filter å•é¡Œã€‚æ‡‰ä¸€ä½µè¨­è¨ˆé€šç”¨ filter æ©Ÿåˆ¶ã€‚

---

#### Bug #21: æ·±åº¦ç ”ç©¶è¨˜è€…æŸ¥è©¢
- **è¨ˆç•«å¯è¡Œæ€§**: âœ… å¯è¡Œï¼ˆä¾è³´ Bug #18-20ï¼‰
- **é©—è­‰**: ä¾è³´é—œä¿‚æ­£ç¢ºã€‚

---

### éºæ¼ç™¼ç¾

1. **Bug #10 è¡Œè™Ÿç²¾ç¢ºä¿®æ­£**

   å‰å››è¼ªå¼•ç”¨çš„è¡Œè™Ÿï¼ˆ1218 æˆ– 1234ï¼‰å‡ä¸æº–ç¢ºï¼š
   - Line 1234: `btnSearch.addEventListener('click', performSearch);` â€” é€™æ˜¯ **click** handler
   - Line 1235: `searchInput.addEventListener('keydown', (e) => {` â€” é€™æ˜¯ **keydown** handler
   - Line 1236: `if (e.key === 'Enter' && !e.shiftKey) {` â€” é€™æ˜¯ç¼ºå°‘ `!e.isComposing` çš„æ¢ä»¶

   Agent #3 å’Œ #4 èªªã€Œline 1234ã€å·®äº†ä¸€è¡Œã€‚å»ºè­°ä¿®å¾©æ™‚ä»¥ `searchInput.addEventListener('keydown'` ä½œç‚ºå®šä½é—œéµå­—ï¼Œä¸ä¾è³´è¡Œè™Ÿã€‚

2. **Bug #10 æ¬¡è¦ keydown handler**

   Lines 4131 å’Œ 4451 çš„ rename/folder rename input ä¹Ÿæœ‰ Enter â†’ blur çš„ keydown handlerï¼Œæ²’æœ‰ `!e.isComposing`ã€‚åœ¨ IME è¼¸å…¥ä¸­æ–‡é‡å‘½åæ™‚å¯èƒ½è§¸ç™¼æ„å¤–æäº¤ã€‚ä½å„ªå…ˆä¿®å¾©é …ã€‚

3. **Bug #22 æ’å…¥ä½ç½®çš„èªæ„è€ƒé‡**

   å‰å››è¼ªå»ºè­°æ’å…¥ line 198 å¾Œï¼ˆå¼•ç”¨ç™½åå–®ï¼Œå±¬æ–¼ã€Œè¼¸å…¥è³‡æ–™ã€å€æ®µï¼‰ã€‚ä½†å¼•ç”¨èªæ³•é¢¨æ ¼æ˜¯ã€Œå¦‚ä½•è¼¸å‡ºã€çš„å•é¡Œï¼Œèªæ„ä¸Šæ›´é©åˆæ”¾åœ¨ line 249 å¾Œï¼ˆã€Œè¼¸å‡ºè¦æ±‚ã€çš„ Sources Used é™åˆ¶ä¹‹å¾Œï¼‰ã€‚å…©å€‹ä½ç½®åœ¨åŠŸèƒ½ä¸Šéƒ½å¯è¡Œï¼Œä½†å¾Œè€…è®“ prompt çµæ§‹æ›´é€£è²«ï¼š
   - ç™½åå–®å€æ®µ â†’ ã€Œç”¨å“ªäº›å¼•ç”¨ã€ï¼ˆè¼¸å…¥ç´„æŸï¼‰
   - èªæ³•é¢¨æ ¼å€æ®µ â†’ ã€Œæ€éº¼å¯«å¼•ç”¨ã€ï¼ˆè¼¸å‡ºç´„æŸï¼‰

4. **Bug #2 localStorage ä¸€è‡´æ€§**

   `pinnedNewsCards` ä¸åƒ…å­˜åœ¨è¨˜æ†¶é«”ä¸­ï¼Œä¹Ÿé€šé session ä¿å­˜åˆ° localStorageï¼ˆlines 457, 472ï¼‰ã€‚æ“´å±•è³‡æ–™çµæ§‹ï¼ˆåŠ  descriptionï¼‰æ™‚ï¼Œéœ€åŒæ­¥æ›´æ–° localStorage çš„è®€å–/å¯«å…¥é‚è¼¯ï¼Œç¢ºä¿èˆŠæ ¼å¼ session çš„å‘å¾Œå…¼å®¹æ€§ï¼ˆ`description` æ¬„ä½å¯èƒ½ä¸å­˜åœ¨ï¼‰ã€‚

### æœ€çµ‚å»ºè­°

ç¶“éäº”è¼ªç¨ç«‹é©—è­‰ï¼Œæ‰€æœ‰ä¿®å¾©è¨ˆç•«çš„**æ–¹å‘éƒ½æ­£ç¢º**ï¼Œæ²’æœ‰ä»»ä½• âŒã€‚

**äº”è¼ªå…±è­˜çš„æ˜ç¢ºçµè«–**ï¼š

| é …ç›® | æœ€çµ‚çµè«– | ç¥¨æ•¸ |
|------|---------|------|
| Bug #17 æ–¹æ¡ˆ | Wrapper | 4:0 |
| Bug #6 prefix | èªæ„åˆ†çµ„ | 4:1 |
| Bug #22 åˆ†é¡ | âš ï¸ éœ€è£œå…… | **3:2ï¼ˆç¬¬äº”è¼ªè£æ±ºï¼‰** |
| Bug #25 å„ªå…ˆé †åº | C > B > A | 5:0 |
| Bug #11/#16 å¯¦ä½œ | å…¨æ–° retriever filter | 5:0 |
| Bug #23 çµ±ä¸€ abort | cancelAllActiveRequests() | 5:0 |
| æ•´åˆ 2 ç¯„åœ | ä¸å« Bug #17 | 5:0 |

**ä¿®å¾©é †åºå»ºè­°**ï¼ˆåŒæ„ Agent #4ï¼Œå¾®èª¿ï¼‰ï¼š

- **Phase 1ï¼ˆå¿«é€Ÿä¿®å¾©ï¼‰**: Bug #1 + #3 + #9 + #24ï¼ˆæ•´åˆ 1: prompt ä¿®æ”¹ï¼‰+ Bug #10ï¼ˆIMEï¼‰+ Bug #13ï¼ˆprivate://ï¼‰+ Bug #22ï¼ˆå¼•ç”¨èªæ³•ï¼‰
- **Phase 2ï¼ˆå‰ç«¯æ¶æ§‹ï¼‰**: Bug #17ï¼ˆKG toggle wrapperï¼‰+ Bug #23ï¼ˆçµ±ä¸€ abortï¼‰+ Bug #25ï¼ˆå¼•ç”¨é™ç´šé¡¯ç¤ºï¼ŒPlan C å„ªå…ˆï¼‰
- **Phase 3ï¼ˆå¾Œç«¯æ¶æ§‹ï¼‰**: Bug #11/#16 + #18-20ï¼ˆretriever é€šç”¨ filterï¼‰+ Bug #6ï¼ˆä¸­æ–‡æ•¸å­—ï¼‰
- **Phase 4ï¼ˆåŠŸèƒ½å®Œå–„ï¼‰**: Bug #2ï¼ˆé‡˜é¸æ“´å±•ï¼‰
- **Phase 5ï¼ˆèª¿æŸ¥å¾Œä¿®å¾©ï¼‰**: Bug #7, #8, #12, #14, #15, #21

**Phase 1 èª¿æ•´èªªæ˜**: ç›¸æ¯” Agent #4 çš„å»ºè­°ï¼Œæˆ‘æŠŠ Bug #22 å¾ Phase 2 ç§»åˆ° Phase 1ã€‚ç†ç”±ï¼šBug #22 çš„ä¿®å¾©åªæ˜¯åœ¨ `build_compose_prompt()` çš„ f-string ä¸­åŠ å…¥ä¸€æ®µæ–‡å­—ï¼Œå·¥ä½œé‡èˆ‡ Bug #1/#3/#9/#24 çš„ prompt ä¿®æ”¹åŒç­‰ç´šï¼Œç„¡éœ€ç­‰åˆ° Phase 2ã€‚

---

*é©—è­‰å®Œæˆæ—¥æœŸï¼š2026-01-29*
